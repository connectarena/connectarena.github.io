(function(c){function u(a){for(var d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),b=[],c=0;c<a;c++){var g=(Math.random()*(d.length-1)).toFixed(0);b[c]=d[g]}return b.join("")}function F(a){a+="=";for(var d=decodeURIComponent(document.cookie).split(";"),b=0;b<d.length;b++){for(var c=d[b];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(a))return c.substring(a.length,c.length)}return""}function G(a,d,b){var c=new Date;c.setTime(c.getTime()+864E5*b);b="expires="+c.toUTCString();
document.cookie=a+"="+d+";"+b+";path=/"}function m(){return Math.ceil(1E9*Math.random())}var B,v={socket:0,rest:1},r={initiated:0,connected:1,ready:2,error:3,closed:4},n=0,k=new ArrayBuffer(0),w=0,C=0,y=0,H=function(a,d,b){var f="";switch(d){case a.proto_msgType.values.E_SIGNUP_RSP:if(c.CS.transactionRespCB[b.stSignUpRes.ullTransId])c.CS.transactionRespCB[b.stSignUpRes.ullTransId](a.imlrespcode[b.stSignUpRes.ret].code,a.imlrespcode[b.stSignUpRes.ret].phrase);break;case a.proto_msgType.values.E_ACTIVATE_RSP:if(c.CS.transactionRespCB[b.stActivateRes.ullTransId])c.CS.transactionRespCB[b.stActivateRes.ullTransId](a.imlrespcode[b.stActivateRes.ret].code,
a.imlrespcode[b.stActivateRes.ret].phrase);break;case a.proto_msgType.values.E_LOGIN_RSP:if(c.CS.transactionRespCB[b.stLoginRes.ullTransId])c.CS.transactionRespCB[b.stLoginRes.ullTransId](a.imlrespcode[b.stLoginRes.ret].code,a.imlrespcode[b.stLoginRes.ret].phrase);b.stLoginRes.ret&&(a.loggedin=!0);c.CS.s3Bin=b.stLoginRes.sBucketName;break;case a.proto_msgType.values.E_GET_CONTACTS_RSP:if(c.CS.transactionRespCB[b.stGetContactsRes.ullTransId])c.CS.transactionRespCB[b.stGetContactsRes.ullTransId](a.imlrespcode[b.stGetContactsRes.ret].code,
{contacts:b.stGetContactsRes.sPhoneNums,types:b.stGetContactsRes.stContactTypes});break;case a.proto_msgType.values.E_IS_APP_CONTACT_RSP:d=[];f=b.stIsAppContactRes.sPhoneNums;for(var g=b.stIsAppContactRes.stProfile,e=0;e<f.length;e++)d[e]={mobileNumber:f[e],name:g[e].sUserName,presenceMessage:g[e].sPresenceStatusMsg,profilePicId:g[e].sProfilePicId};if(c.CS.transactionRespCB[b.stIsAppContactRes.ullTransId])c.CS.transactionRespCB[b.stIsAppContactRes.ullTransId](a.imlrespcode[b.stIsAppContactRes.ret].code,
d);break;case a.proto_msgType.values.E_USER_JOINED_RQT:if(c.CS.transactionRespCB[b.stUserJoinedReq.ullTransId])c.CS.transactionRespCB[b.stUserJoinedReq.ullTransId](a.contactsStatus[d].status,{mobileNumber:b.stUserJoinedReq.sJoinedUserMobNu});break;case a.proto_msgType.values.E_ADD_NUM_RSP:if(c.CS.transactionRespCB[b.stAddNumRes.ullTransId])c.CS.transactionRespCB[b.stAddNumRes.ullTransId](a.imlrespcode[b.stAddNumRes.ret].code,a.imlrespcode[b.stAddNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP:break;
case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT:a.call.callObj[b.stDirectAudioVideoCall180RingingReq.sCallId].state=a.call.RINGING_RECEIVED;e={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingRes:{ullTransId:b.stDirectAudioVideoCall180RingingReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:b.stDirectAudioVideoCall180RingingReq.sCallId,retCodes:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP,e);if(c.CS.call.onMessagecb)c.CS.call.onMessagecb(a.callEventCode[d].code,
{callId:b.stDirectAudioVideoCall180RingingReq.sCallId});break;case a.proto_msgType.values.E_GET_PRESENCE_RSP:d=[];for(e in b.stGetPresRes.stPresence)f={mobileNumber:b.stGetPresRes.stPresence[e].sPhoneNum,isOnline:!0,lastLoginTime:b.stGetPresRes.stPresence[e].sTime,statusMessage:b.stGetPresRes.stPresence[e].sPresenceStatusMsg},"OFFLINE"==b.stGetPresRes.stPresence[e].sStatus&&(f.isOnline=!1),d.push(f);if(c.CS.transactionRespCB[b.stGetPresRes.ullTransId])c.CS.transactionRespCB[b.stGetPresRes.ullTransId](a.imlrespcode[b.stGetPresRes.ret].code,
d);break;case a.proto_msgType.values.E_SET_PROFILE_RSP:if(c.CS.transactionRespCB[b.stSetProfileRes.ullTransId])c.CS.transactionRespCB[b.stSetProfileRes.ullTransId](a.imlrespcode[b.stSetProfileRes.ret].code,a.imlrespcode[b.stSetProfileRes.ret].phrase);break;case a.proto_msgType.values.E_GET_PROFILE_RSP:if(c.CS.transactionRespCB[b.stGetProfileRes.ullTransId])c.CS.transactionRespCB[b.stGetProfileRes.ullTransId](a.imlrespcode[b.stGetProfileRes.ret].code,{displayName:b.stGetProfileRes.stProfile.sUserName,
Presence:b.stGetProfileRes.stProfile.sPresenceStatusMsg,profilePicture:b.stGetProfileRes.stProfile.sProfilePicId});break;case a.proto_msgType.values.E_USER_PROFILE_CHANGED_RQT:c.CS.contacts.onpresenceupdatecb&&(e={mobilenumber:b.stUserProfileChangedReq.sProfileUserMobNu},b.stUserProfileChangedReq.stProfile.sUserName&&(e.name=b.stUserProfileChangedReq.stProfile.sUserName),b.stUserProfileChangedReq.stProfile.sPresenceStatusMsg&&(e.message=b.stUserProfileChangedReq.stProfile.sPresenceStatusMsg),b.stUserProfileChangedReq.stProfile.sProfilePicId&&
(e.profilePicUrl=b.stUserProfileChangedReq.stProfile.sProfilePicId),c.CS.contacts.onpresenceupdatecb(a.contactsStatus[d].status,e));e={uVersion:a.protoVersion,stUserProfileChangedRes:{ullTransId:b.stUserProfileChangedReq.stHdrs.ullTransId,sMobNu:a.localUser,sProfileUserMobNu:b.stUserProfileChangedReq.sProfileUserMobNu,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_USER_PROFILE_CHANGED_RSP,e);break;case a.proto_msgType.values.E_CHAT_RQT:e={uVersion:a.protoVersion,stChatRes:{ullTransId:b.stChatReq.stHdrs.ullTransId,
sMobNu:a.localUser,uChatID:b.stChatReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CHAT_RSP,e);c.CS.chat.sendChatResponse(b.stChatReq);c.CS.chat.sendDelivered(b.stChatReq.stHdrs.sMobNu,b.stChatReq.uChatID,0,function(a,b){});c.CS.chat.onMessagecb&&(e={remoteUser:b.stChatReq.stHdrs.sMobNu,data:b.stChatReq.data,timestamp:b.stChatReq.uSendTime,id:b.stChatReq.uChatID,sequence:b.stChatReq.uSeqNum,size:b.stChatReq.dataLen,chattype:a.chatType[b.stChatReq.stChatType].type},
b.stChatReq.sContentType&&(e.contenttype=b.stChatReq.sContentType),b.stChatReq.sThumbnailUrl&&(e.thumbnail=b.stChatReq.sThumbnailUrl),c.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RQT],e));break;case a.proto_msgType.values.E_CHAT_RSP:e=a.imlrespcode[b.stChatRes.ret].phrase;c.CS.respData[b.stChatRes.ullTransId]&&(e={status:a.imlrespcode[b.stChatRes.ret].phrase,url:c.CS.respData[b.stChatRes.ullTransId].fileName});if(c.CS.transactionRespCB[b.stChatRes.ullTransId])c.CS.transactionRespCB[b.stChatRes.ullTransId](a.imlrespcode[b.stChatRes.ret].code,
e);if(c.CS.chat.onMessagecb)c.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RSP],{id:b.stChatRes.uChatID,status:a.imlrespcode[b.stChatRes.ret].code,remoteUser:b.stChatRes.sMobNu});break;case a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP:if(c.CS.transactionRespCB[b.stGetMyPendingNotificationsRes.ullTransId])c.CS.transactionRespCB[b.stGetMyPendingNotificationsRes.ullTransId](a.imlrespcode[b.stGetMyPendingNotificationsRes.ret].code,a.imlrespcode[b.stGetMyPendingNotificationsRes.ret].phrase);
break;case a.proto_msgType.values.E_IS_TYPING_RQT:e={uVersion:a.protoVersion,stIsTypingRes:{ullTransId:b.stIsTypingReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_IS_TYPING_RSP,e);if(c.CS.chat.onMessagecb)c.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_IS_TYPING_RQT],{remoteUser:b.stIsTypingReq.sDstMobNu,groupId:b.stIsTypingReq.sGroupID});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RQT:console.log("chat delivered");e={uVersion:a.protoVersion,
stChatDeliveryRes:{ullTransId:b.stChatDeliveryReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:b.stChatDeliveryReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CHAT_DELIVERY_RSP,e);if(c.CS.chat.onMessagecb)c.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_DELIVERY_RQT],{id:b.stChatDeliveryReq.uChatID,time:b.stChatDeliveryReq.uDeliveryTime,remoteUser:b.stChatDeliveryReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_READ_RQT:console.log("chat read");
e={uVersion:a.protoVersion,stChatReadRes:{ullTransId:b.stChatReadReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:b.stChatReadReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CHAT_READ_RSP,e);if(c.CS.chat.onMessagecb)c.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_READ_RQT],{id:b.stChatReadReq.uChatID,time:b.stChatReadReq.uReadTime,remoteUser:b.stChatReadReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RSP:if(c.CS.transactionRespCB[b.stChatDeliveryRes.ullTransId])c.CS.transactionRespCB[b.stChatDeliveryRes.ullTransId](a.imlrespcode[b.stChatDeliveryRes.ret].code,
a.imlrespcode[b.stChatDeliveryRes.ret].phrase);break;case a.proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RSP:d=[];f=b.stGetChatHistoryListRes.stChatHistoryList;g=f.length;for(e=0;e<g;e++)d[e]={id:f[e].sChatID,src:f[e].ssrcMobNu,dst:f[e].sDstMobNu,sequenceNo:f[e].ullSeqNum,sentTimestamp:f[e].ullMessageTime,chatType:a.chatType[f[e].eChatType].type,reportsRequested:f[e].uReportsReq,data:f[e].sData,contentType:f[e].sContentType,thumbUrl:f[e].sThumbnailUrl,messageStatus:a.chatStatus[f[e].eStatus].status,
deliveredTimestamp:f[e].ullDeliveryTime,readTimestamp:f[e].ullReadTime},f[e].sThumbnailUrl&&(d[e].thumbnail=f[e].sThumbnailUrl);if(c.CS.transactionRespCB[b.stGetChatHistoryListRes.ullTransId])c.CS.transactionRespCB[b.stGetChatHistoryListRes.ullTransId](a.imlrespcode[b.stGetChatHistoryListRes.eReturnCode].code,{totalMessages:b.stGetChatHistoryListRes.sTotalNumberOfEntries,pageSize:b.stGetChatHistoryListRes.sPageSize,history:d});break;case a.proto_msgType.values.E_GET_CALL_HISTORY_LIST_RSP:d=[];f=b.stGetCallHistoryListRes.stCallHistoryList;
g=f.length;for(e=0;e<g;e++)d[e]={id:f[e].sCallID,src:f[e].ssrcMobNu,dst:f[e].sDstMobNu,callType:a.callType[f[e].eCallType].type,direction:a.direction[f[e].eDirection].type,status:a.callStatus[f[e].eStatus].status,startTime:f[e].ullStartTime,endTime:f[e].ullEndTime};if(c.CS.transactionRespCB[b.stGetCallHistoryListRes.ullTransId])c.CS.transactionRespCB[b.stGetCallHistoryListRes.ullTransId](a.imlrespcode[b.stGetCallHistoryListRes.eReturnCode].code,{totalMessages:b.stGetCallHistoryListRes.sTotalNumberOfEntries,
pageSize:b.stGetCallHistoryListRes.sPageSize,history:d});break;case a.proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RSP:d=[];f=b.stGetRecentConversationListRes.stConversationList;for(e=0;e<f.length;e++)d[e]={messageType:a.recentMsgType[f[e].eConversationType].type},f[e].stChatHistoryList&&(g=f[e].stChatHistoryList,d[e].chat={id:g.sChatID,src:g.ssrcMobNu,dst:g.sDstMobNu,sequenceNo:g.ullSeqNum,sentTimestamp:g.ullMessageTime,chatType:a.chatType[g.eChatType].type,reportsRequested:g.uReportsReq,
data:g.sData,contentType:g.sContentType,thumbUrl:g.sThumbnailUrl,messageStatus:a.chatStatus[g.eStatus].status,deliveredTimestamp:g.ullDeliveryTime,readTimestamp:g.ullReadTime}),f[e].stCallHistoryList&&(g=f[e].stCallHistoryList,d[e].call={callId:g.sCallID,src:g.ssrcMobNu,dst:g.sDstMobNu,callType:a.callType[g.eCallType].type,direction:a.direction[g.eDirection].type,status:a.callStatus[g.eStatus].status,startTime:g.ullStartTime,endTime:g.ullEndTime});if(c.CS.transactionRespCB[b.stGetRecentConversationListRes.ullTransId])c.CS.transactionRespCB[b.stGetRecentConversationListRes.ullTransId](a.imlrespcode[b.stGetRecentConversationListRes.eReturnCode].code,
{totalMessages:b.stGetRecentConversationListRes.sTotalNumberOfEntries,pageSize:b.stGetRecentConversationListRes.sPageSize,list:d});break;case a.proto_msgType.values.E_CHAT_READ_RSP:if(c.CS.transactionRespCB[b.stChatReadRes.ullTransId])c.CS.transactionRespCB[b.stChatReadRes.ullTransId](a.imlrespcode[b.stChatReadRes.ret].code,a.imlrespcode[b.stChatReadRes.ret].phrase);break;case a.proto_msgType.values.E_DELETE_NUM_RSP:if(c.CS.transactionRespCB[b.stDeleteNumRes.ullTransId])c.CS.transactionRespCB[b.stDeleteNumRes.ullTransId](a.imlrespcode[b.stDeleteNumRes.ret].code,
a.imlrespcode[b.stDeleteNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT:f=b.stDirectAudioVideoCallStartReq.sCallId;a.call.remoteUser=b.stDirectAudioVideoCallStartReq.stHdrs.sMobNu;a.call.stDirectAudioVideoCallStartReq=b.stDirectAudioVideoCallStartReq;a.call.isVideoCall=a.proto_callType.values.E_VIDEOCALL==b.stDirectAudioVideoCallStartReq.stCallType;if(c.CS.call.onMessagecb)c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,isVideoCall:a.call.isVideoCall,
callId:f,isCallActive:b.stDirectAudioVideoCallStartReq.sCallActive,startTime:b.stDirectAudioVideoCallStartReq.sStartTime});e={uVersion:a.protoVersion,stDirectAudioVideoCallStartRes:{ullTransId:b.stDirectAudioVideoCallStartReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:b.stDirectAudioVideoCallStartReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP,e);e={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingReq:{stHdrs:{sMobNu:c.CS.localUser,
sClientId:c.CS.clientId,ullTransId:m()},sDstMobNu:c.CS.call.remoteUser,stCallType:c.CS.proto_callType.values.E_VIDEOCALL,sCallId:f}};a.proto_callType.values.E_VOICECALL==b.stDirectAudioVideoCallStartReq.stCallType&&(e.stDirectAudioVideoCall180RingingReq.stCallType=a.proto_callType.values.E_VOICECALL);a.call.callObj[f]={state:a.call.states.OFFER_RECEIVED,remoteUser:a.call.remoteUser,type:"IP",direction:"IN",isMuted:!1,iceCandidates:[]};a.call.callObj[f].state!=a.call.states.IDLE&&(e.stDirectAudioVideoCall180RingingReq.bIsCallWaiting=
!0);h(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT,e);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP:case a.proto_msgType.values.E_CALL_START_RSP:break;case a.proto_msgType.values.E_CALL_ANSWER_RQT:a.call.callObj[b.stCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=b.stCallAnswerReq.sCallId;if(c.CS.call.onMessagecb)c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,callId:b.stCallAnswerReq.sCallId});wr_recv_rem_answer(b.stCallAnswerReq.sSdp,
b.stCallAnswerReq.sCallId);e={uVersion:a.protoVersion,stCallAnswerRes:{ullTransId:b.stCallAnswerReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:b.stCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CALL_ANSWER_RSP,e);break;case a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RQT:a.call.callObj[b.callSessionInProgressSdpReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=b.callSessionInProgressSdpReq.sCallId;wr_recv_rem_answer(b.callSessionInProgressSdpReq.sSdp,
b.callSessionInProgressSdpReq.sCallId);if(a.call.callObj[b.callSessionInProgressSdpReq.sCallId].state!=a.call.states.CONNECTED&&c.CS.call.onMessagecb)c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,callId:b.stCallAnswerReq.sCallId});e={uVersion:a.protoVersion,stCallSessionInProgressSdpRes:{ullTransId:b.stCallSessionInProgressSdpReq.stHdrs.ullTransId,sMobNu:a.localUser,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RSP,e);
break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT:a.call.callObj[b.stDirectAudioVideoCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=b.stDirectAudioVideoCallAnswerReq.sCallId;if(c.CS.call.onMessagecb)c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,callId:b.stDirectAudioVideoCallAnswerReq.sCallId});wr_recv_rem_answer(b.stDirectAudioVideoCallAnswerReq.sSdp,b.stDirectAudioVideoCallAnswerReq.sCallId);e={uVersion:a.protoVersion,stDirectAudioVideoCallAnswerRes:{ullTransId:b.stDirectAudioVideoCallAnswerReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:b.stDirectAudioVideoCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP,e);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP:console.log("received answer response");if(c.CS.transactionRespCB[b.stDirectAudioVideoCallAnswerRes.ullTransId])c.CS.transactionRespCB[b.stDirectAudioVideoCallAnswerRes.ullTransId](a.imlrespcode[b.stDirectAudioVideoCallAnswerRes.ret].code,a.imlrespcode[b.stDirectAudioVideoCallAnswerRes.ret].phrase);
break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT:f=b.stDirectAudioVideoCallEndReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[f])break;a.call.callObj[f].state=a.call.states.IDLE;a.call.remoteUser=b.stDirectAudioVideoCallEndReq.stHdrs.sMobNu;c.CS.call.onMessagecb&&c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,callId:f});e={uVersion:a.protoVersion,stDirectAudioVideoCallEndRes:{ullTransId:b.stDirectAudioVideoCallEndReq.stHdrs.ullTransId,sMobNu:a.localUser,
sCallId:f,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP,e);wr_recv_rem_end();break;case a.proto_msgType.values.E_CALL_ENDED_RQT:f=b.stCallEndedReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[f])break;a.call.callObj[f].state=a.call.states.IDLE;a.call.remoteUser=b.stCallEndedReq.stHdrs.sMobNu;c.CS.call.onMessagecb&&c.CS.call.onMessagecb(a.callEventCode[d].code,{caller:a.call.remoteUser,callId:f});e={uVersion:a.protoVersion,stCallEndedRes:{ullTransId:b.stCallEndedRes.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:f,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_CALL_ENDED_RSP,e);wr_recv_rem_end();break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP:break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP:case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP:break;case a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RQT:c.CS.contacts.onpresenceupdatecb&&c.CS.contacts.onpresenceupdatecb(a.contactsStatus[d].status,{user:b.stUserPresenceChangedReq.stPresence.sPhoneNum,
isOnline:"ONLINE"==b.stUserPresenceChangedReq.stPresence.sStatus,time:b.stUserPresenceChangedReq.stPresence.sTime,message:b.stUserPresenceChangedReq.stPresence.sPresenceStatusMsg});e={uVersion:a.protoVersion,stUserPresenceChangedRes:{ullTransId:b.stUserPresenceChangedReq.stHdrs.ullTransId,sMobNu:a.localUser,retCodes:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RSP,e);break;case a.proto_msgType.values.E_USER_PENDING_NOTIFICATIONS_RQT:e={uVersion:a.protoVersion,
stUserPendingNotificationsRes:{ullTransId:b.stUserPendingNotificationsReq.stHdrs.ullTransId,sMobNu:a.localUser,retCodes:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP,e);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT:console.log("remote ice received");wr_recv_rem_ice(b.stSendIceCandidatesInDirectAVCallReq,b.stSendIceCandidatesInDirectAVCallReq.sCallId);e={uVersion:a.protoVersion,stSendIceCandidatesInDirectAVCallRes:{ullTransId:b.stSendIceCandidatesInDirectAVCallReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:b.stSendIceCandidatesInDirectAVCallReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP,e);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RQT:wr_recv_rem_ice(b.stSendIceCandidatesInCallReq,b.stSendIceCandidatesInCallReq.sCallId);e={uVersion:a.protoVersion,stSendIceCandidatesInCallReq:{ullTransId:b.stSendIceCandidatesInCallReq.stHdrs.ullTransId,sMobNu:a.localUser,sDstNumber:b.sendIceCandidatesInCallReq.sDstNumber,
ret:a.proto_retCodes.values.E_200_OK}};h(a,!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP,e);break;default:console.log("un handled message received "+d)}},D=function(a,c){c.is_provisional||a.connectionState==r.connected?a.transportType==v.socket?1==a.ws.readyState?a.ws.send(c.body):console.log("ws send failed connection state: "+a.ws.readyState):console.log("rest unsupported in current release"):console.log("Unable to send message before login completes")},h=function(a,c,b,f){f=a.proto_msg.encode(a.proto_msg.create(f)).finish();
var d=new ArrayBuffer(10+f.length),e=new DataView(d);e.setUint32(0,b,!1);e.setUint32(4,f.length,!1);e.setUint8(8,13,!1);e.setUint8(9,10,!1);for(b=0;b<f.length;b++)e.setUint8(10+b,f[b],!1);a.connectionState==r.connected||c?(1!=a.ws.readyState&&(a.reconnectTimeout=300,z()),D(a,{is_provisional:c,body:d})):a.msg_queue.push({is_provisional:c,body:d})},A=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;var f=new jsSHA("SHA-256","TEXT");f.update(a.localUser+a.OAuthToken);f=f.getHash("HEX");b={uVersion:a.protoVersion,
stLoginReq:{stHdrs:{sMobNu:a.localUser,sClientId:a.clientId,ullTransId:b},sPassHash:f,sAuth:"auth string",stOSName:a.proto_osType.values.E_WEB,sOSVersion:a.osVersion,sPushDevToken:"",sAppName:"appName",sDeviceId:c.CS.deviceId}};c.CS.appId&&c.CS.appSecret&&(b.stLoginReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:c.CS.appId,sAppSecret:c.CS.appSecret});h(a,!0,a.proto_msgType.values.E_LOGIN_RQT,b)},x=function(a,c){var b=new Uint8Array(a.byteLength+c.byteLength);b.set(new Uint8Array(a),0);b.set(new Uint8Array(c),
a.byteLength);return b.buffer},I=function(a,c){switch(y){case 0:if(10<=n+c.byteLength){k=x(k,c.slice(0,10-n));n=10;var b=new DataView(k);C=b.getUint32(0);w=b.getUint32(4);k=new ArrayBuffer(0);n=0;y=1;return 10}k=x(k,c);n+=c.byteLength;return c.byteLength;case 1:if(n+c.byteLength>=w){k=x(k,c.slice(0,w-n));b=new Uint8Array(k);try{var d=a.proto_msg.decode(b);H(a,C,d)}catch(g){console.log("error decoding message "+g)}finally{return k=new ArrayBuffer(0),y=n=0,w-n}}else return k=x(k,c),n+=c.byteLength,
c.byteLength}},z=function(){var a=c.CS;a.reconnectTimeout||(a.reconnectTimeout=300);if(a.transportType==v.socket){if(a.connectionState!=r.initiated){console.log("Connecting to server "+(new Date).toLocaleString());var d=new WebSocket(B);a.connectionState=r.initiated;d.binaryType="arraybuffer";d.onopen=function(){var a=c.CS;a.connectionState=r.connected;a.reconnectTimeout=300;console.log("websocket connected");a.connReady=!0;null!=a.localUser&&null!=a.OAuthToken&&(a.loggedin=!0,A(a,void 0));for(;0<
a.msg_queue.length;)D(a,a.msg_queue.shift())};d.onmessage=function(b){b=b.data;for(var c;0<b.byteLength;)c=I(a,b),0<c&&(b=b.slice(c))};d.onerror=function(a){};d.onclose=function(a){a=c.CS;console.log("websocket connection closed!. attempting to reconnect");a.tid&&clearTimeout(a.tid);a.tid=setTimeout(z,a.reconnectTimeout);a.reconnectTimeout*=2;3E5<a.reconnectTimeout&&(a.reconnectTimeout=3E5);a.connectionState=r.closed};c.onbeforeunload=function(a){this.connectionState==r.connected&&d.close()};a.ws=
d}}else A(a,void 0)},E=function(){};E.prototype.init=function(a){this["super"]=a};var t=function(){this.activeCallId=this.remoteUser="";this.states={IDLE:1,OFFER_SENT:2,OFFER_RECEIVED:3,RINGING_RECEIVED:4,CONNECTED:5};this.callObj={}};t.prototype.init=function(a){this["super"]=a};var q=function(){};q.prototype.init=function(a){this["super"]=a};q.prototype.setProfile=function(a,d,b,f){var g=m();c.CS.transactionRespCB[g]=f;a={uVersion:this["super"].protoVersion,stSetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:g},stProfile:{sUserName:a}}};d&&""!=d&&(a.stSetProfileReq.stProfile.sPresenceStatusMsg=d);b&&""!=b&&(a.stSetProfileReq.stProfile.sProfilePicId=b);h(this["super"],!1,this["super"].proto_msgType.values.E_SET_PROFILE_RQT,a)};q.prototype.getProfile=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;h(this["super"],!1,this["super"].proto_msgType.values.E_GET_PROFILE_RQT,{uVersion:this["super"].protoVersion,stGetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:b},sMobNum:a}})};q.prototype.getContacts=function(a){var d=m();c.CS.transactionRespCB[d]=a;h(this["super"],!1,this["super"].proto_msgType.values.E_GET_CONTACTS_RQT,{uVersion:this["super"].protoVersion,stGetContactsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d}}})};q.prototype.isAppContacts=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;h(this["super"],!1,this["super"].proto_msgType.values.E_IS_APP_CONTACT_RQT,
{uVersion:this["super"].protoVersion,stIsAppContactReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:b},uCount:a.length,sPhoneNums:a}})};q.prototype.onMessage=function(a){this.onpresenceupdatecb=a};q.prototype.addContact=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;h(this["super"],!1,this["super"].proto_msgType.values.E_ADD_NUM_RQT,{uVersion:this["super"].protoVersion,stAddNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,
ullTransId:b},uCount:1,sPhoneNums:[a],stContactTypes:[this["super"].contact_type.values.E_CUSTOM_CONTACT]}})};q.prototype.removeContact=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;h(this["super"],!1,this["super"].proto_msgType.values.E_DELETE_NUM_RQT,{uVersion:this["super"].protoVersion,stDeleteNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:b},sPhoneNums:a}})};q.prototype.getPresence=function(a,d){var b=m();c.CS.transactionRespCB[b]=d;h(this["super"],
!1,this["super"].proto_msgType.values.E_GET_PRESENCE_RQT,{uVersion:this["super"].protoVersion,stGetPresReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:b},sPhoneNums:a}})};var p=function(){this.chatSeqNo=1};p.prototype.init=function(a){this["super"]=a};p.prototype.onMessage=function(a){this.onMessagecb=a};p.prototype.ChatType={TEXT_PLAIN:1,TEXT_HTML:2,LOCATION:3,IMAGE:4,VIDEO:5,CONTACT:6,DOCUMENT:7};p.prototype.ChatFileType={IMAGE:4,VIDEO:5,DOCUMENT:7};t.prototype.getHistory=
function(a,d,b,f){var g=m();c.CS.transactionRespCB[g]=f;d={uVersion:this["super"].protoVersion,stGetCallHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:g},sPageSize:d,sOffset:b}};a&&(d.stGetCallHistoryListReq.sDstMobNu=a);h(this["super"],!1,this["super"].proto_msgType.values.E_GET_CALL_HISTORY_LIST_RQT,d)};p.prototype.getHistory=function(a,d,b,f){var g=m();c.CS.transactionRespCB[g]=f;d={uVersion:this["super"].protoVersion,stGetChatHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:g},sPageSize:d,sOffset:b}};a&&(d.stGetChatHistoryListReq.sDstMobNu=a);h(this["super"],!1,this["super"].proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RQT,d)};p.prototype.sendReadReceipt=function(a,d,b){var f=m();c.CS.transactionRespCB[f]=b;a={uVersion:this["super"].protoVersion,stChatReadReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:f},sDstMobNu:a,uChatID:d.toString(),uReadTime:Math.floor(ServerDate.now())}};h(this["super"],
!1,this["super"].proto_msgType.values.E_CHAT_READ_RQT,a)};p.prototype.sendDelivered=function(a,d,b,f){var g=m();c.CS.transactionRespCB[g]=f;a={uVersion:this["super"].protoVersion,stChatDeliveryReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:g},sDstMobNu:a,uChatID:d.toString(),uDeliveryTime:Math.floor(ServerDate.now()),reports_req:b}};h(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_DELIVERY_RQT,a)};q.prototype.getRecentContacts=function(a,d,b){var f=
m();c.CS.transactionRespCB[f]=b;h(this["super"],!1,this["super"].proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RQT,{uVersion:this["super"].protoVersion,stGetRecentConversationListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:f},sPageSize:a,sOffset:d}})};p.prototype.sendMessage=function(a,d,b,f,g){if(this["super"].localUser){var e=m();c.CS.transactionRespCB[e]=g;this.chatSeqNo++;g=u(16);var l=Math.floor(ServerDate.now());4E3<d.length&&(d=d.slice(0,4E3));
h(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RQT,{uVersion:this["super"].protoVersion,stChatReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sDstMobNu:a,uChatID:g,uSeqNum:this.chatSeqNo,uSendTime:l,stChatType:b,dataLen:d.length,reports_req:f,data:d}});return{id:g,sentTime:l}}g("400","User not logged in!")};var J=function(a){a=atob(a.split(",")[1]);for(var c=[],b=0;b<a.length;b++)c.push(a.charCodeAt(b));return new Blob([new Uint8Array(c)],{type:"image/png"})},
K=function(a,d,b,f,g,e,m,l,p,t){console.log("An image has been loaded");var k=new FileReader;k.onload=function(k){var q=new Image;q.onload=function(k){k=document.createElement("canvas");var n=q.width,r=q.height;n>r?200<n&&(r*=200/n,n=200):200<r&&(n*=200/r,r=200);k.width=n;k.height=r;k.getContext("2d").drawImage(q,0,0,n,r);k=k.toDataURL("image/png");k=J(k);var u="thumb_"+d;c.CS.s3.upload({Key:u,Body:k,ACL:"public-read"},function(d,k){if(d)return alert("There was an error uploading your photo: ",d.message);
var n={uVersion:c.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:c.CS.localUser,sClientId:c.CS.clientId,ullTransId:g},sDstMobNu:e,uChatID:m,uSeqNum:c.CS.chat.chatSeqNo,uSendTime:l,stChatType:p,dataLen:a.size,reports_req:t,data:f,sThumbnailUrl:u}};b&&(n.stChatReq.sContentType=b);h(c.CS,!1,c.CS.proto_msgType.values.E_CHAT_RQT,n);console.log("chat file sent out to server")})};q.src=k.target.result};k.readAsDataURL(a)};p.prototype.getMediaURLPrefix=function(){return"https://"+c.CS.s3Bin+".s3.ap-southeast-1.amazonaws.com/"};
p.prototype.sendPhoto=function(a,c,b){CA.chat.sendFile(a,l.chat.ChatFileType.IMAGE,c.type,"",c,!0,b)};p.prototype.sendVideo=function(a,c,b,f){CA.chat.sendFile(a,l.chat.ChatFileType.VIDEO,c.type,b,c,!0,f)};p.prototype.sendFile=function(a,c,b,f){CA.chat.sendFile(a,l.chat.ChatFileType.DOCUMENT,c.type,b,c,!0,f)};p.prototype.sendFile=function(a,d,b,f,g,e,k){if(!d||""==d||!g||""==g)return k(400,"invalid input. chatFileType or file content is empty"),-1;var l=m();c.CS.transactionRespCB[l]=k;this.chatSeqNo++;
var n=u(16),p=Math.floor(ServerDate.now()),q=u(15)+"_"+g.name;c.CS.s3.upload({Key:q,Body:g,ACL:"public-read"},function(k,m){if(k)return alert("There was an error uploading your photo: ",k.message);c.CS.respData[l]={fileName:q};if(g.type.match(/image.*/))K(g,q,b,m.Key,l,a,n,p,d,e);else{var r={uVersion:c.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:c.CS.localUser,sClientId:c.CS.clientId,ullTransId:l},sDstMobNu:a,uChatID:n,uSeqNum:c.CS.chat.chatSeqNo,uSendTime:p,stChatType:d,dataLen:g.size,reports_req:e,
data:m.Key}};b&&(r.stChatReq.sContentType=b);f&&""!=f&&(r.stChatReq.sThumbnailUrl=f);h(c.CS,!1,c.CS.proto_msgType.values.E_CHAT_RQT,r)}});return{id:n,sentTime:p,url:q}};p.prototype.getPendingChat=function(a){var d=m();c.CS.transactionRespCB[d]=a;h(this["super"],!1,this["super"].proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RQT,{uVersion:this["super"].protoVersion,stGetMyPendingNotificationsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d},sPendingNotificationType:this["super"].proto_pendingNotifType.values.E_CHAT_REQUEST}})};
p.prototype.sendIsTyping=function(a,c){var b=m();h(this["super"],!1,this["super"].proto_msgType.values.E_IS_TYPING_RQT,{uVersion:this["super"].protoVersion,stIsTypingReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:b},sDstMobNu:a,sGroupID:c}})};p.prototype.sendChatResponse=function(a){h(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RSP,{uVersion:this["super"].protoVersion,stChatRes:{ullTransId:a.stHdrs.ullTransId,sMobNu:this["super"].localUser,uChatID:a.uChatID.toString(),
ret:this["super"].proto_retCodes.values.E_200_OK}})};t.prototype.onMessage=function(a){this.onMessagecb=a};t.prototype.startCall=function(a,d,b,f,g){if(this["super"].localUser){this.isVideoCall=f;this.remoteUser=a;var e=u(16);wr_send_rem_call(this,e,f,d,b);this.callObj[e]={state:this.states.OFFER_SENT,remoteUser:a,type:"IP",direction:"OUT",isMuted:!1,iceCandidates:[]};c.CS.call.callToCb=g;return e}g("400","User not logged in!")};t.prototype.startPSTNCall=function(a,d,b,f,g){this.isVideoCall=f;this.remoteUser=
a;var e=u(16);wr_send_rem_call(this,e,f,d,b);this.callObj[e]={state:this.states.OFFER_SENT,remoteUser:a,type:"PSTN",direction:"OUT",isMuted:!1,iceCandidates:[]};c.CS.call.callToCb=g;return e};t.prototype.decline=function(a,d){this.callObj[a]?(this.declinecb=d,this.callObj[a].state=this.states.IDLE,c.CS.call.end(a,"User busy",function(a,c){console.log("user budy ret "+a)})):d(400,"Unknown callId")};t.prototype.answer=function(a,d,b,f){this.answercb=f;this.callObj[a].state=this.states.CONNECTED;""!=
this.activeCallId&&(f=this.activeCallId,c.CS.call.end(f,"Switched to another call",function(a,b){}),delete this.callObj[f]);this.activeCallId=a;wr_recv_rem_offer(a,d,this.isVideoCall,b,this.stDirectAudioVideoCallStartReq)};t.prototype.sendAnswer=function(a,d,b){var f=m();c.CS.transactionRespCB[f]=b;a={uVersion:this["super"].protoVersion,stDirectAudioVideoCallAnswerReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:f},sDstMobNu:this.remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,
sCallId:a,sSdp:d}};c.CS.call.isVideoCall||(a.stDirectAudioVideoCallAnswerReq.stCallType=this["super"].proto_callType.values.E_VOICECALL);h(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT,a);console.log("sent answer")};t.prototype.sendIce=function(a,d,b,f,g){var e=m();c.CS.transactionRespCB[e]=g;"IP"==c.CS.call.callObj[f].type?(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInDirectAVCallReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,
ullTransId:e},sDstNumber:a,sCallId:f.toString(),sIceCandidates:[d],sJsonIceCandidates:[b]}},h(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a)):"PSTN"==c.CS.call.callObj[f].type&&(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInCallReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sDstNumber:a,sCallId:f.toString(),sIceCandidates:[d],sJsonIceCandidates:[b],sDirection:this["super"].direction_enum.values.E_TO_SERVER,
sAppId:"webapp"}},h(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a))};t.prototype.end=function(a,d,b){this.callObj[a]?(this.activeCallId="",this.callObj[a].state=this.states.IDLE,d=m(),c.CS.transactionRespCB[d]=b,wr_send_rem_call_end(a),a={uVersion:this["super"].protoVersion,stDirectAudioVideoCallEndReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d},sDstMobNu:this.callObj[a].remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,
sCallId:a,sStopTime:Math.floor(ServerDate.now())}},c.CS.call.isVideoCall||(a.stDirectAudioVideoCallEndReq.stCallType=this["super"].proto_callType.values.E_VOICECALL),h(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT,a)):b(400,"Unknown callId")};t.prototype.mute=function(a,d,b){d?(wr_set_local_mute(this,a,b),c.CS.call.callObj[a].isMuted=!0):(wr_set_local_unmute(this,a,b),c.CS.call.callObj[a].isMuted=!1)};t.prototype.isMuted=function(a,c,b){return l.call.callObj[a].isMuted};
var L=function(a){protobuf.load("./res/iml4.json",function(c,b){if(c)throw c;a.proto_root=b;a.proto_msg=b.lookup("msg");a.proto_osType=b.lookup("osType");a.proto_retCodes=b.lookup("retCodes");a.proto_msgType=b.lookup("msgType");a.proto_pendingNotifType=b.lookup("pendingNotificationType");a.proto_chatType=b.lookup("chatType");a.proto_callType=b.lookup("callType");a.proto_isFocusStatus=b.lookup("appFocusStatus");a.direction_enum=b.lookup("sendDirection");a.contact_type=b.lookup("contactType");a.contactsStatus=
{293:{status:"PresenceUpdate"},81:{status:"ProfileChanged"},5:{status:"UserJoined"}};a.chatRequestType={9:"NEW-MESSAGE",10:"SENT",11:"DELIVERED",13:"READ",307:"IS-COMPOSING"};a.recentMsgType={0:{type:"UNKNOWN"},1:{type:"CHAT"},2:{type:"GROUP-CHAT"},3:{type:"CALL"}};a.chatStatus={0:{status:"Unknown"},1:{status:"SENT"},2:{status:"DELIVERED"},3:{status:"READ"}};a.chatType={0:{type:"Unknown"},1:{type:"Text"},2:{type:"html"},3:{type:"location"},4:{type:"image"},5:{type:"video"},6:{type:"contact"},7:{type:"document"}};
a.direction={0:{type:"Unknown"},1:{type:"Outgoing"},2:{type:"Incoming"}};a.callStatus={0:{status:"Unknown"},1:{status:"Missed"},2:{status:"Answered"}};a.callType={0:{type:"Unknown"},1:{type:"Audio"},2:{type:"Video"},3:{type:"Live-Location"},4:{type:"Pstn"}};a.callEventCode={187:{code:"PSTN-OFFER",phrase:"PSTN Call offer received"},193:{code:"ANSWERED",phrase:"Call answered received"},195:{code:"OFFER",phrase:"Call offer received"},197:{code:"ANSWERED",phrase:"Call answered received"},199:{code:"END",
phrase:"Call end received"},206:{code:"END",phrase:"Call end received"},295:{code:"RINGING",phrase:"Remote party ringing"}};a.imlrespcode={1:{code:200,phrase:"OK"},2:{code:202,phrase:"Created"},6:{code:204,phrase:"Resend Activation Code"},3:{code:401,phrase:"Unauthorized"},7:{code:403,phrase:"Forbiddon"},4:{code:409,phrase:"NotAllowed"},11:{code:499,phrase:"User Attached"},5:{code:500,phrase:"Internal Error"},10:{code:703,phrase:"Limit exceeded"}};a.protoLoad=!0})},l=function(){this.transportType=
"WebSocket"in c||c.WebSocket?v.socket:v.rest;this.transportType==v.rest&&alert("rest unsupported in current release");this.localuser="";this.OAuthToken=this.localUser=null;this.msg_queue=[];L(this);this.protoVersion=1;this.clientId=0;this.transactionRespCB={};this.respData={};this.s3Bin="";this.osName="Web";this.osVersion="-";this.chat=new p;this.chat.init(this);this.contacts=new q;this.contacts.init(this);this.call=new t;this.call.init(this);this.stream=new E;this.stream.init(this);this.subModulesLoadComplete=
!0},M=function(a){a=c.CS;a.protoLoad&&a.connReady&&(clearInterval(a.intervalTimer),$(c).on("blur focus",function(a){if($(this).data("prevType")!=a.type)switch(a.type){case "blur":console.log("blur");break;case "focus":console.log("focus")}$(this).data("prevType",a.type)}),a.initCb(200,"SDK initialized"))};l.prototype.askPushNotificationPermission=function(){OneSignal.push(function(){OneSignal.showHttpPrompt()})};l.prototype.initialize=function(a,d){this.version="0.2.10.2";0<arguments.length&&(this.initCb=
arguments[arguments.length-1]);this.intervalTimer=setInterval(function(){M(this)},200);var b="iamlivedemo1",f="ap-southeast-1",g="ap-southeast-1:cea94880-b040-46f5-8f91-550a9381142d";B="wss://proxy.connectarena.com:8989";c.CS.rtcservers={};c.CS.rtcservers.stun="stun:stun.l.google.com:19302";c.CS.rtcservers.turn="turn:34.253.104.58:3478?transport=udp";c.CS.rtcservers.turnUser="testuser";c.CS.rtcservers.turnPassword="test";c.CS.appId="";c.CS.appSecret="";2==arguments.length&&(a=arguments[0],b=a.s3Bucket||
b,f=a.s3Region||f,g=a.s3IdentityPoolId||g,c.CS.appId=a.appId||c.CS.appId,c.CS.appSecret=a.appSecret||c.CS.appSecret,a.webrtc&&(l.rtcservers.stun=a.webrtc.stun||l.stun,l.rtcservers.turn=a.webrtc.turn||l.turn,l.rtcservers.turnUser=a.webrtc.turnUser||l.turnUser,l.rtcservers.turnPassword=a.webrtc.turnPassword||l.turnPassword));c.CS.servers={iceServers:[{urls:c.CS.rtcservers.stun},{urls:c.CS.rtcservers.turn,username:c.CS.rtcservers.turnUser,credential:c.CS.rtcservers.turnPassword}]};AWS.config.update({region:f,
credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:g})});this.s3=new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:b}});setTimeout(z,100);(b=F("iml_dev_id"))?c.CS.deviceId=b:(c.CS.deviceId=m(),G("iml_dev_id",c.CS.deviceId,9999))};l.prototype.logout=function(){this.ws.close()};l.prototype.createTempUser=function(a,c,b){$.ajax({type:"POST",dataType:"json",url:"https://proxy.connectarena.com:9295/api/createuser",data:"username="+a+"&password="+c,success:function(d){"Created"==d?b(200,{user:a,
pass:c}):b(500,"Internal Error")},failure:function(){b(500,"Internal Error")}})};l.prototype.signUp=function(a,d,b){this.localUser=a;this.OAuthToken=d;a=m();c.CS.transactionRespCB[a]=b;b=new jsSHA("SHA-256","TEXT");b.update(this.localUser+this.OAuthToken);b=b.getHash("HEX");h(this,!0,this.proto_msgType.values.E_SIGNUP_RQT,{uVersion:this.protoVersion,stSignUpReq:{stHdrs:{sMobNu:this.localUser,sClientId:this.clientId,ullTransId:a},sPassHash:b,sAuth:"auth string",sAppName:"web-sdk",stOSName:this.proto_osType.values.E_WEB,
sOSVersion:this.osVersion}})};l.prototype.activate=function(a,d,b){var f=m();c.CS.transactionRespCB[f]=b;h(this,!0,this.proto_msgType.values.E_ACTIVATE_RQT,{uVersion:this.protoVersion,stActivateReq:{stHdrs:{sMobNu:a,sClientId:this.clientId,ullTransId:f},sActCode:d}})};l.prototype.send_msg=h;l.prototype.login=function(a,c,b){this.localUser=a;this.OAuthToken=c;try{OneSignal.push(["addListenerForNotificationOpened",function(a){console.log("Received NotificationOpened:");console.log(a);a=clients.matchAll({type:"window",
includeUncontrolled:!0}).then(function(a){for(var b=0;b<a.length;b++)console.log(winowClient)});event.waitUntil(a)}])}catch(f){console.log("one signal error "+f.message)}finally{}A(this,b)};c.CS=new l})(window,void 0);
