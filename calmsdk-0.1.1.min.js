function RecordRTC(b,a){function c(c){c&&(a.initCallback=function(){c();c=a.initCallback=null});p=new (new GetRecorderType(b,a))(b,a);p.record();x("recording");a.disableLogs||console.log("Initialized recorderType:",p.constructor.name,"for output-type:",a.type)}function d(b){function c(c){if(p){Object.keys(p).forEach(function(b){"function"!==typeof p[b]&&(g[b]=p[b])});var d=p.blob;if(!d)if(c)p.blob=d=c;else throw"Recording failed.";d&&!a.disableLogs&&console.log(d.type,"->",bytesToSize(d.size));b&&
(c=URL.createObjectURL(d),"function"===typeof b.call?b.call(g,c):b(c));a.autoWriteToDisk&&l(function(b){var c={};c[a.type+"Blob"]=b;DiskStorage.Store(c)})}else"function"===typeof b.call?b.call(g,""):b("")}b=b||function(){};p?"paused"===g.state?(g.resumeRecording(),setTimeout(function(){d(b)},1)):("recording"===g.state||a.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',g.state),a.disableLogs||console.log("Stopped recording "+a.type+" stream."),"gif"!==
a.type?p.stop(c):(p.stop(),c()),x("stopped")):n()}function f(b){postMessage((new FileReaderSync).readAsDataURL(b))}function l(b,c){function d(b){b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);URL.revokeObjectURL(b);return a}if(!b)throw"Pass a callback function over getDataURL.";var r=c?c.blob:(p||{}).blob;if(r)if("undefined"===typeof Worker||navigator.mozGetUserMedia){var g=new FileReader;g.readAsDataURL(r);
g.onload=function(a){b(a.target.result)}}else g=d(f),g.onmessage=function(a){b(a.data)},g.postMessage(r);else a.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){l(b,c)},1E3)}function u(b){b=b||0;"paused"===g.state?setTimeout(function(){u(b)},1E3):"stopped"!==g.state&&(b>=g.recordingDuration?d(g.onRecordingStopped):(b+=1E3,setTimeout(function(){u(b)},1E3)))}function x(b){if(g)if(g.state=b,"function"===typeof g.onStateChanged.call)g.onStateChanged.call(g,b);
else g.onStateChanged(b)}function n(){!0!==a.disableLogs&&console.warn(w)}if(!b)throw"First parameter is required.";a=a||{type:"video"};a=new RecordRTCConfiguration(b,a);var g=this,w='It seems that recorder is destroyed or "startRecording" is not invoked for '+a.type+" recorder.",p,t={startRecording:function(d){d&&(a=new RecordRTCConfiguration(b,d));a.disableLogs||console.log("started recording "+a.type+" stream.");if(p)return p.clearRecordedData(),p.record(),x("recording"),g.recordingDuration&&u(),
g;c(function(){g.recordingDuration&&u()});return g},stopRecording:d,pauseRecording:function(){p?"recording"!==g.state?a.disableLogs||console.warn("Unable to pause the recording. Recording state: ",g.state):(x("paused"),p.pause(),a.disableLogs||console.log("Paused recording.")):n()},resumeRecording:function(){p?"paused"!==g.state?a.disableLogs||console.warn("Unable to resume the recording. Recording state: ",g.state):(x("recording"),p.resume(),a.disableLogs||console.log("Resumed recording.")):n()},
initRecorder:c,setRecordingDuration:function(b,a){if("undefined"===typeof b)throw"recordingDuration is required.";if("number"!==typeof b)throw"recordingDuration must be a number.";g.recordingDuration=b;g.onRecordingStopped=a||function(){};return{onRecordingStopped:function(b){g.onRecordingStopped=b}}},clearRecordedData:function(){p?(p.clearRecordedData(),a.disableLogs||console.log("Cleared old recorded data.")):n()},getBlob:function(){if(p)return p.blob;n()},getDataURL:l,toURL:function(){if(p)return URL.createObjectURL(p.blob);
n()},getInternalRecorder:function(){return p},save:function(b){p?invokeSaveAsDialog(p.blob,b):n()},getFromDisk:function(b){p?RecordRTC.getFromDisk(a.type,b):n()},setAdvertisementArray:function(b){a.advertisement=[];for(var c=b.length,d=0;d<c;d++)a.advertisement.push({duration:d,image:b[d]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){p&&"function"===typeof p.clearRecordedData&&p.clearRecordedData();p=null;x("inactive");g.blob=null},onStateChanged:function(b){a.disableLogs||console.log("Recorder state changed:",
b)},state:"inactive",getState:function(){return g.state},destroy:function(){var b=a.disableLogs;a.disableLogs=!0;g.reset();a={};x("destroyed");t=g=null;Storage.AudioContextConstructor&&(Storage.AudioContextConstructor.close(),Storage.AudioContextConstructor=null);b||console.warn("RecordRTC is destroyed.")},version:"5.4.6"};if(!this)return g=t;for(var y in t)this[y]=t[y];g=this;return t}RecordRTC.version="5.4.6";"undefined"!==typeof module&&(module.exports=RecordRTC);
"function"===typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC});RecordRTC.getFromDisk=function(b,a){if(!a)throw"callback is mandatory.";console.log("Getting recorded "+("all"===b?"blobs":b+" blob ")+" from disk!");DiskStorage.Fetch(function(c,d){"all"!==b&&d===b+"Blob"&&a&&a(c);"all"===b&&a&&a(c,d.replace("Blob",""))})};
RecordRTC.writeToDisk=function(b){console.log("Writing recorded blob(s) to disk!");b=b||{};b.audio&&b.video&&b.gif?b.audio.getDataURL(function(a){b.video.getDataURL(function(c){b.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:a,videoBlob:c,gifBlob:b})})})}):b.audio&&b.video?b.audio.getDataURL(function(a){b.video.getDataURL(function(b){DiskStorage.Store({audioBlob:a,videoBlob:b})})}):b.audio&&b.gif?b.audio.getDataURL(function(a){b.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:a,
gifBlob:b})})}):b.video&&b.gif?b.video.getDataURL(function(a){b.gif.getDataURL(function(b){DiskStorage.Store({videoBlob:a,gifBlob:b})})}):b.audio?b.audio.getDataURL(function(b){DiskStorage.Store({audioBlob:b})}):b.video?b.video.getDataURL(function(b){DiskStorage.Store({videoBlob:b})}):b.gif&&b.gif.getDataURL(function(b){DiskStorage.Store({gifBlob:b})})};
function RecordRTCConfiguration(b,a){a.recorderType||a.type||(a.audio&&a.video?a.type="video":a.audio&&!a.video&&(a.type="audio"));a.recorderType&&!a.type&&(a.recorderType===WhammyRecorder||a.recorderType===CanvasRecorder?a.type="video":a.recorderType===GifRecorder?a.type="gif":a.recorderType===StereoAudioRecorder?a.type="audio":a.recorderType===MediaStreamRecorder&&(b.getAudioTracks().length&&b.getVideoTracks().length?a.type="video":b.getAudioTracks().length&&!b.getVideoTracks().length?a.type="audio":
!b.getAudioTracks().length&&b.getVideoTracks().length&&(a.type="audio")));"undefined"!==typeof MediaStreamRecorder&&"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(a.mimeType||(a.mimeType="video/webm"),a.type||(a.type=a.mimeType.split("/")[0]));a.type||(a.mimeType&&(a.type=a.mimeType.split("/")[0]),a.type||(a.type="audio"));return a}
function GetRecorderType(b,a){if(isChrome||isEdge||isOpera)var c=StereoAudioRecorder;"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(c=MediaStreamRecorder);"video"===a.type&&(isChrome||isOpera)&&(c=WhammyRecorder);"gif"===a.type&&(c=GifRecorder);"canvas"===a.type&&(c=CanvasRecorder);isMediaRecorderCompatible()&&c!==CanvasRecorder&&c!==GifRecorder&&"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(b.getVideoTracks&&b.getVideoTracks().length||
b.getAudioTracks&&b.getAudioTracks().length)&&("audio"===a.type?"function"===typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(c=MediaStreamRecorder):"function"===typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(c=MediaStreamRecorder));a.recorderType&&(c=a.recorderType);b instanceof Array&&b.length&&(c=MultiStreamRecorder);!a.disableLogs&&c&&c.name&&console.log("Using recorderType:",c.name||c.constructor.name);return c}
function MRecordRTC(b){this.addStream=function(a){a&&(b=a)};this.mediaType={audio:!0,video:!0};this.startRecording=function(){var a=this.mediaType,c=this.mimeType||{audio:null,video:null,gif:null};"function"!==typeof a.audio&&isMediaRecorderCompatible()&&b.getAudioTracks&&!b.getAudioTracks().length&&(a.audio=!1);"function"!==typeof a.video&&isMediaRecorderCompatible()&&b.getVideoTracks&&!b.getVideoTracks().length&&(a.video=!1);"function"!==typeof a.gif&&isMediaRecorderCompatible()&&b.getVideoTracks&&
!b.getVideoTracks().length&&(a.gif=!1);if(!a.audio&&!a.video&&!a.gif)throw"MediaStream must have either audio or video tracks.";if(a.audio){var d=null;"function"===typeof a.audio&&(d=a.audio);this.audioRecorder=new RecordRTC(b,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:d,mimeType:c.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp});a.video||this.audioRecorder.startRecording()}if(a.video){d=
null;"function"===typeof a.video&&(d=a.video);var f=b;if(isMediaRecorderCompatible()&&a.audio&&"function"===typeof a.audio){var l=b.getVideoTracks()[0];navigator.mozGetUserMedia?(f=new MediaStream,f.addTrack(l),d&&d===WhammyRecorder&&(d=MediaStreamRecorder)):f=new MediaStream([l])}this.videoRecorder=new RecordRTC(f,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:d,mimeType:c.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp});
a.audio||this.videoRecorder.startRecording()}if(a.audio&&a.video){var u=this;isMediaRecorderCompatible()?(u.audioRecorder=null,u.videoRecorder.startRecording()):u.videoRecorder.initRecorder(function(){u.audioRecorder.initRecorder(function(){u.videoRecorder.startRecording();u.audioRecorder.startRecording()})})}a.gif&&(d=null,"function"===typeof a.gif&&(d=a.gif),this.gifRecorder=new RecordRTC(b,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:d,
mimeType:c.gif}),this.gifRecorder.startRecording())};this.stopRecording=function(b){b=b||function(){};this.audioRecorder&&this.audioRecorder.stopRecording(function(a){b(a,"audio")});this.videoRecorder&&this.videoRecorder.stopRecording(function(a){b(a,"video")});this.gifRecorder&&this.gifRecorder.stopRecording(function(a){b(a,"gif")})};this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording();this.videoRecorder&&this.videoRecorder.pauseRecording();this.gifRecorder&&this.gifRecorder.pauseRecording()};
this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording();this.videoRecorder&&this.videoRecorder.resumeRecording();this.gifRecorder&&this.gifRecorder.resumeRecording()};this.getBlob=function(b){var a={};this.audioRecorder&&(a.audio=this.audioRecorder.getBlob());this.videoRecorder&&(a.video=this.videoRecorder.getBlob());this.gifRecorder&&(a.gif=this.gifRecorder.getBlob());b&&b(a);return a};this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=
null);this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null);this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)};this.getDataURL=function(b){function a(b,a){if("undefined"!==typeof Worker){var c=d(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});c.onmessage=function(b){a(b.data)};c.postMessage(b)}else c=new FileReader,c.readAsDataURL(b),c.onload=function(b){a(b.target.result)}}function d(b){b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+
b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);if("undefined"!==typeof URL)var c=URL;else if("undefined"!==typeof webkitURL)c=webkitURL;else throw"Neither URL nor webkitURL detected.";c.revokeObjectURL(b);return a}this.getBlob(function(c){c.audio&&c.video?a(c.audio,function(d){a(c.video,function(a){b({audio:d,video:a})})}):c.audio?a(c.audio,function(a){b({audio:a})}):c.video&&a(c.video,function(a){b({video:a})})})};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,
video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(b){b=b||{audio:!0,video:!0,gif:!0};b.audio&&this.audioRecorder&&this.audioRecorder.save("string"===typeof b.audio?b.audio:"");b.video&&this.videoRecorder&&this.videoRecorder.save("string"===typeof b.video?b.video:"");b.gif&&this.gifRecorder&&this.gifRecorder.save("string"===typeof b.gif?b.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;
"undefined"!==typeof RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";
(function(b){if(b&&"undefined"===typeof window&&"undefined"!==typeof global){global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}};global.console||(global.console={});if("undefined"===typeof global.console.log||"undefined"===typeof global.console.error)global.console.error=global.console.log=global.console.log||function(){console.log(arguments)};"undefined"===typeof document&&(b.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var b=
{getContext:function(){return b},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return b},b.HTMLVideoElement=function(){});"undefined"===typeof location&&(b.location={protocol:"file:",href:"",hash:""});"undefined"===typeof screen&&(b.screen={width:0,height:0});"undefined"===typeof URL&&(b.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}});b.window=global}})("undefined"!==typeof global?global:null);
var requestAnimationFrame=window.requestAnimationFrame;
if("undefined"===typeof requestAnimationFrame)if("undefined"!==typeof webkitRequestAnimationFrame)requestAnimationFrame=webkitRequestAnimationFrame;else if("undefined"!==typeof mozRequestAnimationFrame)requestAnimationFrame=mozRequestAnimationFrame;else if("undefined"!==typeof msRequestAnimationFrame)requestAnimationFrame=msRequestAnimationFrame;else if("undefined"===typeof requestAnimationFrame){var lastTime=0;requestAnimationFrame=function(b,a){var c=(new Date).getTime(),d=Math.max(0,16-(c-lastTime)),
f=setTimeout(function(){b(c+d)},d);lastTime=c+d;return f}}var cancelAnimationFrame=window.cancelAnimationFrame;"undefined"===typeof cancelAnimationFrame&&("undefined"!==typeof webkitCancelAnimationFrame?cancelAnimationFrame=webkitCancelAnimationFrame:"undefined"!==typeof mozCancelAnimationFrame?cancelAnimationFrame=mozCancelAnimationFrame:"undefined"!==typeof msCancelAnimationFrame?cancelAnimationFrame=msCancelAnimationFrame:"undefined"===typeof cancelAnimationFrame&&(cancelAnimationFrame=function(b){clearTimeout(b)}));
var AudioContext=window.AudioContext;"undefined"===typeof AudioContext&&("undefined"!==typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"===typeof URL&&"undefined"!==typeof webkitURL&&(URL=webkitURL);
"undefined"!==typeof navigator&&"undefined"===typeof navigator.getUserMedia&&("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));
var isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isSafari=-1<navigator.userAgent.toLowerCase().indexOf("safari/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia||isElectron()||isSafari,MediaStream=window.MediaStream;"undefined"===typeof MediaStream&&"undefined"!==typeof webkitMediaStream&&(MediaStream=webkitMediaStream);
"undefined"!==typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks().forEach(function(a){-1!==a.kind.toString().indexOf("video")&&b.push(a)});return b},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks().forEach(function(a){-1!==a.kind.toString().indexOf("audio")&&b.push(a)});return b}),"undefined"===typeof MediaStream.prototype.stop&&(MediaStream.prototype.stop=
function(){this.getTracks().forEach(function(b){b.stop()})}));function bytesToSize(b){if(0===b)return"0 Bytes";var a=parseInt(Math.floor(Math.log(b)/Math.log(1E3)),10);return(b/Math.pow(1E3,a)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][a]}
function invokeSaveAsDialog(b,a){if(!b)throw"Blob object is required.";if(!b.type)try{b.type="video/webm"}catch(f){}var c=(b.type||"video/webm").split("/")[1];a&&-1!==a.indexOf(".")&&(c=a.split("."),a=c[0],c=c[1]);c=(a||Math.round(9999999999*Math.random())+888888888)+"."+c;if("undefined"!==typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(b,c);if("undefined"!==typeof navigator.msSaveBlob)return navigator.msSaveBlob(b,c);var d=document.createElement("a");d.href=URL.createObjectURL(b);
d.download=c;d.style="display:none;opacity:0;color:transparent;";(document.body||document.documentElement).appendChild(d);"function"===typeof d.click?d.click():(d.target="_blank",d.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})));URL.revokeObjectURL(d.href)}
function isElectron(){return"undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type||"undefined"!==typeof process&&"object"===typeof process.versions&&process.versions.electron||"object"===typeof navigator&&"string"===typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron")?!0:!1}
function setSrcObject(b,a,c){if("createObjectURL"in URL&&!c)try{a.src=URL.createObjectURL(b)}catch(d){setSrcObject(b,a,!0)}else"srcObject"in a?a.srcObject=b:"mozSrcObject"in a?a.mozSrcObject=b:alert("createObjectURL/srcObject both are not supported.")}var Storage={};"undefined"!==typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!==typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext);"undefined"!==typeof RecordRTC&&(RecordRTC.Storage=Storage);
function isMediaRecorderCompatible(){var b=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),a=!!window.chrome&&!b||isElectron();if("undefined"!==typeof window.InstallTrigger)return!0;var c=navigator.userAgent,d=""+parseFloat(navigator.appVersion);parseInt(navigator.appVersion,10);var f;if(a||b)b=c.indexOf("Chrome"),d=c.substring(b+7);-1!==(f=d.indexOf(";"))&&(d=d.substring(0,f));-1!==(f=d.indexOf(" "))&&(d=d.substring(0,f));c=parseInt(""+d,10);isNaN(c)&&(parseFloat(navigator.appVersion),c=
parseInt(navigator.appVersion,10));return 49<=c}
function MediaStreamRecorder(b,a){function c(){u.timestamps.push((new Date).getTime());if("function"===typeof a.onTimeStamp)a.onTimeStamp(u.timestamps[u.timestamps.length-1],u.timestamps)}function d(b){return g&&g.mimeType?g.mimeType:b.mimeType||"video/webm"}function f(){n=[];g=null;u.timestamps=[]}function l(){if("active"in b){if(!b.active)return!1}else if("ended"in b&&b.ended)return!1;return!0}var u=this;if("undefined"===typeof b)throw'First argument "MediaStream" is required.';if("undefined"===
typeof MediaRecorder)throw"Your browser does not supports Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";a=a||{mimeType:"video/webm"};if("audio"===a.type){if(b.getVideoTracks().length&&b.getAudioTracks().length){if(navigator.mozGetUserMedia){var x=new MediaStream;x.addTrack(b.getAudioTracks()[0])}else x=new MediaStream(b.getAudioTracks());b=x}a.mimeType&&-1!==a.mimeType.toString().toLowerCase().indexOf("audio")||(a.mimeType=isChrome?"audio/webm":"audio/ogg");
a.mimeType&&"audio/ogg"!==a.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(a.mimeType="audio/ogg")}var n=[];this.getArrayOfBlobs=function(){return n};this.record=function(){u.blob=null;u.clearRecordedData();u.timestamps=[];w=[];n=[];var f=a;a.disableLogs||console.log("Passing following config over MediaRecorder API.",f);g&&(g=null);isChrome&&!isMediaRecorderCompatible()&&(f="video/vp8");"function"===typeof MediaRecorder.isTypeSupported&&f.mimeType&&!MediaRecorder.isTypeSupported(f.mimeType)&&
(a.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",f.mimeType),f.mimeType="audio"===a.type?"audio/webm":"video/webm");try{g=new MediaRecorder(b,f),a.mimeType=f.mimeType}catch(t){g=new MediaRecorder(b)}f.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in g&&!1===g.canRecordMimeType(f.mimeType)&&(a.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",f.mimeType));g.ignoreMutedMedia=!0===a.ignoreMutedMedia;g.ondataavailable=function(b){b.data&&
w.push("ondataavailable: "+bytesToSize(b.data.size));"number"===typeof a.timeSlice?b.data&&b.data.size&&100<b.data.size&&(n.push(b.data),c(),"function"===typeof a.ondataavailable&&(b=a.getNativeBlob?b.data:new Blob([b.data],{type:d(f)}),a.ondataavailable(b))):!b.data||!b.data.size||100>b.data.size||u.blob?u.recordingCallback&&(u.recordingCallback(new Blob([],{type:d(f)})),u.recordingCallback=null):(u.blob=a.getNativeBlob?b.data:new Blob([b.data],{type:d(f)}),u.recordingCallback&&(u.recordingCallback(u.blob),
u.recordingCallback=null))};g.onstart=function(){w.push("started")};g.onpause=function(){w.push("paused")};g.onresume=function(){w.push("resumed")};g.onstop=function(){w.push("stopped")};g.onerror=function(b){w.push("error: "+b);a.disableLogs||(-1!==b.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",b):-1!==b.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",
f.mimeType,") is not supported.",b):-1!==b.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",b):"OutOfMemory"===b.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"IllegalStreamModification"===b.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",
b):"OtherRecordingError"===b.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"GenericError"===b.name?console.error("The UA cannot provide the codec or recording option that has been requested.",b):console.error("MediaRecorder Error",b));!u.manuallyStopped&&g&&"inactive"===g.state?(delete a.timeslice,g.start(6E5)):setTimeout(void 0,1E3);"inactive"!==g.state&&"stopped"!==g.state&&
g.stop()};"number"===typeof a.timeSlice?(c(),g.start(a.timeSlice)):g.start(36E5);a.initCallback&&a.initCallback()};this.timestamps=[];this.stop=function(b){u.manuallyStopped=!0;g&&(this.recordingCallback=b||function(){},"recording"===g.state&&g.stop(),"number"===typeof a.timeSlice&&setTimeout(function(){u.blob=new Blob(n,{type:d(a)});u.recordingCallback(u.blob)},100))};this.pause=function(){g&&"recording"===g.state&&g.pause()};this.resume=function(){g&&"paused"===g.state&&g.resume()};this.clearRecordedData=
function(){g&&"recording"===g.state&&u.stop(f);f()};var g;this.getInternalRecorder=function(){return g};this.blob=null;this.getState=function(){return g?g.state||"inactive":"inactive"};var w=[];this.getAllStates=function(){return w};"undefined"===typeof a.checkForInactiveTracks&&(a.checkForInactiveTracks=!1);u=this;(function t(){g&&!1!==a.checkForInactiveTracks&&(!1===l()?(a.disableLogs||console.log("MediaStream seems stopped."),u.stop()):setTimeout(t,1E3))})();this.name="MediaStreamRecorder";this.toString=
function(){return this.name}}"undefined"!==typeof RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder);
function StereoAudioRecorder(b,a){function c(){if(!1===a.checkForInactiveTracks)return!0;if("active"in b){if(!b.active)return!1}else if("ended"in b&&b.ended)return!1;return!0}function d(b,a){function h(b,h){function a(b,h,a){h=Math.round(h/a*b.length);a=[];var e=Number((b.length-1)/(h-1));a[0]=b[0];for(var c=1;c<h-1;c++){var k=c*e,C=Number(Math.floor(k)).toFixed(),d=Number(Math.ceil(k)).toFixed(),v=b[C];a[c]=v+(b[d]-v)*(k-C)}a[h-1]=b[b.length-1];return a}function e(b,h){for(var a=new Float64Array(h),
e=0,c=b.length,k=0;k<c;k++){var C=b[k];a.set(C,e);e+=C.length}return a}function c(b,h){for(var a=b.length+h.length,e=new Float64Array(a),c=0,k=0;k<a;)e[k++]=b[c],e[k++]=h[c],c++;return e}function k(b,h,a){for(var e=a.length,c=0;c<e;c++)b.setUint8(h+c,a.charCodeAt(c))}var d=b.numberOfAudioChannels,C=b.leftBuffers.slice(0),v=b.rightBuffers.slice(0),m=b.sampleRate,f=b.internalInterleavedLength,q=b.desiredSampRate;2===d&&(C=e(C,f),v=e(v,f),q&&(C=a(C,q,m),v=a(v,q,m)));1===d&&(C=e(C,f),q&&(C=a(C,q,m)));
q&&(m=q);var r;2===d&&(r=c(C,v));1===d&&(r=C);C=r.length;v=new ArrayBuffer(44+2*C);f=new DataView(v);k(f,0,"RIFF");f.setUint32(4,44+2*C,!0);k(f,8,"WAVE");k(f,12,"fmt ");f.setUint32(16,16,!0);f.setUint16(20,1,!0);f.setUint16(22,d,!0);f.setUint32(24,m,!0);f.setUint32(28,2*m,!0);f.setUint16(32,2*d,!0);f.setUint16(34,16,!0);k(f,36,"data");f.setUint32(40,2*C,!0);d=44;for(m=0;m<C;m++)f.setInt16(d,32767*r[m],!0),d+=2;if(h)return h({buffer:v,view:f});postMessage({buffer:v,view:f})}if(isEdge||isOpera||isSafari||
b.noWorker)h(b,function(b){a(b.buffer,b.view)});else{var c=f(h);c.onmessage=function(b){a(b.data.buffer,b.data.view);URL.revokeObjectURL(c.workerURL)};c.postMessage(b)}}function f(b){b=URL.createObjectURL(new Blob([b.toString(),";this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);a.workerURL=b;return a}function l(){g=[];w=[];t=0;H=p=m=!1;z=null;n.leftchannel=g;n.rightchannel=w;n.numberOfAudioChannels=y;n.desiredSampRate=r;n.sampleRate=B;n.recordingLength=
t;q=[];F=[];I=0}function u(){D&&(D.onaudioprocess=null,D.disconnect(),D=null);A&&(A.disconnect(),A=null);l()}function x(){p&&"function"===typeof a.ondataavailable&&"undefined"!==typeof a.timeSlice&&(q.length?(d({desiredSampRate:r,sampleRate:B,numberOfAudioChannels:y,internalInterleavedLength:I,leftBuffers:q,rightBuffers:1===y?[]:F},function(b,c){var h=new Blob([c],{type:"audio/wav"});a.ondataavailable(h);setTimeout(x,a.timeSlice)}),q=[],F=[],I=0):setTimeout(x,a.timeSlice))}if(!b.getAudioTracks().length)throw"Your stream has no audio tracks.";
a=a||{};var n=this,g=[],w=[],p=!1,t=0,y=2,r=a.desiredSampRate;!0===a.leftChannel&&(y=1);1===a.numberOfAudioChannels&&(y=1);if(!y||1>y)y=2;a.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: ",y);"undefined"===typeof a.checkForInactiveTracks&&(a.checkForInactiveTracks=!0);this.record=function(){if(!1===c())throw"Please make sure MediaStream is active.";l();m=H=!1;p=!0;"undefined"!==typeof a.timeSlice&&x()};this.stop=function(b){b=b||function(){};p=!1;d({desiredSampRate:r,
sampleRate:B,numberOfAudioChannels:y,internalInterleavedLength:t,leftBuffers:g,rightBuffers:1===y?[]:w},function(a,h){n.blob=new Blob([h],{type:"audio/wav"});n.buffer=new ArrayBuffer(h.buffer.byteLength);n.view=h;n.sampleRate=r||B;n.bufferSize=G;n.length=t;m=!1;b&&b(n.blob)})};Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext);var z=Storage.AudioContextConstructor,A=z.createMediaStreamSource(b),J=[0,256,512,1024,2048,4096,8192,16384],G="undefined"===typeof a.bufferSize?
4096:a.bufferSize;-1===J.indexOf(G)&&(a.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(J,null,"\t")));if(z.createJavaScriptNode)var D=z.createJavaScriptNode(G,y,y);else if(z.createScriptProcessor)D=z.createScriptProcessor(G,y,y);else throw"WebAudio API has no support on this browser.";A.connect(D);a.bufferSize||(G=D.bufferSize);var B="undefined"!==typeof a.sampleRate?a.sampleRate:z.sampleRate||44100;if(22050>B||96E3<B)a.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.");
a.disableLogs||(console.log("sample-rate",B),console.log("buffer-size",G),a.desiredSampRate&&console.log("Desired sample-rate",a.desiredSampRate));var H=!1;this.pause=function(){H=!0};this.resume=function(){if(!1===c())throw"Please make sure MediaStream is active.";p?H=!1:(a.disableLogs||console.log("Seems recording has been restarted."),this.record())};this.clearRecordedData=function(){a.checkForInactiveTracks=!1;p&&this.stop(u);u()};this.name="StereoAudioRecorder";this.toString=function(){return this.name};
var m=!1;D.onaudioprocess=function(b){if(!H)if(!1===c()&&(a.disableLogs||console.log("MediaStream seems stopped."),D.disconnect(),p=!1),p){if(!m){m=!0;if(a.onAudioProcessStarted)a.onAudioProcessStarted();a.initCallback&&a.initCallback()}var d=b.inputBuffer.getChannelData(0);d=new Float32Array(d);g.push(d);if(2===y){b=b.inputBuffer.getChannelData(1);var h=new Float32Array(b);w.push(h)}t+=G;n.recordingLength=t;"undefined"!==typeof a.timeSlice&&(I+=G,q.push(d),2===y&&F.push(h))}else A&&(A.disconnect(),
A=null)};D.connect(z.destination);this.leftchannel=g;this.rightchannel=w;this.numberOfAudioChannels=y;this.desiredSampRate=r;this.sampleRate=B;n.recordingLength=t;var q=[],F=[],I=0}"undefined"!==typeof RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder);
function CanvasRecorder(b,a){function c(){r.frames=[];t=p=!1}function d(){var a=document.createElement("canvas"),c=a.getContext("2d");a.width=b.width;a.height=b.height;c.drawImage(b,0,0);return a}function f(){if(t)return y=(new Date).getTime(),setTimeout(f,500);if("canvas"===b.nodeName.toLowerCase()){var c=(new Date).getTime()-y;y=(new Date).getTime();r.frames.push({image:d(),duration:c});p&&setTimeout(f,a.frameInterval)}else html2canvas(b,{grabMouse:"undefined"===typeof a.showMousePointer||a.showMousePointer,
onrendered:function(b){var c=(new Date).getTime()-y;if(!c)return setTimeout(f,a.frameInterval);y=(new Date).getTime();r.frames.push({image:b.toDataURL("image/webp",1),duration:c});p&&setTimeout(f,a.frameInterval)}})}if("undefined"===typeof html2canvas)throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";a=a||{};a.frameInterval||(a.frameInterval=10);var l=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(b){b in document.createElement("canvas")&&(l=!0)});
var u=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,x=50,n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);u&&n&&n[2]&&(x=parseInt(n[2],10));u&&52>x&&(l=!1);var g;if(l)if(a.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),b instanceof HTMLCanvasElement)var w=b;else if(b instanceof CanvasRenderingContext2D)w=b.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&
(a.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var p;this.record=function(){p=!0;if(l&&!a.useWhammyRecorder){var b;"captureStream"in w?b=w.captureStream(25):"mozCaptureStream"in w?b=w.mozCaptureStream(25):"webkitCaptureStream"in w&&(b=w.webkitCaptureStream(25));try{var c=new MediaStream;c.addTrack(b.getVideoTracks()[0]);b=c}catch(J){}if(!b)throw"captureStream API are NOT available.";g=new MediaStreamRecorder(b,{mimeType:"video/webm"});g.record()}else r.frames=[],y=
(new Date).getTime(),f();a.initCallback&&a.initCallback()};this.getWebPImages=function(c){if("canvas"===b.nodeName.toLowerCase()){var d=r.frames.length;r.frames.forEach(function(b,c){var f=d-c;a.disableLogs||console.log(f+"/"+d+" frames remaining");if(a.onEncodingCallback)a.onEncodingCallback(f,d);f=b.image.toDataURL("image/webp",1);r.frames[c].image=f});a.disableLogs||console.log("Generating WebM")}c()};this.stop=function(b){p=!1;var c=this;l&&g?g.stop(b):this.getWebPImages(function(){r.compile(function(d){a.disableLogs||
console.log("Recording finished!");c.blob=d;c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"}));b&&b(c.blob);r.frames=[]})})};var t=!1;this.pause=function(){t=!0;g instanceof MediaStreamRecorder&&g.pause()};this.resume=function(){t=!1;g instanceof MediaStreamRecorder?g.resume():p||this.record()};this.clearRecordedData=function(){p&&this.stop(c);c()};this.name="CanvasRecorder";this.toString=function(){return this.name};var y=(new Date).getTime(),r=new Whammy.Video(100)}
"undefined"!==typeof RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder);
function WhammyRecorder(b,a){function c(b){b="undefined"!==typeof b?b:10;var a=(new Date).getTime()-p;if(!a)return setTimeout(c,b,b);if(x)return p=(new Date).getTime(),setTimeout(c,100);p=(new Date).getTime();w.paused&&w.play();g.drawImage(w,0,0,n.width,n.height);t.frames.push({duration:a,image:n.toDataURL("image/webp")});u||setTimeout(c,b,b)}function d(b){var a=-1,c=b.length;(function J(){a++;a===c?b.callback():setTimeout(function(){b.functionToLoop(J,a)},1)})()}function f(b,a,c,f,g){var r=document.createElement("canvas");
r.width=n.width;r.height=n.height;var J=r.getContext("2d"),l=[],u=-1===a,m=a&&0<a&&a<=b.length?a:b.length,q=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),y=c&&0<=c&&1>=c?c:0,I=f&&0<=f&&1>=f?f:0,v=!1;d({length:m,functionToLoop:function(a,h){var c,e,d,f=function(){!v&&d-c<=d*I||(u&&(v=!0),l.push(b[h]));a()};if(v)f();else{var m=new Image;m.onload=function(){J.drawImage(m,0,0,n.width,n.height);var b=J.getImageData(0,0,n.width,n.height);c=0;e=b.data.length;d=b.data.length/4;for(var h=0;h<
e;h+=4)Math.sqrt(Math.pow(b.data[h]-0,2)+Math.pow(b.data[h+1]-0,2)+Math.pow(b.data[h+2]-0,2))<=q*y&&c++;f()};m.src=b[h].image}},callback:function(){l=l.concat(b.slice(m));0>=l.length&&l.push(b[b.length-1]);g(l)}})}function l(){t.frames=[];u=!0;x=!1}a=a||{};a.frameInterval||(a.frameInterval=10);a.disableLogs||console.log("Using frames-interval:",a.frameInterval);this.record=function(){a.width||(a.width=320);a.height||(a.height=240);a.video||(a.video={width:a.width,height:a.height});a.canvas||(a.canvas=
{width:a.width,height:a.height});n.width=a.canvas.width||320;n.height=a.canvas.height||240;g=n.getContext("2d");a.video&&a.video instanceof HTMLVideoElement?(w=a.video.cloneNode(),a.initCallback&&a.initCallback()):(w=document.createElement("video"),setSrcObject(b,w),w.onloadedmetadata=function(){a.initCallback&&a.initCallback()},w.width=a.video.width,w.height=a.video.height);w.muted=!0;w.play();p=(new Date).getTime();t=new Whammy.Video;a.disableLogs||(console.log("canvas resolutions",n.width,"*",
n.height),console.log("video width/height",w.width||n.width,"*",w.height||n.height));c(a.frameInterval)};var u=!1;this.stop=function(b){b=b||function(){};u=!0;var c=this;setTimeout(function(){f(t.frames,-1,null,null,function(d){t.frames=d;a.advertisement&&a.advertisement.length&&(t.frames=a.advertisement.concat(t.frames));t.compile(function(a){c.blob=a;c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"}));b&&b(c.blob)})})},10)};var x=!1;this.pause=function(){x=!0};this.resume=function(){x=!1;
u&&this.record()};this.clearRecordedData=function(){u||this.stop(l);l()};this.name="WhammyRecorder";this.toString=function(){return this.name};var n=document.createElement("canvas"),g=n.getContext("2d"),w,p,t}"undefined"!==typeof RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);
var Whammy=function(){function b(b){this.frames=[];this.duration=b||1;this.quality=.8}function a(b){b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);URL.revokeObjectURL(b);return a}function c(b){function a(b,a,c){return[{data:b,id:231}].concat(c.map(function(b){var c=g({discardable:0,frame:b.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(a)});a+=b.duration;return{data:c,
id:163}}))}function c(b){for(var a=[];0<b;)a.push(b&255),b>>=8;return new Uint8Array(a.reverse())}function d(b){return new Uint8Array(b.split("").map(function(b){return b.charCodeAt(0)}))}function x(b){var a=[];b=(b.length%8?Array(9-b.length%8).join("0"):"")+b;for(var c=0;c<b.length;c+=8)a.push(parseInt(b.substr(c,8),2));return new Uint8Array(a)}function n(b){for(var a=[],f=0;f<b.length;f++){var g=b[f].data;"object"===typeof g&&(g=n(g));"number"===typeof g&&(g=x(g.toString(2)));"string"===typeof g&&
(g=d(g));var l=g.size||g.byteLength||g.length,u=Math.ceil(Math.ceil(Math.log(l)/Math.log(2))/8);l=l.toString(2);l=Array(7*u+8-l.length).join("0")+l;u=Array(u).join("0")+"1"+l;a.push(c(b[f].id));a.push(x(u));a.push(g)}return new Blob(a,{type:"video/webm"})}function g(b){var a=0;b.keyframe&&(a|=128);b.invisible&&(a|=8);b.lacing&&(a|=b.lacing<<1);b.discardable&&(a|=1);if(127<b.trackNum)throw"TrackNumber > 127 not supported";return[b.trackNum|128,b.timecode>>8,b.timecode&255,a].map(function(b){return String.fromCharCode(b)}).join("")+
b.frame}function w(b,a){return parseInt(b.substr(a+4,4).split("").map(function(b){b=b.charCodeAt(0).toString(2);return Array(8-b.length+1).join("0")+b}).join(""),2)}function p(b){for(var a=0,c={};a<b.length;){var d=b.substr(a,4),f=w(b,a),g=b.substr(a+4+4,f);a+=8+f;c[d]=c[d]||[];"RIFF"===d||"LIST"===d?c[d].push(p(g)):c[d].push(g)}return c}function t(b){return[].slice.call(new Uint8Array((new Float64Array([b])).buffer),0).map(function(b){return String.fromCharCode(b)}).reverse().join("")}b=new function(b){if(b[0]){for(var c=
b[0].width,d=b[0].height,f=b[0].duration,g=1;g<b.length;g++)f+=b[g].duration;c={duration:f,width:c,height:d}}else postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."}),c=void 0;if(!c)return[];c=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},
{data:t(c.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:c.width,id:176},{data:c.height,id:186}]}]}]}]}];for(f=d=0;d<b.length;){var l=[];g=0;do l.push(b[d]),g+=b[d].duration,d++;while(d<b.length&&3E4>g);l={id:524531317,data:a(f,0,l)};c[1].data.push(l);f+=g}return n(c)}(b.map(function(b){for(var a=p(atob(b.image.slice(23))),c=a.RIFF[0].WEBP[0],
d=c.indexOf("\u009d\u0001*"),f=0,g=[];4>f;f++)g[f]=c.charCodeAt(d+3+f);f=g[1]<<8|g[0];d=f&16383;f=g[3]<<8|g[2];a={width:d,height:f&16383,data:c,riff:a};a.duration=b.duration;return a}));postMessage(b)}b.prototype.add=function(b,a){"canvas"in b&&(b=b.canvas);"toDataURL"in b&&(b=b.toDataURL("image/webp",this.quality));if(!/^data:image\/webp;base64,/ig.test(b))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:b,duration:a||this.duration})};
b.prototype.compile=function(b){var d=a(c);d.onmessage=function(a){a.data.error?console.error(a.data.error):b(a.data)};d.postMessage(this.frames)};return{Video:b}}();"undefined"!==typeof RecordRTC&&(RecordRTC.Whammy=Whammy);
var DiskStorage={init:function(){function b(){function b(b){c.objectStore(a.dataStoreName).get(b).onsuccess=function(c){a.callback&&a.callback(c.target.result,b)}}var c=d.transaction([a.dataStoreName],"readwrite");a.videoBlob&&c.objectStore(a.dataStoreName).put(a.videoBlob,"videoBlob");a.gifBlob&&c.objectStore(a.dataStoreName).put(a.gifBlob,"gifBlob");a.audioBlob&&c.objectStore(a.dataStoreName).put(a.audioBlob,"audioBlob");b("audioBlob");b("videoBlob");b("gifBlob")}var a=this;if("undefined"===typeof indexedDB||
"undefined"===typeof indexedDB.open)console.error("IndexedDB API are not available in this browser.");else{var c=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),d,f=indexedDB.open(c,1);f.onerror=a.onError;f.onsuccess=function(){d=f.result;d.onerror=a.onError;d.setVersion?1!==d.version?d.setVersion(1).onsuccess=function(){d.createObjectStore(a.dataStoreName);b()}:b():b()};f.onupgradeneeded=function(b){b.target.result.createObjectStore(a.dataStoreName)}}},Fetch:function(b){this.callback=
b;this.init();return this},Store:function(b){this.audioBlob=b.audioBlob;this.videoBlob=b.videoBlob;this.gifBlob=b.gifBlob;this.init();return this},onError:function(b){console.error(JSON.stringify(b,null,"\t"))},dataStoreName:"recordRTC",dbName:null};"undefined"!==typeof RecordRTC&&(RecordRTC.DiskStorage=DiskStorage);
function GifRecorder(b,a){if("undefined"===typeof GIFEncoder){var c=document.createElement("script");c.src="https://cdn.webrtc-experiment.com/gif-recorder.js";(document.body||document.documentElement).appendChild(c)}a=a||{};var d=b instanceof CanvasRenderingContext2D||b instanceof HTMLCanvasElement;this.record=function(){function b(c){if(!0!==t.clearedRecordedData){if(f)return setTimeout(function(){b(c)},100);g=requestAnimationFrame(b);if(!(90>c-w)){!d&&n.paused&&n.play();d||u.drawImage(n,0,0,l.width,
l.height);if(a.onGifPreview)a.onGifPreview(l.toDataURL("image/png"));p.addFrame(u);w=c}}}if("undefined"===typeof GIFEncoder)setTimeout(t.record,1E3);else if(x){d||(a.width||(a.width=n.offsetWidth||320),a.height||(a.height=n.offsetHeight||240),a.video||(a.video={width:a.width,height:a.height}),a.canvas||(a.canvas={width:a.width,height:a.height}),l.width=a.canvas.width||320,l.height=a.canvas.height||240,n.width=a.video.width||320,n.height=a.video.height||240);p=new GIFEncoder;p.setRepeat(0);p.setDelay(a.frameRate||
200);p.setQuality(a.quality||10);p.start();if("function"===typeof a.onGifRecordingStarted)a.onGifRecordingStarted();Date.now();g=requestAnimationFrame(b);a.initCallback&&a.initCallback()}else setTimeout(t.record,1E3)};this.stop=function(b){b=b||function(){};g&&cancelAnimationFrame(g);Date.now();this.blob=new Blob([new Uint8Array(p.stream().bin)],{type:"image/gif"});b(this.blob);p.stream().bin=[]};var f=!1;this.pause=function(){f=!0};this.resume=function(){f=!1};this.clearRecordedData=function(){t.clearedRecordedData=
!0;p&&(p.stream().bin=[])};this.name="GifRecorder";this.toString=function(){return this.name};var l=document.createElement("canvas"),u=l.getContext("2d");d&&(b instanceof CanvasRenderingContext2D?(u=b,l=u.canvas):b instanceof HTMLCanvasElement&&(u=b.getContext("2d"),l=b));var x=!0;if(!d){var n=document.createElement("video");n.muted=!0;n.autoplay=!0;x=!1;n.onloadedmetadata=function(){x=!0};setSrcObject(b,n);n.play()}var g=null,w,p,t=this}"undefined"!==typeof RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);
function MultiStreamsMixer(b){function a(b,c,d){if("createObjectURL"in r&&!d)try{c.src=r.createObjectURL(b)}catch(B){a(b,c,!0)}else"srcObject"in c?c.srcObject=b:"mozSrcObject"in c?c.mozSrcObject=b:alert("createObjectURL/srcObject both are not supported.")}function c(){if(!g){var b=n.length,a=!1,f=[];n.forEach(function(b){b.stream||(b.stream={});b.stream.fullcanvas?a=b:f.push(b)});if(a)w.width=a.stream.width,w.height=a.stream.height;else if(f.length){w.width=1<b?2*f[0].width:f[0].width;var l=1;if(3===
b||4===b)l=2;if(5===b||6===b)l=3;if(7===b||8===b)l=4;if(9===b||10===b)l=5;w.height=f[0].height*l}else w.width=t.width||360,w.height=t.height||240;a&&a instanceof HTMLVideoElement&&d(a);f.forEach(function(b,a){d(b,a)});setTimeout(c,t.frameInterval)}}function d(b,a){if(!g){var c=0,d=0,f=b.width,m=b.height;1===a&&(c=b.width);2===a&&(d=b.height);3===a&&(c=b.width,d=b.height);4===a&&(d=2*b.height);5===a&&(c=b.width,d=2*b.height);6===a&&(d=3*b.height);7===a&&(c=b.width,d=3*b.height);"undefined"!==typeof b.stream.left&&
(c=b.stream.left);"undefined"!==typeof b.stream.top&&(d=b.stream.top);"undefined"!==typeof b.stream.width&&(f=b.stream.width);"undefined"!==typeof b.stream.height&&(m=b.stream.height);p.drawImage(b,c,d,f,m);if("function"===typeof b.stream.onRender)b.stream.onRender(p,c,d,f,m,a)}}function f(){x();var b;"captureStream"in w?b=w.captureStream():"mozCaptureStream"in w?b=w.mozCaptureStream():t.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");
var a=new z;b.getVideoTracks().forEach(function(b){a.addTrack(b)});return w.stream=a}function l(){A.AudioContextConstructor||(A.AudioContextConstructor=new A.AudioContext);t.audioContext=A.AudioContextConstructor;t.audioSources=[];!0===t.useGainNode&&(t.gainNode=t.audioContext.createGain(),t.gainNode.connect(t.audioContext.destination),t.gainNode.gain.value=0);var a=0;b.forEach(function(b){b.getAudioTracks().length&&(a++,b=t.audioContext.createMediaStreamSource(b),!0===t.useGainNode&&b.connect(t.gainNode),
t.audioSources.push(b))});if(a)return t.audioDestination=t.audioContext.createMediaStreamDestination(),t.audioSources.forEach(function(b){b.connect(t.audioDestination)}),t.audioDestination.stream}function u(b){var c=document.createElement("video");a(b,c);c.muted=!0;c.volume=0;c.width=b.width||t.width||360;c.height=b.height||t.height||240;c.play();return c}function x(a){n=[];a=a||b;a.forEach(function(b){if(b.getVideoTracks().length){var a=u(b);a.stream=b;n.push(a)}})}var n=[],g=!1,w=document.createElement("canvas"),
p=w.getContext("2d");w.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000; margin-top:-1000000000;margin-left:-1000000000;";(document.body||document.documentElement).appendChild(w);this.disableLogs=!1;this.frameInterval=10;this.width=360;this.height=240;this.useGainNode=!0;var t=this,y=window.AudioContext;"undefined"===typeof y&&("undefined"!==typeof webkitAudioContext&&(y=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(y=mozAudioContext));var r=window.URL;"undefined"===
typeof r&&"undefined"!==typeof webkitURL&&(r=webkitURL);"undefined"!==typeof navigator&&"undefined"===typeof navigator.getUserMedia&&("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var z=window.MediaStream;"undefined"===typeof z&&"undefined"!==typeof webkitMediaStream&&(z=webkitMediaStream);"undefined"!==typeof z&&("getVideoTracks"in z.prototype||
(z.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks.forEach(function(a){-1!==a.kind.toString().indexOf("video")&&b.push(a)});return b},z.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks.forEach(function(a){-1!==a.kind.toString().indexOf("audio")&&b.push(a)});return b}),"undefined"===typeof z.prototype.stop&&(z.prototype.stop=function(){this.getTracks().forEach(function(b){b.stop()})}));var A={};"undefined"!==typeof y?A.AudioContext=
y:"undefined"!==typeof webkitAudioContext&&(A.AudioContext=webkitAudioContext);this.startDrawingFrames=function(){c()};this.appendStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]);b.concat(a);a.forEach(function(b){if(b.getVideoTracks().length){var a=u(b);a.stream=b;n.push(a)}b.getAudioTracks().length&&t.audioContext&&(b=t.audioContext.createMediaStreamSource(b),b.connect(t.audioDestination),t.audioSources.push(b))})};this.releaseStreams=function(){n=[];g=!0;
t.gainNode&&(t.gainNode.disconnect(),t.gainNode=null);t.audioSources.length&&(t.audioSources.forEach(function(b){b.disconnect()}),t.audioSources=[]);t.audioDestination&&(t.audioDestination.disconnect(),t.audioDestination=null);t.audioContext=null;p.clearRect(0,0,w.width,w.height);w.stream&&(w.stream.stop(),w.stream=null)};this.resetVideoStreams=function(b){!b||b instanceof Array||(b=[b]);x(b)};this.name="MultiStreamsMixer";this.toString=function(){return this.name};this.getMixedStream=function(){g=
!1;var a=f(),c=l();c&&c.getAudioTracks().forEach(function(b){a.addTrack(b)});b.forEach(function(b){});return a}}
function MultiStreamRecorder(b,a){function c(){var a=[];b.forEach(function(b){b.getVideoTracks().forEach(function(b){a.push(b)})});return a}b=b||[];var d=this,f,l;a=a||{mimeType:"video/webm",video:{width:360,height:240}};a.frameInterval||(a.frameInterval=10);a.video||(a.video={});a.video.width||(a.video.width=360);a.video.height||(a.video.height=240);this.record=function(){f=new MultiStreamsMixer(b);c().length&&(f.frameInterval=a.frameInterval||10,f.width=a.video.width||360,f.height=a.video.height||
240,f.startDrawingFrames());a.previewStream&&"function"===typeof a.previewStream&&a.previewStream(f.getMixedStream());l=new MediaStreamRecorder(f.getMixedStream(),a);l.record()};this.stop=function(b){l&&l.stop(function(a){d.blob=a;b(a);d.clearRecordedData()})};this.pause=function(){l&&l.pause()};this.resume=function(){l&&l.resume()};this.clearRecordedData=function(){l&&(l.clearRecordedData(),l=null);f&&(f.releaseStreams(),f=null)};this.addStreams=function(a){if(!a)throw"First parameter is required.";
a instanceof Array||(a=[a]);b.concat(a);l&&f&&f.appendStreams(a)};this.resetVideoStreams=function(b){f&&(!b||b instanceof Array||(b=[b]),f.resetVideoStreams(b))};this.name="MultiStreamRecorder";this.toString=function(){return this.name}}"undefined"!==typeof RecordRTC&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder);
function RecordRTCPromisesHandler(b,a){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if("undefined"===typeof b)throw'First argument "MediaStream" is required.';var c=this;c.recordRTC=new RecordRTC(b,a);this.startRecording=function(){return new Promise(function(b,a){try{c.recordRTC.startRecording(),b()}catch(l){a(l)}})};this.stopRecording=function(){return new Promise(function(b,a){try{c.recordRTC.stopRecording(function(a){c.blob=c.recordRTC.getBlob();b(a)})}catch(l){a(l)}})};this.getDataURL=
function(b){return new Promise(function(b,a){try{c.recordRTC.getDataURL(function(a){b(a)})}catch(u){a(u)}})};this.getBlob=function(){return c.recordRTC.getBlob()};this.blob=null}"undefined"!==typeof RecordRTC&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler);
(function(b){function a(b){for(var a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),h=[],c=0;c<b;c++){var d=(Math.random()*(a.length-1)).toFixed(0);h[c]=a[d]}return h.join("")}function c(b){b+="=";for(var a=decodeURIComponent(document.cookie).split(";"),h=0;h<a.length;h++){for(var c=a[h];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(b))return c.substring(b.length,c.length)}return""}function d(b,a,e){var h=new Date;h.setTime(h.getTime()+864E5*e);e="expires="+h.toUTCString();
document.cookie=b+"="+a+";"+e+";path=/"}function f(){return Math.ceil(1E9*Math.random())}function l(a){var h=f();h={uVersion:b.CS.protoVersion,stIsAppInFocusReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:h}}};h.stIsAppInFocusReq.eStatus=a?b.CS.proto_isFocusStatus.values.E_IN_FOCUS:b.CS.proto_isFocusStatus.values.E_OUT_FOCUS;try{r(b.CS,!1,b.CS.proto_msgType.values.E_IS_APP_ON_FOCUS_RQT,h)}catch(e){}}var u,x=0,n=new ArrayBuffer(0),g=0,w=0,p=0,t=function(a,c,e){var h="";switch(c){case a.proto_msgType.values.E_SIGNUP_RSP:if(b.CS.transactionRespCB[e.stSignUpRes.ullTransId])b.CS.transactionRespCB[e.stSignUpRes.ullTransId](a.imlrespcode[e.stSignUpRes.ret].code,
a.imlrespcode[e.stSignUpRes.ret].phrase);break;case a.proto_msgType.values.E_ACTIVATE_RSP:if(b.CS.transactionRespCB[e.stActivateRes.ullTransId])b.CS.transactionRespCB[e.stActivateRes.ullTransId](a.imlrespcode[e.stActivateRes.ret].code,a.imlrespcode[e.stActivateRes.ret].phrase);break;case a.proto_msgType.values.E_LOGIN_RSP:if(b.CS.transactionRespCB[e.stLoginRes.ullTransId])b.CS.transactionRespCB[e.stLoginRes.ullTransId](a.imlrespcode[e.stLoginRes.ret].code,a.imlrespcode[e.stLoginRes.ret].phrase);e.stLoginRes.ret&&
(a.loggedin=!0);b.CS.s3Bin=e.stLoginRes.sBucketName;b.CS.timeOffset=e.stLoginRes.uServerTime-(new Date).getTime();break;case a.proto_msgType.values.E_GET_CONTACTS_RSP:if(b.CS.transactionRespCB[e.stGetContactsRes.ullTransId])b.CS.transactionRespCB[e.stGetContactsRes.ullTransId](a.imlrespcode[e.stGetContactsRes.ret].code,{contacts:e.stGetContactsRes.sPhoneNums,types:e.stGetContactsRes.stContactTypes});break;case a.proto_msgType.values.E_IS_APP_CONTACT_RSP:c=[];h=e.stIsAppContactRes.sPhoneNums;for(var d=
e.stIsAppContactRes.stProfile,k=0;k<h.length;k++)c[k]={mobileNumber:h[k],name:d[k].sUserName,presenceMessage:d[k].sPresenceStatusMsg,profilePicId:d[k].sProfilePicId};if(b.CS.transactionRespCB[e.stIsAppContactRes.ullTransId])b.CS.transactionRespCB[e.stIsAppContactRes.ullTransId](a.imlrespcode[e.stIsAppContactRes.ret].code,c);break;case a.proto_msgType.values.E_USER_JOINED_RQT:if(b.CS.transactionRespCB[e.stUserJoinedReq.ullTransId])b.CS.transactionRespCB[e.stUserJoinedReq.ullTransId](a.contactsStatus[c].status,
{mobileNumber:e.stUserJoinedReq.sJoinedUserMobNu});break;case a.proto_msgType.values.E_ADD_NUM_RSP:if(b.CS.transactionRespCB[e.stAddNumRes.ullTransId])b.CS.transactionRespCB[e.stAddNumRes.ullTransId](a.imlrespcode[e.stAddNumRes.ret].code,a.imlrespcode[e.stAddNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP:break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT:a.call.callObj[e.stDirectAudioVideoCall180RingingReq.sCallId].state=a.call.RINGING_RECEIVED;
k={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingRes:{ullTransId:e.stDirectAudioVideoCall180RingingReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:e.stDirectAudioVideoCall180RingingReq.sCallId,retCodes:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP,k);if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,{callId:e.stDirectAudioVideoCall180RingingReq.sCallId});break;case a.proto_msgType.values.E_GET_PRESENCE_RSP:c=
[];for(k in e.stGetPresRes.stPresence)h={mobileNumber:e.stGetPresRes.stPresence[k].sPhoneNum,isOnline:!0,lastLoginTime:e.stGetPresRes.stPresence[k].sTime,statusMessage:e.stGetPresRes.stPresence[k].sPresenceStatusMsg},"OFFLINE"==e.stGetPresRes.stPresence[k].sStatus&&(h.isOnline=!1),c.push(h);if(b.CS.transactionRespCB[e.stGetPresRes.ullTransId])b.CS.transactionRespCB[e.stGetPresRes.ullTransId](a.imlrespcode[e.stGetPresRes.ret].code,c);break;case a.proto_msgType.values.E_SET_PROFILE_RSP:if(b.CS.transactionRespCB[e.stSetProfileRes.ullTransId])b.CS.transactionRespCB[e.stSetProfileRes.ullTransId](a.imlrespcode[e.stSetProfileRes.ret].code,
a.imlrespcode[e.stSetProfileRes.ret].phrase);break;case a.proto_msgType.values.E_GET_PROFILE_RSP:if(b.CS.transactionRespCB[e.stGetProfileRes.ullTransId])b.CS.transactionRespCB[e.stGetProfileRes.ullTransId](a.imlrespcode[e.stGetProfileRes.ret].code,{displayName:e.stGetProfileRes.stProfile.sUserName,Presence:e.stGetProfileRes.stProfile.sPresenceStatusMsg,profilePicture:e.stGetProfileRes.stProfile.sProfilePicId});break;case a.proto_msgType.values.E_USER_PROFILE_CHANGED_RQT:b.CS.contacts.onpresenceupdatecb&&
(k={mobilenumber:e.stUserProfileChangedReq.sProfileUserMobNu},e.stUserProfileChangedReq.stProfile.sUserName&&(k.name=e.stUserProfileChangedReq.stProfile.sUserName),e.stUserProfileChangedReq.stProfile.sPresenceStatusMsg&&(k.message=e.stUserProfileChangedReq.stProfile.sPresenceStatusMsg),e.stUserProfileChangedReq.stProfile.sProfilePicId&&(k.profilePicUrl=e.stUserProfileChangedReq.stProfile.sProfilePicId),b.CS.contacts.onpresenceupdatecb(a.contactsStatus[c].status,k));k={uVersion:a.protoVersion,stUserProfileChangedRes:{ullTransId:e.stUserProfileChangedReq.stHdrs.ullTransId,
sMobNu:a.localUser,sProfileUserMobNu:e.stUserProfileChangedReq.sProfileUserMobNu,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_USER_PROFILE_CHANGED_RSP,k);break;case a.proto_msgType.values.E_CHAT_RQT:k={uVersion:a.protoVersion,stChatRes:{ullTransId:e.stChatReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:e.stChatReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_CHAT_RSP,k);b.CS.chat.sendChatResponse(e.stChatReq);b.CS.chat.sendDelivered(e.stChatReq.stHdrs.sMobNu,
e.stChatReq.uChatID,0,function(b,a){});b.CS.chat.onMessagecb&&(k={remoteUser:e.stChatReq.stHdrs.sMobNu,data:e.stChatReq.data,timestamp:e.stChatReq.uSendTime,id:e.stChatReq.uChatID,sequence:e.stChatReq.uSeqNum,size:e.stChatReq.dataLen,chattype:a.chatType[e.stChatReq.stChatType].type},e.stChatReq.sContentType&&(k.contenttype=e.stChatReq.sContentType),e.stChatReq.sThumbnailUrl&&(k.thumbnail=e.stChatReq.sThumbnailUrl),b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RQT],k));break;
case a.proto_msgType.values.E_CHAT_RSP:k=a.imlrespcode[e.stChatRes.ret].phrase;b.CS.respData[e.stChatRes.ullTransId]&&(k={status:a.imlrespcode[e.stChatRes.ret].phrase,url:b.CS.respData[e.stChatRes.ullTransId].fileName});if(b.CS.transactionRespCB[e.stChatRes.ullTransId])b.CS.transactionRespCB[e.stChatRes.ullTransId](a.imlrespcode[e.stChatRes.ret].code,k);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RSP],{id:e.stChatRes.uChatID,status:a.imlrespcode[e.stChatRes.ret].code,
remoteUser:e.stChatRes.sMobNu});break;case a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP:if(b.CS.transactionRespCB[e.stGetMyPendingNotificationsRes.ullTransId])b.CS.transactionRespCB[e.stGetMyPendingNotificationsRes.ullTransId](a.imlrespcode[e.stGetMyPendingNotificationsRes.ret].code,a.imlrespcode[e.stGetMyPendingNotificationsRes.ret].phrase);break;case a.proto_msgType.values.E_IS_TYPING_RQT:k={uVersion:a.protoVersion,stIsTypingRes:{ullTransId:e.stIsTypingReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK}};
r(a,!1,a.proto_msgType.values.E_IS_TYPING_RSP,k);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_IS_TYPING_RQT],{remoteUser:e.stIsTypingReq.sDstMobNu,groupId:e.stIsTypingReq.sGroupID});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RQT:console.log("chat delivered");k={uVersion:a.protoVersion,stChatDeliveryRes:{ullTransId:e.stChatDeliveryReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:e.stChatDeliveryReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};r(a,
!1,a.proto_msgType.values.E_CHAT_DELIVERY_RSP,k);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_DELIVERY_RQT],{id:e.stChatDeliveryReq.uChatID,time:e.stChatDeliveryReq.uDeliveryTime,remoteUser:e.stChatDeliveryReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_READ_RQT:console.log("chat read");k={uVersion:a.protoVersion,stChatReadRes:{ullTransId:e.stChatReadReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:e.stChatReadReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};
r(a,!1,a.proto_msgType.values.E_CHAT_READ_RSP,k);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_READ_RQT],{id:e.stChatReadReq.uChatID,time:e.stChatReadReq.uReadTime,remoteUser:e.stChatReadReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RSP:if(b.CS.transactionRespCB[e.stChatDeliveryRes.ullTransId])b.CS.transactionRespCB[e.stChatDeliveryRes.ullTransId](a.imlrespcode[e.stChatDeliveryRes.ret].code,a.imlrespcode[e.stChatDeliveryRes.ret].phrase);
break;case a.proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RSP:c=[];h=e.stGetChatHistoryListRes.stChatHistoryList;d=h.length;for(k=0;k<d;k++)c[k]={id:h[k].sChatID,src:h[k].ssrcMobNu,dst:h[k].sDstMobNu,sequenceNo:h[k].ullSeqNum,sentTimestamp:h[k].ullMessageTime,chatType:a.chatType[h[k].eChatType].type,reportsRequested:h[k].uReportsReq,data:h[k].sData,contentType:h[k].sContentType,thumbUrl:h[k].sThumbnailUrl,messageStatus:a.chatStatus[h[k].eStatus].status,deliveredTimestamp:h[k].ullDeliveryTime,readTimestamp:h[k].ullReadTime},
h[k].sThumbnailUrl&&(c[k].thumbnail=h[k].sThumbnailUrl);if(b.CS.transactionRespCB[e.stGetChatHistoryListRes.ullTransId])b.CS.transactionRespCB[e.stGetChatHistoryListRes.ullTransId](a.imlrespcode[e.stGetChatHistoryListRes.eReturnCode].code,{totalMessages:e.stGetChatHistoryListRes.sTotalNumberOfEntries,pageSize:e.stGetChatHistoryListRes.sPageSize,history:c});break;case a.proto_msgType.values.E_GET_CALL_HISTORY_LIST_RSP:c=[];h=e.stGetCallHistoryListRes.stCallHistoryList;d=h.length;for(k=0;k<d;k++)c[k]=
{id:h[k].sCallID,src:h[k].ssrcMobNu,dst:h[k].sDstMobNu,callType:a.callType[h[k].eCallType].type,direction:a.direction[h[k].eDirection].type,status:a.callStatus[h[k].eStatus].status,startTime:h[k].ullStartTime,endTime:h[k].ullEndTime};if(b.CS.transactionRespCB[e.stGetCallHistoryListRes.ullTransId])b.CS.transactionRespCB[e.stGetCallHistoryListRes.ullTransId](a.imlrespcode[e.stGetCallHistoryListRes.eReturnCode].code,{totalMessages:e.stGetCallHistoryListRes.sTotalNumberOfEntries,pageSize:e.stGetCallHistoryListRes.sPageSize,
history:c});break;case a.proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RSP:c=[];h=e.stGetRecentConversationListRes.stConversationList;for(k=0;k<h.length;k++)c[k]={messageType:a.recentMsgType[h[k].eConversationType].type},h[k].stChatHistoryList&&(d=h[k].stChatHistoryList,c[k].chat={id:d.sChatID,src:d.ssrcMobNu,dst:d.sDstMobNu,sequenceNo:d.ullSeqNum,sentTimestamp:d.ullMessageTime,chatType:a.chatType[d.eChatType].type,reportsRequested:d.uReportsReq,data:d.sData,contentType:d.sContentType,thumbUrl:d.sThumbnailUrl,
messageStatus:a.chatStatus[d.eStatus].status,deliveredTimestamp:d.ullDeliveryTime,readTimestamp:d.ullReadTime}),h[k].stCallHistoryList&&(d=h[k].stCallHistoryList,c[k].call={callId:d.sCallID,src:d.ssrcMobNu,dst:d.sDstMobNu,callType:a.callType[d.eCallType].type,direction:a.direction[d.eDirection].type,status:a.callStatus[d.eStatus].status,startTime:d.ullStartTime,endTime:d.ullEndTime});if(b.CS.transactionRespCB[e.stGetRecentConversationListRes.ullTransId])b.CS.transactionRespCB[e.stGetRecentConversationListRes.ullTransId](a.imlrespcode[e.stGetRecentConversationListRes.eReturnCode].code,
{totalMessages:e.stGetRecentConversationListRes.sTotalNumberOfEntries,pageSize:e.stGetRecentConversationListRes.sPageSize,list:c});break;case a.proto_msgType.values.E_CHAT_READ_RSP:if(b.CS.transactionRespCB[e.stChatReadRes.ullTransId])b.CS.transactionRespCB[e.stChatReadRes.ullTransId](a.imlrespcode[e.stChatReadRes.ret].code,a.imlrespcode[e.stChatReadRes.ret].phrase);break;case a.proto_msgType.values.E_DELETE_NUM_RSP:if(b.CS.transactionRespCB[e.stDeleteNumRes.ullTransId])b.CS.transactionRespCB[e.stDeleteNumRes.ullTransId](a.imlrespcode[e.stDeleteNumRes.ret].code,
a.imlrespcode[e.stDeleteNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT:h=e.stDirectAudioVideoCallStartReq.sCallId;a.call.remoteUser=e.stDirectAudioVideoCallStartReq.stHdrs.sMobNu;a.call.stDirectAudioVideoCallStartReq=e.stDirectAudioVideoCallStartReq;a.call.isVideoCall=a.proto_callType.values.E_VIDEOCALL==e.stDirectAudioVideoCallStartReq.stCallType;k={uVersion:a.protoVersion,stDirectAudioVideoCallStartRes:{ullTransId:e.stDirectAudioVideoCallStartReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:e.stDirectAudioVideoCallStartReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP,k);k={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:f()},sDstMobNu:b.CS.call.remoteUser,stCallType:b.CS.proto_callType.values.E_VIDEOCALL,sCallId:h}};a.proto_callType.values.E_VOICECALL==e.stDirectAudioVideoCallStartReq.stCallType&&(k.stDirectAudioVideoCall180RingingReq.stCallType=
a.proto_callType.values.E_VOICECALL);var v=!1;for(d in a.call.callObj)a.call.callObj[d].state!=a.call.states.IDLE&&a.call.callObj[d].state!=a.call.states.ENDED&&(v=!0);k.stDirectAudioVideoCall180RingingReq.bIsCallWaiting=v;a.call.callObj[h]={state:a.call.states.OFFER_RECEIVED,remoteUser:a.call.remoteUser,type:"IP",direction:"IN",isMuted:!1,iceCandidates:[]};r(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT,k);if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,
{caller:a.call.remoteUser,isVideoCall:a.call.isVideoCall,callId:h,isCallActive:e.stDirectAudioVideoCallStartReq.sCallActive,startTime:e.stDirectAudioVideoCallStartReq.sStartTime});break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP:case a.proto_msgType.values.E_CALL_START_RSP:break;case a.proto_msgType.values.E_CALL_ANSWER_RQT:a.call.callObj[e.stCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=e.stCallAnswerReq.sCallId;if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,
{caller:a.call.remoteUser,callId:e.stCallAnswerReq.sCallId});wr_recv_rem_answer(e.stCallAnswerReq.sSdp,e.stCallAnswerReq.sCallId);k={uVersion:a.protoVersion,stCallAnswerRes:{ullTransId:e.stCallAnswerReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:e.stCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_CALL_ANSWER_RSP,k);break;case a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RQT:a.call.callObj[e.callSessionInProgressSdpReq.sCallId].state=a.call.states.CONNECTED;
a.call.activeCallId=e.callSessionInProgressSdpReq.sCallId;wr_recv_rem_answer(e.callSessionInProgressSdpReq.sSdp,e.callSessionInProgressSdpReq.sCallId);if(a.call.callObj[e.callSessionInProgressSdpReq.sCallId].state!=a.call.states.CONNECTED&&b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:e.stCallAnswerReq.sCallId});k={uVersion:a.protoVersion,stCallSessionInProgressSdpRes:{ullTransId:e.stCallSessionInProgressSdpReq.stHdrs.ullTransId,sMobNu:a.localUser,
ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RSP,k);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT:a.call.callObj[e.stDirectAudioVideoCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=e.stDirectAudioVideoCallAnswerReq.sCallId;if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:e.stDirectAudioVideoCallAnswerReq.sCallId});wr_recv_rem_answer(e.stDirectAudioVideoCallAnswerReq.sSdp,
e.stDirectAudioVideoCallAnswerReq.sCallId);k={uVersion:a.protoVersion,stDirectAudioVideoCallAnswerRes:{ullTransId:e.stDirectAudioVideoCallAnswerReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:e.stDirectAudioVideoCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP,k);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP:console.log("received answer response");if(b.CS.transactionRespCB[e.stDirectAudioVideoCallAnswerRes.ullTransId])b.CS.transactionRespCB[e.stDirectAudioVideoCallAnswerRes.ullTransId](a.imlrespcode[e.stDirectAudioVideoCallAnswerRes.ret].code,
a.imlrespcode[e.stDirectAudioVideoCallAnswerRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT:h=e.stDirectAudioVideoCallEndReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[h])break;a.call.callObj[h].state=a.call.states.ENDED;a.call.remoteUser=e.stDirectAudioVideoCallEndReq.stHdrs.sMobNu;b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:h});k={uVersion:a.protoVersion,stDirectAudioVideoCallEndRes:{ullTransId:e.stDirectAudioVideoCallEndReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:h,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP,k);wr_recv_rem_end();break;case a.proto_msgType.values.E_CALL_ENDED_RQT:h=e.stCallEndedReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[h])break;a.call.callObj[h].state=a.call.states.ENDED;a.call.remoteUser=e.stCallEndedReq.stHdrs.sMobNu;b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:h});k={uVersion:a.protoVersion,
stCallEndedRes:{ullTransId:e.stCallEndedRes.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:h,ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_CALL_ENDED_RSP,k);wr_recv_rem_end();break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP:if(b.CS.transactionRespCB[e.stDirectAudioVideoCallEndRes.ullTransId])b.CS.transactionRespCB[e.stDirectAudioVideoCallEndRes.ullTransId](a.imlrespcode[e.stDirectAudioVideoCallEndRes.ret].code,a.imlrespcode[e.stDirectAudioVideoCallEndRes.ret].phrase);
break;case a.proto_msgType.values.E_IS_APP_ON_FOCUS_RSP:case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP:case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP:break;case a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RQT:b.CS.contacts.onpresenceupdatecb&&b.CS.contacts.onpresenceupdatecb(a.contactsStatus[c].status,{user:e.stUserPresenceChangedReq.stPresence.sPhoneNum,isOnline:"ONLINE"==e.stUserPresenceChangedReq.stPresence.sStatus,time:e.stUserPresenceChangedReq.stPresence.sTime,
message:e.stUserPresenceChangedReq.stPresence.sPresenceStatusMsg});k={uVersion:a.protoVersion,stUserPresenceChangedRes:{ullTransId:e.stUserPresenceChangedReq.stHdrs.ullTransId,sMobNu:a.localUser,retCodes:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RSP,k);break;case a.proto_msgType.values.E_USER_PENDING_NOTIFICATIONS_RQT:k={uVersion:a.protoVersion,stUserPendingNotificationsRes:{ullTransId:e.stUserPendingNotificationsReq.stHdrs.ullTransId,sMobNu:a.localUser,
retCodes:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP,k);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT:console.log("remote ice received");wr_recv_rem_ice(e.stSendIceCandidatesInDirectAVCallReq,e.stSendIceCandidatesInDirectAVCallReq.sCallId);k={uVersion:a.protoVersion,stSendIceCandidatesInDirectAVCallRes:{ullTransId:e.stSendIceCandidatesInDirectAVCallReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:e.stSendIceCandidatesInDirectAVCallReq.sCallId,
ret:a.proto_retCodes.values.E_200_OK}};r(a,!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP,k);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RQT:wr_recv_rem_ice(e.stSendIceCandidatesInCallReq,e.stSendIceCandidatesInCallReq.sCallId);k={uVersion:a.protoVersion,stSendIceCandidatesInCallReq:{ullTransId:e.stSendIceCandidatesInCallReq.stHdrs.ullTransId,sMobNu:a.localUser,sDstNumber:e.sendIceCandidatesInCallReq.sDstNumber,ret:a.proto_retCodes.values.E_200_OK}};r(a,
!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP,k);break;case a.proto_msgType.values.E_CALL_INFO_SYNC_RQT:h=e.stCallInfoSyncReq.sCallID;a.call.activeCallId="";b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:e.stCallInfoSyncReq.ssrcMobNu,callId:h,callee:e.stCallInfoSyncReq.sDstMobNu,callType:a.callType[e.stCallInfoSyncReq.eCallType].type,callStatus:a.callStatus[e.stCallInfoSyncReq.eStatus].status,startTime:e.stCallInfoSyncReq.ullStartTime,endTime:e.stCallInfoSyncReq.ullEndTime,
answerTime:e.stCallInfoSyncReq.ullAnswerTime});k={uVersion:a.protoVersion,stCallInfoSyncRes:{ullTransId:e.stCallInfoSyncReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK,sReturnPhrase:"OK"}};r(a,!1,a.proto_msgType.values.E_CALL_INFO_SYNC_RSP,k);break;case a.proto_msgType.values.E_LOGIN_ELSE_WHERE_NOTIFICATION_RQT:k={uVersion:a.protoVersion,stLoginElseWhereNotificationRes:{ullTransId:e.stLoginElseWhereNotificationReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK,sReturnPhrase:"OK"}};
r(a,!1,a.proto_msgType.values.E_LOGIN_ELSE_WHERE_NOTIFICATION_RSP,k);break;default:console.log("un handled message received "+c)}},y=function(b,a){a.is_provisional||1==b.connectionState?0==b.transportType?1==b.ws.readyState?b.ws.send(a.body):console.log("ws send failed connection state: "+b.ws.readyState):console.log("rest unsupported in current release"):console.log("Unable to send message before login completes")},r=function(b,a,c,d){d=b.proto_msg.encode(b.proto_msg.create(d)).finish();var e=new ArrayBuffer(10+
d.length),h=new DataView(e);h.setUint32(0,c,!1);h.setUint32(4,d.length,!1);h.setUint8(8,13,!1);h.setUint8(9,10,!1);for(c=0;c<d.length;c++)h.setUint8(10+c,d[c],!1);1==b.connectionState||a?(1!=b.ws.readyState&&(b.reconnectTimeout=300,G()),y(b,{is_provisional:a,body:e})):b.msg_queue.push({is_provisional:a,body:e})},z=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;var h=new jsSHA("SHA-256","TEXT");h.update(a.localUser+a.OAuthToken);h=h.getHash("HEX");e={uVersion:a.protoVersion,stLoginReq:{stHdrs:{sMobNu:a.localUser,
sClientId:a.clientId,ullTransId:e},sPassHash:h,sAuth:"auth string",stOSName:a.proto_osType.values.E_WEB,sOSVersion:a.osVersion,sPushDevToken:"",sAppName:"appName",sDeviceId:b.CS.deviceId}};b.CS.appId&&(e.stLoginReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});r(a,!0,a.proto_msgType.values.E_LOGIN_RQT,e)},A=function(b,a){var c=new Uint8Array(b.byteLength+a.byteLength);c.set(new Uint8Array(b),0);c.set(new Uint8Array(a),b.byteLength);return c.buffer},J=function(b,a){switch(p){case 0:if(10<=
x+a.byteLength){n=A(n,a.slice(0,10-x));x=10;var c=new DataView(n);w=c.getUint32(0);g=c.getUint32(4);n=new ArrayBuffer(0);x=0;p=1;return 10}n=A(n,a);x+=a.byteLength;return a.byteLength;case 1:if(x+a.byteLength>=g){n=A(n,a.slice(0,g-x));c=new Uint8Array(n);try{var h=b.proto_msg.decode(c);t(b,w,h)}catch(U){console.log("error decoding message "+U)}finally{return n=new ArrayBuffer(0),p=x=0,g-x}}else return n=A(n,a),x+=a.byteLength,a.byteLength}},G=function(){var a=b.CS;a.reconnectTimeout||(a.reconnectTimeout=
300);if(0==a.transportType){if(0!=a.connectionState){var c=new WebSocket(u);a.connectionState=0;c.binaryType="arraybuffer";c.onopen=function(){var a=b.CS;a.connectionState=1;a.reconnectTimeout=300;console.log("websocket connected");a.connReady=!0;for(null!=a.localUser&&null!=a.OAuthToken&&(a.loggedin=!0,z(a,void 0));0<a.msg_queue.length;)y(a,a.msg_queue.shift())};c.onmessage=function(b){b=b.data;for(var c;0<b.byteLength;)c=J(a,b),0<c&&(b=b.slice(c))};c.onerror=function(b){};c.onclose=function(a){a=
b.CS;console.log("websocket connection closed!. attempting to reconnect");a.tid&&clearTimeout(a.tid);a.tid=setTimeout(G,a.reconnectTimeout);a.reconnectTimeout*=2;3E5<a.reconnectTimeout&&(a.reconnectTimeout=3E5);a.connectionState=4};b.onbeforeunload=function(b){1==this.connectionState&&c.close()};a.ws=c}}else z(a,void 0)},D=function(){};D.prototype.init=function(b){this["super"]=b};var B=function(){this.activeCallId=this.remoteUser="";this.states={IDLE:1,OFFER_SENT:2,OFFER_RECEIVED:3,RINGING_RECEIVED:4,
CONNECTED:5,ENDED:6};this.callObj={}};B.prototype.init=function(b){this["super"]=b};var H=function(){};H.prototype.init=function(b){this["super"]=b};H.prototype.setProfile=function(a,c,e,d){var h=f();b.CS.transactionRespCB[h]=d;a={uVersion:this["super"].protoVersion,stSetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},stProfile:{sUserName:a}}};c&&""!=c&&(a.stSetProfileReq.stProfile.sPresenceStatusMsg=c);e&&""!=e&&(a.stSetProfileReq.stProfile.sProfilePicId=
e);r(this["super"],!1,this["super"].proto_msgType.values.E_SET_PROFILE_RQT,a)};H.prototype.getProfile=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;r(this["super"],!1,this["super"].proto_msgType.values.E_GET_PROFILE_RQT,{uVersion:this["super"].protoVersion,stGetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sMobNum:a}})};H.prototype.getContacts=function(a){var c=f();b.CS.transactionRespCB[c]=a;r(this["super"],!1,this["super"].proto_msgType.values.E_GET_CONTACTS_RQT,
{uVersion:this["super"].protoVersion,stGetContactsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c}}})};H.prototype.isAppContacts=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;r(this["super"],!1,this["super"].proto_msgType.values.E_IS_APP_CONTACT_RQT,{uVersion:this["super"].protoVersion,stIsAppContactReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},uCount:a.length,sPhoneNums:a}})};H.prototype.onMessage=function(b){this.onpresenceupdatecb=
b};H.prototype.addContact=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;r(this["super"],!1,this["super"].proto_msgType.values.E_ADD_NUM_RQT,{uVersion:this["super"].protoVersion,stAddNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},uCount:1,sPhoneNums:[a],stContactTypes:[this["super"].contact_type.values.E_CUSTOM_CONTACT]}})};H.prototype.removeContact=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;r(this["super"],!1,this["super"].proto_msgType.values.E_DELETE_NUM_RQT,
{uVersion:this["super"].protoVersion,stDeleteNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sPhoneNums:a}})};H.prototype.getPresence=function(a,c){var e=f();b.CS.transactionRespCB[e]=c;r(this["super"],!1,this["super"].proto_msgType.values.E_GET_PRESENCE_RQT,{uVersion:this["super"].protoVersion,stGetPresReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sPhoneNums:a}})};var m=function(){this.chatSeqNo=1};m.prototype.init=
function(b){this["super"]=b};m.prototype.onMessage=function(b){this.onMessagecb=b};m.prototype.ChatType={TEXT_PLAIN:1,TEXT_HTML:2,LOCATION:3,IMAGE:4,VIDEO:5,CONTACT:6,DOCUMENT:7};m.prototype.ChatFileType={IMAGE:4,VIDEO:5,DOCUMENT:7};B.prototype.getHistory=function(a,c,e,d){var h=f();b.CS.transactionRespCB[h]=d;c={uVersion:this["super"].protoVersion,stGetCallHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},sPageSize:c,sOffset:e}};a&&(c.stGetCallHistoryListReq.sDstMobNu=
a);r(this["super"],!1,this["super"].proto_msgType.values.E_GET_CALL_HISTORY_LIST_RQT,c)};B.prototype.saveRecording=function(b,a){};m.prototype.getHistory=function(a,c,e,d){var h=f();b.CS.transactionRespCB[h]=d;c={uVersion:this["super"].protoVersion,stGetChatHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},sPageSize:c,sOffset:e}};a&&(c.stGetChatHistoryListReq.sDstMobNu=a);r(this["super"],!1,this["super"].proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RQT,
c)};m.prototype.sendReadReceipt=function(a,c,e){var h=f();b.CS.transactionRespCB[h]=e;a={uVersion:this["super"].protoVersion,stChatReadReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},sDstMobNu:a,uChatID:c.toString(),uReadTime:Math.floor(Date.now())}};r(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_READ_RQT,a)};m.prototype.sendDelivered=function(a,c,e,d){var h=f();b.CS.transactionRespCB[h]=d;a={uVersion:this["super"].protoVersion,stChatDeliveryReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:h},sDstMobNu:a,uChatID:c.toString(),uDeliveryTime:Math.floor(Date.now()),reports_req:e}};r(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_DELIVERY_RQT,a)};H.prototype.getRecentContacts=function(a,c,e){var h=f();b.CS.transactionRespCB[h]=e;r(this["super"],!1,this["super"].proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RQT,{uVersion:this["super"].protoVersion,stGetRecentConversationListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,
ullTransId:h},sPageSize:a,sOffset:c}})};m.prototype.sendMessage=function(c,d,e,v,m){if(this["super"].localUser){var h=f();b.CS.transactionRespCB[h]=m;this.chatSeqNo++;m=a(16);var k=Math.floor(Date.now());4E3<d.length&&(d=d.slice(0,4E3));r(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RQT,{uVersion:this["super"].protoVersion,stChatReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},sDstMobNu:c,uChatID:m,uSeqNum:this.chatSeqNo,uSendTime:k,stChatType:e,
dataLen:d.length,reports_req:v,data:d}});return{id:m,sentTime:k}}m("400","User not logged in!")};var q=function(b){b=atob(b.split(",")[1]);for(var a=[],c=0;c<b.length;c++)a.push(b.charCodeAt(c));return new Blob([new Uint8Array(a)],{type:"image/png"})},F=function(a,c,e,d,f,v,m,g,E,I){console.log("An image has been loaded");var h=new FileReader;h.onload=function(h){var k=new Image;k.onload=function(h){h=document.createElement("canvas");var l=k.width,C=k.height;l>C?200<l&&(C*=200/l,l=200):200<C&&(l*=
200/C,C=200);h.width=l;h.height=C;h.getContext("2d").drawImage(k,0,0,l,C);h=h.toDataURL("image/png");h=q(h);var F="thumb_"+c;b.CS.s3.upload({Key:F,Body:h,ACL:"public-read"},function(c,h){if(c)return alert("There was an error uploading your photo: ",c.message);var k={uVersion:b.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:f},sDstMobNu:v,uChatID:m,uSeqNum:b.CS.chat.chatSeqNo,uSendTime:g,stChatType:E,dataLen:a.size,reports_req:I,data:d,sThumbnailUrl:F}};
e&&(k.stChatReq.sContentType=e);r(b.CS,!1,b.CS.proto_msgType.values.E_CHAT_RQT,k);console.log("chat file sent out to server")})};k.src=h.target.result};h.readAsDataURL(a)};m.prototype.getMediaURLPrefix=function(){return"https://"+b.CS.s3Bin+".s3.ap-southeast-1.amazonaws.com/"};m.prototype.sendPhoto=function(b,a,c){CA.chat.sendFile(b,v.chat.ChatFileType.IMAGE,a.type,"",a,!0,c)};m.prototype.sendVideo=function(a,b,c,d){CA.chat.sendFile(a,v.chat.ChatFileType.VIDEO,b.type,c,b,!0,d)};m.prototype.sendFile=
function(b,a,c,d){CA.chat.sendFile(b,v.chat.ChatFileType.DOCUMENT,a.type,c,a,!0,d)};m.prototype.sendFile=function(c,d,e,v,m,g,q){if(!d||""==d||!m||""==m)return q(400,"invalid input. chatFileType or file content is empty"),-1;var h=f();b.CS.transactionRespCB[h]=q;this.chatSeqNo++;var k=a(16),l=Math.floor(Date.now()),E=a(15)+"_"+m.name;b.CS.s3.upload({Key:E,Body:m,ACL:"public-read"},function(a,f){if(a)return alert("There was an error uploading your photo: ",a.message);b.CS.respData[h]={fileName:E};
if(m.type.match(/image.*/))F(m,E,e,f.Key,h,c,k,l,d,g);else{var q={uVersion:b.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:h},sDstMobNu:c,uChatID:k,uSeqNum:b.CS.chat.chatSeqNo,uSendTime:l,stChatType:d,dataLen:m.size,reports_req:g,data:f.Key}};e&&(q.stChatReq.sContentType=e);v&&""!=v&&(q.stChatReq.sThumbnailUrl=v);r(b.CS,!1,b.CS.proto_msgType.values.E_CHAT_RQT,q)}});return{id:k,sentTime:l,url:E}};m.prototype.getPendingChat=function(a){var c=f();b.CS.transactionRespCB[c]=
a;r(this["super"],!1,this["super"].proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RQT,{uVersion:this["super"].protoVersion,stGetMyPendingNotificationsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c},sPendingNotificationType:this["super"].proto_pendingNotifType.values.E_CHAT_REQUEST}})};m.prototype.sendIsTyping=function(a,b){var c=f();r(this["super"],!1,this["super"].proto_msgType.values.E_IS_TYPING_RQT,{uVersion:this["super"].protoVersion,stIsTypingReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:c},sDstMobNu:a,sGroupID:b}})};m.prototype.sendChatResponse=function(a){r(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RSP,{uVersion:this["super"].protoVersion,stChatRes:{ullTransId:a.stHdrs.ullTransId,sMobNu:this["super"].localUser,uChatID:a.uChatID.toString(),ret:this["super"].proto_retCodes.values.E_200_OK}})};B.prototype.onMessage=function(a){this.onMessagecb=a};B.prototype.startCall=function(c,d,e,f,v,m){if(5!=arguments.length&&6!=arguments.length)return console.log("invalid arguments list"),
-1;if(!this["super"].localUser)return v("400","User not logged in!"),-1;this.isVideoCall=f;this.remoteUser=c;var h=a(16);this.callObj[h]={state:this.states.OFFER_SENT,remoteUser:c,type:"IP",direction:"OUT",isMuted:!1,iceCandidates:[]};this.callObj[h].is_record_callTrue=m?!0:!1;wr_send_rem_call(this,h,f,d,e,m);b.CS.call.callToCb=v;return h};B.prototype.saveRecording=function(a,b,c){wr_save_recording(a,b)};B.prototype.deleteRecording=function(a,b){wr_save_recording(a,fileName)};B.prototype.startPSTNCall=
function(c,d,e,f,v){this.isVideoCall=f;this.remoteUser=c;var h=a(16);wr_send_rem_call(this,h,f,d,e);this.callObj[h]={state:this.states.OFFER_SENT,remoteUser:c,type:"PSTN",direction:"OUT",isMuted:!1,iceCandidates:[]};b.CS.call.callToCb=v;return h};B.prototype.decline=function(a,c){this.callObj[a]?(this.declinecb=c,this.callObj[a].state=this.states.ENDED,b.CS.call.end(a,"User busy",function(a,b){console.log("user budy ret "+a)})):c(400,"Unknown callId")};B.prototype.answer=function(a,c,e,d){this.answercb=
d;this.callObj[a].state=this.states.CONNECTED;""!=this.activeCallId&&(d=this.activeCallId,b.CS.call.end(d,"Switched to another call",function(a,b){}),delete this.callObj[d]);this.activeCallId=a;wr_recv_rem_offer(a,c,this.isVideoCall,e,this.stDirectAudioVideoCallStartReq)};B.prototype.sendAnswer=function(a,c,e){var h=f();b.CS.transactionRespCB[h]=e;a={uVersion:this["super"].protoVersion,stDirectAudioVideoCallAnswerReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},
sDstMobNu:this.remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,sCallId:a,sSdp:c}};b.CS.call.isVideoCall||(a.stDirectAudioVideoCallAnswerReq.stCallType=this["super"].proto_callType.values.E_VOICECALL);r(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT,a);console.log("sent answer")};B.prototype.sendIce=function(a,c,e,d,v){var h=f();b.CS.transactionRespCB[h]=v;"IP"==b.CS.call.callObj[d].type?(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInDirectAVCallReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:h},sDstNumber:a,sCallId:d.toString(),sIceCandidates:[c],sJsonIceCandidates:[e]}},r(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a)):"PSTN"==b.CS.call.callObj[d].type&&(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInCallReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:h},sDstNumber:a,sCallId:d.toString(),sIceCandidates:[c],sJsonIceCandidates:[e],sDirection:this["super"].direction_enum.values.E_TO_SERVER,
sAppId:"webapp"}},r(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a))};B.prototype.end=function(a,c,e){this.callObj[a]?(this.activeCallId="",this.callObj[a].state=this.states.ENDED,c=f(),b.CS.transactionRespCB[c]=e,wr_send_rem_call_end(a),a={uVersion:this["super"].protoVersion,stDirectAudioVideoCallEndReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c},sDstMobNu:this.callObj[a].remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,
sCallId:a,sStopTime:Math.floor(Date.now())}},b.CS.call.isVideoCall||(a.stDirectAudioVideoCallEndReq.stCallType=this["super"].proto_callType.values.E_VOICECALL),r(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT,a)):e(400,"Unknown callId")};B.prototype.mute=function(a,c,e){c?(wr_set_local_mute(this,a,e),b.CS.call.callObj[a].isMuted=!0):(wr_set_local_unmute(this,a,e),b.CS.call.callObj[a].isMuted=!1)};B.prototype.isMuted=function(a,b,c){return v.call.callObj[a].isMuted};
var I=function(a){protobuf.load("/res/iml.json",function(b,c){if(b)throw b;a.proto_root=c;a.proto_msg=c.lookup("msg");a.proto_osType=c.lookup("osType");a.proto_retCodes=c.lookup("retCodes");a.proto_msgType=c.lookup("msgType");a.proto_pendingNotifType=c.lookup("pendingNotificationType");a.proto_chatType=c.lookup("chatType");a.proto_callType=c.lookup("callType");a.proto_isFocusStatus=c.lookup("appFocusStatus");a.direction_enum=c.lookup("sendDirection");a.contact_type=c.lookup("contactType");a.contactsStatus=
{293:{status:"PresenceUpdate"},81:{status:"ProfileChanged"},5:{status:"UserJoined"}};a.chatRequestType={9:"NEW-MESSAGE",10:"SENT",11:"DELIVERED",13:"READ",307:"IS-COMPOSING"};a.recentMsgType={0:{type:"UNKNOWN"},1:{type:"CHAT"},2:{type:"GROUP-CHAT"},3:{type:"CALL"}};a.chatStatus={0:{status:"Unknown"},1:{status:"SENT"},2:{status:"DELIVERED"},3:{status:"READ"}};a.chatType={0:{type:"Unknown"},1:{type:"Text"},2:{type:"html"},3:{type:"location"},4:{type:"image"},5:{type:"video"},6:{type:"contact"},7:{type:"document"}};
a.direction={0:{type:"Unknown"},1:{type:"Outgoing"},2:{type:"Incoming"}};a.callStatus={0:{status:"Unknown"},1:{status:"Missed"},2:{status:"Answered"}};a.callType={0:{type:"Unknown"},1:{type:"Audio"},2:{type:"Video"},3:{type:"Live-Location"},4:{type:"Pstn"}};a.callEventCode={187:{code:"PSTN-OFFER",phrase:"PSTN Call offer received"},193:{code:"ANSWERED",phrase:"Call answered received"},195:{code:"OFFER",phrase:"Call offer received"},197:{code:"ANSWERED",phrase:"Call answered received"},199:{code:"END",
phrase:"Call end received"},206:{code:"END",phrase:"Call end received"},295:{code:"RINGING",phrase:"Remote party ringing"},313:{code:"CALLHISTORYSYNC",phrase:"Call history synchronized"}};a.imlrespcode={1:{code:200,phrase:"OK"},2:{code:202,phrase:"Created"},6:{code:204,phrase:"Resend Activation Code"},3:{code:401,phrase:"Unauthorized"},7:{code:403,phrase:"Forbiddon"},4:{code:409,phrase:"NotAllowed"},11:{code:499,phrase:"User Attached"},5:{code:500,phrase:"Internal Error"},10:{code:703,phrase:"Limit exceeded"}};
a.protoLoad=!0})},v=function(){this.transportType="WebSocket"in b||b.WebSocket?0:1;1==this.transportType&&alert("rest unsupported in current release");this.localuser="";this.OAuthToken=this.localUser=null;this.msg_queue=[];I(this);this.protoVersion=1;this.clientId=0;this.transactionRespCB={};this.respData={};this.s3Bin="";this.osName="Web";this.osVersion="-";this.chat=new m;this.chat.init(this);this.contacts=new H;this.contacts.init(this);this.call=new B;this.call.init(this);this.stream=new D;this.stream.init(this);
this.subModulesLoadComplete=!0},E=function(a){a=b.CS;a.protoLoad&&a.connReady&&(clearInterval(a.intervalTimer),$(b).on("blur focus",function(a){if($(this).data("prevType")!=a.type)switch(a.type){case "blur":l(!0);break;case "focus":l(!1)}$(this).data("prevType",a.type)}),a.initCb(200,"SDK initialized"))};v.prototype.askPushNotificationPermission=function(){OneSignal.push(function(){OneSignal.showHttpPrompt()})};v.prototype.initialize=function(a,k){this.version="0.3.10.2";b.CS.timeOffset=0;0<arguments.length&&
(this.initCb=arguments[arguments.length-1]);this.intervalTimer=setInterval(function(){E(this)},200);var e="iamlivedemo1",h="ap-southeast-1",m="ap-southeast-1:cea94880-b040-46f5-8f91-550a9381142d";u="wss://proxy.vox-cpaas.com:8989";b.CS.rtcservers={};b.CS.rtcservers.stun="stun:stun.l.google.com:19302";b.CS.rtcservers.turn="turn:34.253.104.58:3478?transport=udp";b.CS.rtcservers.turnUser="testuser";b.CS.rtcservers.turnPassword="test";b.CS.appId="";b.CS.jsonPath="/res/iml4.json";2==arguments.length&&
(a=arguments[0],e=a.s3Bucket||e,h=a.s3Region||h,m=a.s3IdentityPoolId||m,b.CS.appId=a.appId||b.CS.appId,b.CS.jsonPath=a.jsonpath||b.CS.jsonPath,a.webrtc&&(v.rtcservers.stun=a.webrtc.stun||v.stun,v.rtcservers.turn=a.webrtc.turn||v.turn,v.rtcservers.turnUser=a.webrtc.turnUser||v.turnUser,v.rtcservers.turnPassword=a.webrtc.turnPassword||v.turnPassword));b.CS.servers={iceServers:[{urls:b.CS.rtcservers.stun},{urls:b.CS.rtcservers.turn,username:b.CS.rtcservers.turnUser,credential:b.CS.rtcservers.turnPassword}]};
AWS.config.update({region:h,credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:m})});this.s3=new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:e}});setTimeout(G,100);(e=c("iml_dev_id"))?b.CS.deviceId=e:(b.CS.deviceId=f().toString(),d("iml_dev_id",b.CS.deviceId,9999));b.CS.clientId="iamlive_web"};v.prototype.logout=function(){this.ws.close()};v.prototype.createTempUser=function(a,b,c){$.ajax({type:"POST",dataType:"json",url:"https://proxy.vox-cpaas.com:9295/api/createuser",data:"username="+
a+"&password="+b,success:function(e){"Created"==e?c(200,{user:a,pass:b}):c(500,"Internal Error")},failure:function(){c(500,"Internal Error")}})};v.prototype.signup=function(a,c,e){this.localUser=a;this.OAuthToken=c;a=f();b.CS.transactionRespCB[a]=e;e=new jsSHA("SHA-256","TEXT");e.update(this.localUser+this.OAuthToken);e=e.getHash("HEX");e={uVersion:this.protoVersion,stSignUpReq:{stHdrs:{sMobNu:this.localUser,sClientId:this.clientId,ullTransId:a},sPassHash:e,sAuth:"auth string",sAppName:"web-sdk",
stOSName:this.proto_osType.values.E_WEB,sOSVersion:this.osVersion}};b.CS.appId&&(e.stSignUpReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});r(this,!0,this.proto_msgType.values.E_SIGNUP_RQT,e)};v.prototype.activate=function(a,c,e){var d=f();b.CS.transactionRespCB[d]=e;a={uVersion:this.protoVersion,stActivateReq:{stHdrs:{sMobNu:a,sClientId:this.clientId,ullTransId:d},sActCode:c}};b.CS.appId&&(a.stActivateReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});
r(this,!0,this.proto_msgType.values.E_ACTIVATE_RQT,a)};v.prototype.send_msg=r;v.prototype.login=function(a,b,c){this.localUser=a;this.OAuthToken=b;try{OneSignal&&OneSignal.push(["addListenerForNotificationOpened",function(a){console.log("Received NotificationOpened:");console.log(a);a=clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(a){for(var b=0;b<a.length;b++)console.log(winowClient)});event.waitUntil(a)}])}catch(C){console.log("one signal error "+C.message)}finally{}z(this,
c)};b.CS=new v})(window,void 0);navigator.sayswho=function(){var b=navigator.userAgent,a=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){var c=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(c[1]||"")}if("Chrome"===a[1]&&(c=b.match(/\b(OPR|Edge)\/(\d+)/),null!=c))return c.slice(1).join(" ").replace("OPR","Opera");a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=b.match(/version\/(\d+)/i))&&a.splice(1,1,c[1]);return a.join(" ")}();
function mozVidFreezeModSdp(b){try{console.log(b);var a=b.match(/m=video.*/g);if(!a)return b;console.log("sdp match");console.log(a);a=a[0];nums=a.match(/[0-9 ]*$/)[0].trim().split(" ");for(var c in nums){var d="a=rtpmap:"+nums[c]+" VP8/90000",f=b.search(d);-1==f&&(d="a=rtpmap:"+nums[c]+" VP9/90000",f=b.search("a=rtpmap:"+nums[c]+" VP9/90000"));if(-1!=f){var l=b.match(new RegExp("a=fmtp:"+nums[c]+".*"));if(l){if(l=l[0],console.log(l),l&&-1==l.search("max-fs")){var u=l.replace("a=fmtp:"+nums[c]+" ",
"a=fmtp:"+nums[c]+" max-fs=12288;");b=b.replace(l,u)}}else console.log("src:"+d),console.log("dst:"+d+"\r\na=fmtp:"+nums[c]+" max-fs=12288"),b=b.replace(d,d+"\r\na=fmtp:"+nums[c]+" max-fs=12288")}}console.log(b)}catch(x){console.log("Err "+x)}return b}
var wr_recv_rem_offer=function(b,a,c,d,f){var l=window.CS.call;l.localUiElem=document.getElementById(a);l.remoteUiElem=document.getElementById(d);l.remoteSDP="Firefox 56"==navigator.sayswho||"Firefox 57"==navigator.sayswho?mozVidFreezeModSdp(f.sSdp):f.sSdp;console.log("wr_recv_rem_offer");navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(a){wr_get_local_stream_to_answer(a,b)})["catch"](getUserMediaFailed)},getUserMediaFailed=function(b){console.log("Get User Media Failed: ",b)},
wr_on_error=function(b){console.log("error: ",b)},wr_recv_rem_end=function(){var b=window.CS.call;b.peerConnection&&(b.localStream.getTracks().forEach(function(a){a.stop()}),b.peerConnection.close(),b.peerConnection=null);b.localUiElem&&(b.localUiElem.srcObject=void 0);b.remoteUiElem&&(b.remoteUiElem.srcObject=void 0)},wr_recv_rem_ice=function(b,a){if(0!=b.sJsonIceCandidates.length)for(var c=window.CS.call,d=0;d<b.sJsonIceCandidates.length;d++){var f=JSON.parse(b.sJsonIceCandidates[d]).ice;c.peerConnection?
c.peerConnection.addIceCandidate(new RTCIceCandidate(f)):(console.log("ice candidate before peer connection creation"),c.callObj[a].iceCandidates.push(f))}},wr_recv_rem_answer=function(b,a){var c=window.CS.call;if(c.peerConnection){"Firefox 56"!=navigator.sayswho&&"Firefox 57"!=navigator.sayswho||console.log(" received answer sdp before modification "+b);b=mozVidFreezeModSdp(b);console.log(" received answer sdp after modification "+b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",
sdp:b}));for(var d=c.callObj[a].iceCandidates.length,f=0;f<d;f++){var l=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(l))}}},wr_handleError=function(b){},wr_gotRemoteStream=function(b){var a=window.CS.call;a.remoteUiElem.srcObject!==b.stream&&(a.remoteUiElem.srcObject=b.stream,console.log("Received remote stream"))},wr_get_local_sdp=function(b,a){var c=window.CS.call;console.log(" local sdp "+b.sdp);c.peerConnection.setLocalDescription(b).then(function(){sendLocalSDPOffer(a)})["catch"](wr_on_error)};
function randNum(){return Math.ceil(1E9*Math.random())}
var sendLocalSDPOffer=function(b){var a=window.CS.call,c=randNum();"IP"==a.callObj[b].type?(b={uVersion:a["super"].protoVersion,stDirectAudioVideoCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VIDEOCALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp,sCallActive:!0,sStartTime:Math.floor(Date.now())}},a.isVideoCall||(b.stDirectAudioVideoCallStartReq.stCallType=a["super"].proto_callType.values.E_VOICECALL),
window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT,b)):"PSTN"==a.callObj[b].type&&(b={uVersion:a["super"].protoVersion,stCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VOICECALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp}},window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_CALL_START_RQT,b))},wr_send_remote_answer=
function(b,a){var c=window.CS.call;c.peerConnection.setLocalDescription(b).then(function(){sendAnswerSDP(a)})["catch"](wr_on_error);var d=c.callObj[a].iceCandidates.length;console.log("send_remote_answer iceCandidates len "+d);for(var f=0;f<d;f++){var l=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(l));console.log("callee adding ice "+f)}},sendAnswerSDP=function(b){var a=window.CS.call;a.sendAnswer(b,a.peerConnection.localDescription.sdp,function(a,b){console.log("answer sent "+
a)})},wr_send_rem_call_end=function(){var b=window.CS.call;b.localStream&&b.localStream.getTracks().forEach(function(a){a.stop()});b.peerConnection&&(b.peerConnection.close(),b.peerConnection=null,b.localUiElem.srcObject=void 0,b.remoteUiElem.srcObject=void 0)};window.CS.servers={iceServers:[{urls:window.CS.stun},{urls:window.CS.turn,username:window.CS.turnUser,credential:window.CS.turnPassword}]};
var wr_get_local_stream_to_answer=function(b,a){var c=window.CS.call;c.localUiElem.srcObject=b;c.localStream=b;console.log("wr_get_local_stream_to_answer");c.peerConnection=new RTCPeerConnection(window.CS.servers);c.peerConnection.onicecandidate=function(b){if(b.candidate){var d=JSON.stringify({ice:b.candidate});c.sendIce(c.remoteUser,b.candidate.candidate,d,a,function(a,b){})}};c.peerConnection.onaddstream=wr_gotRemoteStream;c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.onsignalingstatechange=
function(a){};c.peerConnection.addStream(b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:c.remoteSDP}));c.peerConnection.createAnswer().then(function(b){wr_send_remote_answer(b,a)})["catch"](wr_handleError)},wr_create_local_stream_to_offer=function(b,a){var c=window.CS.call;c.localUiElem.srcObject=b;c.localStream=b;c.peerConnection=new RTCPeerConnection(window.CS.servers);console.log("created peer connection");c.peerConnection.onicecandidate=function(b){if(b.candidate){var d=
JSON.stringify({ice:b.candidate});c.sendIce(c.remoteUser,b.candidate.candidate,d,a,function(a,b){console.log("response from sendicetoserver "+a)})}};c.peerConnection.onaddstream=wr_gotRemoteStream;c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.addStream(b);c.peerConnection.createOffer().then(function(b){wr_get_local_sdp(b,a)})["catch"](wr_handleError)},wr_send_rem_call=function(b,a,c,d,f){b.localUiElem=document.getElementById(d);
b.remoteUiElem=document.getElementById(f);navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(b){wr_create_local_stream_to_offer(b,a)})["catch"](getUserMediaFailed)},wr_set_local_mute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!1)});c(100,"Ok")},wr_set_local_unmute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!0)});c(100,"Ok")};
(function(b){function a(a,b,c){var m=0,v=[],g=0,h,k,e,q=!1,F=[],r=[],p=!1;c=c||{};var t=c.encoding||"UTF8",w=c.numRounds||1;if(w!==parseInt(w,10)||1>w)throw Error("numRounds must a integer >= 1");if(0===a.lastIndexOf("SHA-",0))if(h=function(b,c){return B(b,c,a)},k=function(b,c,e,d){if("SHA-224"===a||"SHA-256"===a)var h=(c+65>>>9<<4)+15,k=16;else throw Error("Unexpected error in SHA-2 implementation");for(;b.length<=h;)b.push(0);b[c>>>5]|=128<<24-c%32;c+=e;b[h]=c&4294967295;b[h-1]=c/4294967296|0;e=
b.length;for(c=0;c<e;c+=k)d=B(b.slice(c,c+k),d,a);if("SHA-224"===a)b=[d[0],d[1],d[2],d[3],d[4],d[5],d[6]];else if("SHA-256"===a)b=d;else throw Error("Unexpected error in SHA-2 implementation");return b},e=function(a){return a.slice()},"SHA-224"===a)var y=512,M=224;else if("SHA-256"===a)y=512,M=256;else throw Error("Chosen SHA variant is not supported");else throw Error("Chosen SHA variant is not supported");var z=n(b,t),A=D(a);this.setHMACKey=function(b,c,e){if(!0===q)throw Error("HMAC key already set");
if(!0===p)throw Error("Cannot set HMAC key after calling update");t=(e||{}).encoding||"UTF8";c=n(c,t)(b);b=c.binLen;c=c.value;var d=y>>>3;e=d/4-1;if(d<b/8){for(c=k(c,b,0,D(a));c.length<=e;)c.push(0);c[e]&=4294967040}else if(d>b/8){for(;c.length<=e;)c.push(0);c[e]&=4294967040}for(b=0;b<=e;b+=1)F[b]=c[b]^909522486,r[b]=c[b]^1549556828;A=h(F,A);m=y;q=!0};this.update=function(a){var b,c=0,e=y>>>5,d=z(a,v,g);a=d.binLen;var k=d.value;d=a>>>5;for(b=0;b<d;b+=e)c+y<=a&&(A=h(k.slice(b,b+e),A),c+=y);m+=c;v=
k.slice(c>>>5);g=a%y;p=!0};this.getHash=function(b,c){if(!0===q)throw Error("Cannot call getHash after setting HMAC key");var h=x(c);switch(b){case "HEX":var E=function(a){return d(a,M,h)};break;case "B64":E=function(a){return f(a,M,h)};break;case "BYTES":E=function(a){return l(a,M)};break;case "ARRAYBUFFER":try{var I=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}E=function(a){return u(a,M)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");
}var F=k(v.slice(),g,m,e(A));for(I=1;I<w;I+=1)F=k(F,M,0,D(a));return E(F)};this.getHMAC=function(b,c){if(!1===q)throw Error("Cannot call getHMAC without first setting HMAC key");var E=x(c);switch(b){case "HEX":var I=function(a){return d(a,M,E)};break;case "B64":I=function(a){return f(a,M,E)};break;case "BYTES":I=function(a){return l(a,M)};break;case "ARRAYBUFFER":try{I=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}I=function(a){return u(a,M)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}var F=k(v.slice(),g,m,e(A)),n=h(r,D(a));n=k(F,M,y,n);return I(n)}}function c(){}function d(a,b,c){var d="";b/=8;var f;for(f=0;f<b;f+=1){var m=a[f>>>2]>>>8*(3+f%4*-1);d+="0123456789abcdef".charAt(m>>>4&15)+"0123456789abcdef".charAt(m&15)}return c.outputUpper?d.toUpperCase():d}function f(a,b,c){var d="",f=b/8,m;for(m=0;m<f;m+=3){var h=m+1<f?a[m+1>>>2]:0,k=m+2<f?a[m+2>>>2]:0;k=(a[m>>>2]>>>8*(3+m%4*-1)&255)<<16|(h>>>8*(3+(m+1)%4*-1)&255)<<8|k>>>8*(3+(m+2)%4*-1)&255;for(h=0;4>h;h+=1)8*m+6*h<=b?d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>
6*(3-h)&63):d+=c.b64Pad}return d}function l(a,b){var c="",d=b/8,f;for(f=0;f<d;f+=1)c+=String.fromCharCode(a[f>>>2]>>>8*(3+f%4*-1)&255);return c}function u(a,b){var c=b/8,d,f=new ArrayBuffer(c),m=new Uint8Array(f);for(d=0;d<c;d+=1)m[d]=a[d>>>2]>>>8*(3+d%4*-1)&255;return f}function x(a){var b={outputUpper:!1,b64Pad:"=",shakeLen:-1};a=a||{};b.outputUpper=a.outputUpper||!1;!0===a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");
if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function n(a,b){switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(a){case "HEX":var c=function(a,b,c){var d=a.length,f,e;if(0!==d%2)throw Error("String of HEX type must be in byte increments");b=b||[0];c=c||0;var m=c>>>3;for(f=0;f<d;f+=2){var v=parseInt(a.substr(f,2),16);if(isNaN(v))throw Error("String of HEX type contains invalid characters");
var g=(f>>>1)+m;for(e=g>>>2;b.length<=e;)b.push(0);b[e]|=v<<8*(3+g%4*-1)}return{value:b,binLen:4*d+c}};break;case "TEXT":c=function(a,c,d){var h=0,f,e,m;c=c||[0];d=d||0;var v=d>>>3;if("UTF8"===b){var g=3;for(f=0;f<a.length;f+=1){var q=a.charCodeAt(f),l=[];128>q?l.push(q):2048>q?(l.push(192|q>>>6),l.push(128|q&63)):55296>q||57344<=q?l.push(224|q>>>12,128|q>>>6&63,128|q&63):(f+=1,q=65536+((q&1023)<<10|a.charCodeAt(f)&1023),l.push(240|q>>>18,128|q>>>12&63,128|q>>>6&63,128|q&63));for(e=0;e<l.length;e+=
1){var E=h+v;for(m=E>>>2;c.length<=m;)c.push(0);c[m]|=l[e]<<8*(g+E%4*-1);h+=1}}}else if("UTF16BE"===b||"UTF16LE"===b)for(g=2,l="UTF16LE"===b&&!0||"UTF16LE"!==b&&!1,f=0;f<a.length;f+=1){q=a.charCodeAt(f);!0===l&&(e=q&255,q=e<<8|q>>>8);E=h+v;for(m=E>>>2;c.length<=m;)c.push(0);c[m]|=q<<8*(g+E%4*-1);h+=2}return{value:c,binLen:8*h+d}};break;case "B64":c=function(a,b,c){var d=0,f,e;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");var m=a.indexOf("=");a=a.replace(/=/g,
"");if(-1!==m&&m<a.length)throw Error("Invalid '=' found in base-64 string");b=b||[0];c=c||0;var g=c>>>3;for(m=0;m<a.length;m+=4){var v=a.substr(m,4);for(f=e=0;f<v.length;f+=1){var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(v[f]);e|=q<<18-6*f}for(f=0;f<v.length-1;f+=1){var l=d+g;for(q=l>>>2;b.length<=q;)b.push(0);b[q]|=(e>>>16-8*f&255)<<8*(3+l%4*-1);d+=1}}return{value:b,binLen:8*d+c}};break;case "BYTES":c=function(a,b,c){var d;b=b||[0];c=c||0;var f=c>>>3;for(d=0;d<
a.length;d+=1){var e=a.charCodeAt(d),m=d+f,g=m>>>2;b.length<=g&&b.push(0);b[g]|=e<<8*(3+m%4*-1)}return{value:b,binLen:8*a.length+c}};break;case "ARRAYBUFFER":try{c=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}c=function(a,b,c){var d;b=b||[0];c=c||0;var f=c>>>3,e=new Uint8Array(a);for(d=0;d<a.byteLength;d+=1){var m=d+f,g=m>>>2;b.length<=g&&b.push(0);b[g]|=e[d]<<8*(3+m%4*-1)}return{value:b,binLen:8*a.byteLength+c}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");
}return c}function g(a,b){return a>>>b|a<<32-b}function w(a,b,c){return a&b^~a&c}function p(a,b,c){return a&b^a&c^b&c}function t(a){return g(a,2)^g(a,13)^g(a,22)}function y(a){return g(a,6)^g(a,11)^g(a,25)}function r(a){return g(a,7)^g(a,18)^a>>>3}function z(a){return g(a,17)^g(a,19)^a>>>10}function A(a,b){var c=(a&65535)+(b&65535);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function J(a,b,c,d){var f=(a&65535)+(b&65535)+(c&65535)+(d&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(f>>>
16)&65535)<<16|f&65535}function G(a,b,c,d,f){var g=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(f&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(f>>>16)+(g>>>16)&65535)<<16|g&65535}function D(a){var b,d;if(0===a.lastIndexOf("SHA-",0))switch(b=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],d=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],a){case "SHA-224":break;case "SHA-256":b=d;break;case "SHA-384":b=[new c,new c,
new c,new c,new c,new c,new c,new c];break;case "SHA-512":b=[new c,new c,new c,new c,new c,new c,new c,new c];break;default:throw Error("Unknown SHA variant");}else throw Error("No SHA variants supported");return b}function B(a,b,c){var d,f,g,h=[];if("SHA-224"===c||"SHA-256"===c)var k=64,e=1,m=Number,l=A,q=J,n=G,u=r,F=z,x=t,B=y,D=p,S=w,T=H;else throw Error("Unexpected error in SHA-2 implementation");c=b[0];var P=b[1],N=b[2],Q=b[3],L=b[4],O=b[5],K=b[6],R=b[7];for(g=0;g<k;g+=1)16>g?(f=g*e,d=a.length<=
f?0:a[f],f=a.length<=f+1?0:a[f+1],h[g]=new m(d,f)):h[g]=q(F(h[g-2]),h[g-7],u(h[g-15]),h[g-16]),d=n(R,B(L),S(L,O,K),T[g],h[g]),f=l(x(c),D(c,P,N)),R=K,K=O,O=L,L=l(Q,d),Q=N,N=P,P=c,c=l(d,f);b[0]=l(c,b[0]);b[1]=l(P,b[1]);b[2]=l(N,b[2]);b[3]=l(Q,b[3]);b[4]=l(L,b[4]);b[5]=l(O,b[5]);b[6]=l(K,b[6]);b[7]=l(R,b[7]);return b}var H=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,
4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];
"function"===typeof define&&define.amd?define(function(){return a}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=a),exports=a):b.jsSHA=a})(this);var recorder_g,is_recording_g=!1,localStream_g=null,callId_g,is_video_call_g=!1,blob_g;
navigator.sayswho=function(){var b=navigator.userAgent,a=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){var c=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(c[1]||"")}if("Chrome"===a[1]&&(c=b.match(/\b(OPR|Edge)\/(\d+)/),null!=c))return c.slice(1).join(" ").replace("OPR","Opera");a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=b.match(/version\/(\d+)/i))&&a.splice(1,1,c[1]);return a.join(" ")}();
function mozVidFreezeModSdp(b){try{console.log(b);var a=b.match(/m=video.*/g);if(!a)return b;console.log("sdp match");console.log(a);a=a[0];nums=a.match(/[0-9 ]*$/)[0].trim().split(" ");for(var c in nums){var d="a=rtpmap:"+nums[c]+" VP8/90000",f=b.search(d);-1==f&&(d="a=rtpmap:"+nums[c]+" VP9/90000",f=b.search("a=rtpmap:"+nums[c]+" VP9/90000"));if(-1!=f){var l=b.match(new RegExp("a=fmtp:"+nums[c]+".*"));if(l){if(l=l[0],console.log(l),l&&-1==l.search("max-fs")){var u=l.replace("a=fmtp:"+nums[c]+" ",
"a=fmtp:"+nums[c]+" max-fs=12288;");b=b.replace(l,u)}}else console.log("src:"+d),console.log("dst:"+d+"\r\na=fmtp:"+nums[c]+" max-fs=12288"),b=b.replace(d,d+"\r\na=fmtp:"+nums[c]+" max-fs=12288")}}console.log(b)}catch(x){console.log("Err "+x)}return b}
wr_recv_rem_offer=function(b,a,c,d,f){var l=window.CS.call;l.localUiElem=document.getElementById(a);l.remoteUiElem=document.getElementById(d);l.remoteSDP="Firefox 56"==navigator.sayswho||"Firefox 57"==navigator.sayswho?mozVidFreezeModSdp(f.sSdp):f.sSdp;console.log("wr_recv_rem_offer");navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(a){wr_get_local_stream_to_answer(a,b)})["catch"](getUserMediaFailed)};getUserMediaFailed=function(b){console.log("Get User Media Failed: ",b)};
wr_on_error=function(b){console.log("error: ",b)};var stopCallRecording=function(){is_recording_g&&(recorder_g.stopRecording(function(){blob_g=recorder_g.getBlob();recorder_g=localStream_g=callId_g=null}),is_recording_g=!1)},wr_save_recording=function(b,a){invokeSaveAsDialog(blob_g,a)},wr_delete_recording=function(b){blob_g=null};
wr_recv_rem_end=function(){var b=window.CS.call;b.peerConnection&&(b.localStream.getTracks().forEach(function(a){a.stop()}),b.peerConnection.close(),b.peerConnection=null);b.localUiElem&&(b.localUiElem.srcObject=void 0);b.remoteUiElem&&(b.remoteUiElem.srcObject=void 0);stopCallRecording()};
wr_recv_rem_ice=function(b,a){if(0!=b.sJsonIceCandidates.length)for(var c=window.CS.call,d=0;d<b.sJsonIceCandidates.length;d++){var f=JSON.parse(b.sJsonIceCandidates[d]).ice;c.peerConnection?c.peerConnection.addIceCandidate(new RTCIceCandidate(f)):(console.log("ice candidate before peer connection creation"),c.callObj[a].iceCandidates.push(f))}};
wr_recv_rem_answer=function(b,a){var c=window.CS.call;if(c.peerConnection){if("Firefox 56"==navigator.sayswho||"Firefox 57"==navigator.sayswho)console.log(" received answer sdp before modification "+b),b=mozVidFreezeModSdp(b),console.log(" received answer sdp after modification "+b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:b}));for(var d=c.callObj[a].iceCandidates.length,f=0;f<d;f++){var l=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(l))}}};
wr_handleError=function(b){};wr_gotRemoteStream=function(b){var a=window.CS.call;a.remoteUiElem.srcObject!==b.stream&&(a.remoteUiElem.srcObject=b.stream,console.log("Received remote stream"),callId_g&&window.CS.call.callObj[callId_g].is_record_callTrue&&(console.log(b.stream.getAudioTracks()),config={},config=is_video_call_g?{type:"video",mimeType:"video/webm"}:{type:"audio",mimeType:"audio/webm"},recorder_g=RecordRTC([b.stream,localStream_g],config),is_recording_g=!0,recorder_g.startRecording()))};
wr_get_local_sdp=function(b,a){var c=window.CS.call;console.log(" local sdp "+b.sdp);c.peerConnection.setLocalDescription(b).then(function(){sendLocalSDPOffer(a)})["catch"](wr_on_error)};function randNum(){return Math.ceil(1E9*Math.random())}
sendLocalSDPOffer=function(b){var a=window.CS.call,c=randNum();"IP"==a.callObj[b].type?(b={uVersion:a["super"].protoVersion,stDirectAudioVideoCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VIDEOCALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp,sCallActive:!0,sStartTime:Math.floor(Date.now())}},a.isVideoCall||(b.stDirectAudioVideoCallStartReq.stCallType=a["super"].proto_callType.values.E_VOICECALL),
window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT,b)):"PSTN"==a.callObj[b].type&&(b={uVersion:a["super"].protoVersion,stCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VOICECALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp}},window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_CALL_START_RQT,b))};
wr_send_remote_answer=function(b,a){var c=window.CS.call;c.peerConnection.setLocalDescription(b).then(function(){sendAnswerSDP(a)})["catch"](wr_on_error);var d=c.callObj[a].iceCandidates.length;console.log("send_remote_answer iceCandidates len "+d);for(var f=0;f<d;f++){var l=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(l));console.log("callee adding ice "+f)}};
sendAnswerSDP=function(b){var a=window.CS.call;a.sendAnswer(b,a.peerConnection.localDescription.sdp,function(a,b){console.log("answer sent "+a)})};wr_send_rem_call_end=function(){var b=window.CS.call;b.localStream&&b.localStream.getTracks().forEach(function(a){a.stop()});stopCallRecording();b.peerConnection&&(b.peerConnection.close(),b.peerConnection=null,b.localUiElem.srcObject=void 0,b.remoteUiElem.srcObject=void 0)};
window.CS.servers={iceServers:[{urls:window.CS.stun},{urls:window.CS.turn,username:window.CS.turnUser,credential:window.CS.turnPassword}]};
wr_get_local_stream_to_answer=function(b,a){var c=window.CS.call;c.localUiElem.srcObject=b;c.localStream=b;console.log("wr_get_local_stream_to_answer");c.peerConnection=new RTCPeerConnection(window.CS.servers);c.peerConnection.onicecandidate=function(b){if(b.candidate){var d=JSON.stringify({ice:b.candidate});c.sendIce(c.remoteUser,b.candidate.candidate,d,a,function(a,b){})}};c.peerConnection.onaddstream=wr_gotRemoteStream;c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.onsignalingstatechange=
function(a){};c.peerConnection.addStream(b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:c.remoteSDP}));c.peerConnection.createAnswer().then(function(b){wr_send_remote_answer(b,a)})["catch"](wr_handleError)};
wr_create_local_stream_to_offer=function(b,a,c){var d=window.CS.call;d.localUiElem.srcObject=b;d.localStream=b;localStream_g=window.CS.call.callObj[a].localStream=b;callId_g=a;d.peerConnection=new RTCPeerConnection(window.CS.servers);console.log("created peer connection");d.peerConnection.onicecandidate=function(b){if(b.candidate){var c=JSON.stringify({ice:b.candidate});d.sendIce(d.remoteUser,b.candidate.candidate,c,a,function(a,b){console.log("response from sendicetoserver "+a)})}};d.peerConnection.onaddstream=
wr_gotRemoteStream;d.peerConnection.onsignalingstatechange=function(a){};d.peerConnection.onsignalingstatechange=function(a){};d.peerConnection.addStream(b);d.peerConnection.createOffer().then(function(b){wr_get_local_sdp(b,a)})["catch"](wr_handleError)};
wr_send_rem_call=function(b,a,c,d,f){b.localUiElem=document.getElementById(d);b.remoteUiElem=document.getElementById(f);is_video_call_g=c;navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(b){wr_create_local_stream_to_offer(b,a,c)})["catch"](getUserMediaFailed)};wr_set_local_mute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!1)});c(100,"Ok")};
wr_set_local_unmute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!0)});c(100,"Ok")};(function(b){function a(a,b,c){var g=0,m=[],q=0,h,k,e,r=!1,p=[],t=[],w=!1;c=c||{};var F=c.encoding||"UTF8";var y=c.numRounds||1;if(y!==parseInt(y,10)||1>y)throw Error("numRounds must a integer >= 1");if(0===a.lastIndexOf("SHA-",0))if(h=function(b,c){return B(b,c,a)},k=function(b,c,d,e){if("SHA-224"===a||"SHA-256"===a){var f=(c+65>>>9<<4)+15;var h=16}else throw Error("Unexpected error in SHA-2 implementation");for(;b.length<=f;)b.push(0);b[c>>>5]|=128<<24-c%32;c+=d;b[f]=c&4294967295;b[f-1]=c/4294967296|
0;d=b.length;for(c=0;c<d;c+=h)e=B(b.slice(c,c+h),e,a);if("SHA-224"===a)b=[e[0],e[1],e[2],e[3],e[4],e[5],e[6]];else if("SHA-256"===a)b=e;else throw Error("Unexpected error in SHA-2 implementation");return b},e=function(a){return a.slice()},"SHA-224"===a){var A=512;var z=224}else if("SHA-256"===a)A=512,z=256;else throw Error("Chosen SHA variant is not supported");else throw Error("Chosen SHA variant is not supported");var H=n(b,F);var G=D(a);this.setHMACKey=function(b,c,d){if(!0===r)throw Error("HMAC key already set");
if(!0===w)throw Error("Cannot set HMAC key after calling update");F=(d||{}).encoding||"UTF8";c=n(c,F)(b);b=c.binLen;c=c.value;var e=A>>>3;d=e/4-1;if(e<b/8){for(c=k(c,b,0,D(a));c.length<=d;)c.push(0);c[d]&=4294967040}else if(e>b/8){for(;c.length<=d;)c.push(0);c[d]&=4294967040}for(b=0;b<=d;b+=1)p[b]=c[b]^909522486,t[b]=c[b]^1549556828;G=h(p,G);g=A;r=!0};this.update=function(a){var b,c=0,d=A>>>5;var e=H(a,m,q);a=e.binLen;var f=e.value;e=a>>>5;for(b=0;b<e;b+=d)c+A<=a&&(G=h(f.slice(b,b+d),G),c+=A);g+=
c;m=f.slice(c>>>5);q=a%A;w=!0};this.getHash=function(b,c){if(!0===r)throw Error("Cannot call getHash after setting HMAC key");var h=x(c);switch(b){case "HEX":var v=function(a){return d(a,z,h)};break;case "B64":v=function(a){return f(a,z,h)};break;case "BYTES":v=function(a){return l(a,z)};break;case "ARRAYBUFFER":try{var n=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}v=function(a){return u(a,z)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");
}var p=k(m.slice(),q,g,e(G));for(n=1;n<y;n+=1)p=k(p,z,0,D(a));return v(p)};this.getHMAC=function(b,c){if(!1===r)throw Error("Cannot call getHMAC without first setting HMAC key");var v=x(c);switch(b){case "HEX":var n=function(a){return d(a,z,v)};break;case "B64":n=function(a){return f(a,z,v)};break;case "BYTES":n=function(a){return l(a,z)};break;case "ARRAYBUFFER":try{n=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}n=function(a){return u(a,z)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}var p=k(m.slice(),q,g,e(G));var E=h(t,D(a));E=k(p,z,A,E);return n(E)}}function c(){}function d(a,b,c){var d="";b/=8;var f;for(f=0;f<b;f+=1){var g=a[f>>>2]>>>8*(3+f%4*-1);d+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15)}return c.outputUpper?d.toUpperCase():d}function f(a,b,c){var d="",f=b/8,g;for(g=0;g<f;g+=3){var h=g+1<f?a[g+1>>>2]:0;var k=g+2<f?a[g+2>>>2]:0;k=(a[g>>>2]>>>8*(3+g%4*-1)&255)<<16|(h>>>8*(3+(g+1)%4*-1)&255)<<8|k>>>8*(3+(g+2)%4*-1)&255;for(h=0;4>h;h+=1)8*g+6*h<=
b?d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-h)&63):d+=c.b64Pad}return d}function l(a,b){var c="",d=b/8,f;for(f=0;f<d;f+=1){var g=a[f>>>2]>>>8*(3+f%4*-1)&255;c+=String.fromCharCode(g)}return c}function u(a,b){var c=b/8,d,f=new ArrayBuffer(c);var g=new Uint8Array(f);for(d=0;d<c;d+=1)g[d]=a[d>>>2]>>>8*(3+d%4*-1)&255;return f}function x(a){var b={outputUpper:!1,b64Pad:"=",shakeLen:-1};a=a||{};b.outputUpper=a.outputUpper||!1;!0===a.hasOwnProperty("b64Pad")&&
(b.b64Pad=a.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function n(a,b){switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(a){case "HEX":var c=function(a,b,c){var d=a.length,f,e;if(0!==d%2)throw Error("String of HEX type must be in byte increments");b=b||[0];c=c||0;var g=c>>>3;for(f=
0;f<d;f+=2){var m=parseInt(a.substr(f,2),16);if(isNaN(m))throw Error("String of HEX type contains invalid characters");var l=(f>>>1)+g;for(e=l>>>2;b.length<=e;)b.push(0);b[e]|=m<<8*(3+l%4*-1)}return{value:b,binLen:4*d+c}};break;case "TEXT":c=function(a,c,d){var f=0,g,e,m;c=c||[0];d=d||0;var l=d>>>3;if("UTF8"===b){var v=3;for(g=0;g<a.length;g+=1){var q=a.charCodeAt(g);var n=[];128>q?n.push(q):2048>q?(n.push(192|q>>>6),n.push(128|q&63)):55296>q||57344<=q?n.push(224|q>>>12,128|q>>>6&63,128|q&63):(g+=
1,q=65536+((q&1023)<<10|a.charCodeAt(g)&1023),n.push(240|q>>>18,128|q>>>12&63,128|q>>>6&63,128|q&63));for(e=0;e<n.length;e+=1){var p=f+l;for(m=p>>>2;c.length<=m;)c.push(0);c[m]|=n[e]<<8*(v+p%4*-1);f+=1}}}else if("UTF16BE"===b||"UTF16LE"===b)for(v=2,n="UTF16LE"===b&&!0||"UTF16LE"!==b&&!1,g=0;g<a.length;g+=1){q=a.charCodeAt(g);!0===n&&(e=q&255,q=e<<8|q>>>8);p=f+l;for(m=p>>>2;c.length<=m;)c.push(0);c[m]|=q<<8*(v+p%4*-1);f+=2}return{value:c,binLen:8*f+d}};break;case "B64":c=function(a,b,c){var d=0,f,
e;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");var g=a.indexOf("=");a=a.replace(/=/g,"");if(-1!==g&&g<a.length)throw Error("Invalid '=' found in base-64 string");b=b||[0];c=c||0;var m=c>>>3;for(g=0;g<a.length;g+=4){var l=a.substr(g,4);for(f=e=0;f<l.length;f+=1){var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[f]);e|=q<<18-6*f}for(f=0;f<l.length-1;f+=1){var n=d+m;for(q=n>>>2;b.length<=q;)b.push(0);b[q]|=(e>>>16-8*f&255)<<
8*(3+n%4*-1);d+=1}}return{value:b,binLen:8*d+c}};break;case "BYTES":c=function(a,b,c){var d;b=b||[0];c=c||0;var f=c>>>3;for(d=0;d<a.length;d+=1){var e=a.charCodeAt(d);var g=d+f;var m=g>>>2;b.length<=m&&b.push(0);b[m]|=e<<8*(3+g%4*-1)}return{value:b,binLen:8*a.length+c}};break;case "ARRAYBUFFER":try{c=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}c=function(a,b,c){var d;b=b||[0];c=c||0;var f=c>>>3;var e=new Uint8Array(a);for(d=0;d<a.byteLength;d+=1){var g=
d+f;var m=g>>>2;b.length<=m&&b.push(0);b[m]|=e[d]<<8*(3+g%4*-1)}return{value:b,binLen:8*a.byteLength+c}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return c}function g(a,b){return a>>>b|a<<32-b}function w(a,b,c){return a&b^~a&c}function p(a,b,c){return a&b^a&c^b&c}function t(a){return g(a,2)^g(a,13)^g(a,22)}function y(a){return g(a,6)^g(a,11)^g(a,25)}function r(a){return g(a,7)^g(a,18)^a>>>3}function z(a){return g(a,17)^g(a,19)^a>>>10}function A(a,b){var c=
(a&65535)+(b&65535);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function J(a,b,c,d){var f=(a&65535)+(b&65535)+(c&65535)+(d&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(f>>>16)&65535)<<16|f&65535}function G(a,b,c,d,f){var g=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(f&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(f>>>16)+(g>>>16)&65535)<<16|g&65535}function D(a){var b,d;if(0===a.lastIndexOf("SHA-",0))switch(b=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,
3204075428],d=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],a){case "SHA-224":break;case "SHA-256":b=d;break;case "SHA-384":b=[new c,new c,new c,new c,new c,new c,new c,new c];break;case "SHA-512":b=[new c,new c,new c,new c,new c,new c,new c,new c];break;default:throw Error("Unknown SHA variant");}else throw Error("No SHA variants supported");return b}function B(a,b,c){var d,f,g,h=[];if("SHA-224"===c||"SHA-256"===c){var k=64;var e=1;var l=Number;var m=A;
var n=J;var q=G;var u=r;var x=z;var B=t;var D=y;var F=p;var S=w;var T=H}else throw Error("Unexpected error in SHA-2 implementation");c=b[0];var P=b[1];var N=b[2];var Q=b[3];var L=b[4];var O=b[5];var K=b[6];var R=b[7];for(g=0;g<k;g+=1)16>g?(f=g*e,d=a.length<=f?0:a[f],f=a.length<=f+1?0:a[f+1],h[g]=new l(d,f)):h[g]=n(x(h[g-2]),h[g-7],u(h[g-15]),h[g-16]),d=q(R,D(L),S(L,O,K),T[g],h[g]),f=m(B(c),F(c,P,N)),R=K,K=O,O=L,L=m(Q,d),Q=N,N=P,P=c,c=m(d,f);b[0]=m(c,b[0]);b[1]=m(P,b[1]);b[2]=m(N,b[2]);b[3]=m(Q,b[3]);
b[4]=m(L,b[4]);b[5]=m(O,b[5]);b[6]=m(K,b[6]);b[7]=m(R,b[7]);return b}var H=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,
2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];"function"===typeof define&&define.amd?define(function(){return a}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=a),exports=a):b.jsSHA=a})(this);
