function RecordRTC(b,a){function c(c){c&&(a.initCallback=function(){c();c=a.initCallback=null});m=new (new GetRecorderType(b,a))(b,a);m.record();x("recording");a.disableLogs||console.log("Initialized recorderType:",m.constructor.name,"for output-type:",a.type)}function e(b){function c(c){if(m){Object.keys(m).forEach(function(a){"function"!==typeof m[a]&&(g[a]=m[a])});var e=m.blob;if(!e)if(c)m.blob=e=c;else throw"Recording failed.";e&&!a.disableLogs&&console.log(e.type,"->",bytesToSize(e.size));b&&
(c=URL.createObjectURL(e),"function"===typeof b.call?b.call(g,c):b(c));a.autoWriteToDisk&&u(function(b){var c={};c[a.type+"Blob"]=b;DiskStorage.Store(c)})}else"function"===typeof b.call?b.call(g,""):b("")}b=b||function(){};m?"paused"===g.state?(g.resumeRecording(),setTimeout(function(){e(b)},1)):("recording"===g.state||a.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',g.state),a.disableLogs||console.log("Stopped recording "+a.type+" stream."),"gif"!==
a.type?m.stop(c):(m.stop(),c()),x("stopped")):l()}function f(a){postMessage((new FileReaderSync).readAsDataURL(a))}function u(b,c){function e(a){a=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"}));var b=new Worker(a);URL.revokeObjectURL(a);return b}if(!b)throw"Pass a callback function over getDataURL.";var w=c?c.blob:(m||{}).blob;if(w)if("undefined"===typeof Worker||navigator.mozGetUserMedia){var g=new FileReader;g.readAsDataURL(w);
g.onload=function(a){b(a.target.result)}}else g=e(f),g.onmessage=function(a){b(a.data)},g.postMessage(w);else a.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){u(b,c)},1E3)}function p(a){a=a||0;"paused"===g.state?setTimeout(function(){p(a)},1E3):"stopped"!==g.state&&(a>=g.recordingDuration?e(g.onRecordingStopped):(a+=1E3,setTimeout(function(){p(a)},1E3)))}function x(a){if(g)if(g.state=a,"function"===typeof g.onStateChanged.call)g.onStateChanged.call(g,a);
else g.onStateChanged(a)}function l(){!0!==a.disableLogs&&console.warn(t)}if(!b)throw"First parameter is required.";a=a||{type:"video"};a=new RecordRTCConfiguration(b,a);var g=this,t='It seems that recorder is destroyed or "startRecording" is not invoked for '+a.type+" recorder.",m,r={startRecording:function(e){e&&(a=new RecordRTCConfiguration(b,e));a.disableLogs||console.log("started recording "+a.type+" stream.");if(m)return m.clearRecordedData(),m.record(),x("recording"),g.recordingDuration&&p(),
g;c(function(){g.recordingDuration&&p()});return g},stopRecording:e,pauseRecording:function(){m?"recording"!==g.state?a.disableLogs||console.warn("Unable to pause the recording. Recording state: ",g.state):(x("paused"),m.pause(),a.disableLogs||console.log("Paused recording.")):l()},resumeRecording:function(){m?"paused"!==g.state?a.disableLogs||console.warn("Unable to resume the recording. Recording state: ",g.state):(x("recording"),m.resume(),a.disableLogs||console.log("Resumed recording.")):l()},
initRecorder:c,setRecordingDuration:function(a,b){if("undefined"===typeof a)throw"recordingDuration is required.";if("number"!==typeof a)throw"recordingDuration must be a number.";g.recordingDuration=a;g.onRecordingStopped=b||function(){};return{onRecordingStopped:function(a){g.onRecordingStopped=a}}},clearRecordedData:function(){m?(m.clearRecordedData(),a.disableLogs||console.log("Cleared old recorded data.")):l()},getBlob:function(){if(m)return m.blob;l()},getDataURL:u,toURL:function(){if(m)return URL.createObjectURL(m.blob);
l()},getInternalRecorder:function(){return m},save:function(a){m?invokeSaveAsDialog(m.blob,a):l()},getFromDisk:function(b){m?RecordRTC.getFromDisk(a.type,b):l()},setAdvertisementArray:function(b){a.advertisement=[];for(var c=b.length,e=0;e<c;e++)a.advertisement.push({duration:e,image:b[e]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){m&&"function"===typeof m.clearRecordedData&&m.clearRecordedData();m=null;x("inactive");g.blob=null},onStateChanged:function(b){a.disableLogs||console.log("Recorder state changed:",
b)},state:"inactive",getState:function(){return g.state},destroy:function(){var b=a.disableLogs;a.disableLogs=!0;g.reset();a={};x("destroyed");r=g=null;Storage.AudioContextConstructor&&(Storage.AudioContextConstructor.close(),Storage.AudioContextConstructor=null);b||console.warn("RecordRTC is destroyed.")},version:"5.4.6"};if(!this)return g=r;for(var v in r)this[v]=r[v];g=this;return r}RecordRTC.version="5.4.6";"undefined"!==typeof module&&(module.exports=RecordRTC);
"function"===typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC});RecordRTC.getFromDisk=function(b,a){if(!a)throw"callback is mandatory.";console.log("Getting recorded "+("all"===b?"blobs":b+" blob ")+" from disk!");DiskStorage.Fetch(function(c,e){"all"!==b&&e===b+"Blob"&&a&&a(c);"all"===b&&a&&a(c,e.replace("Blob",""))})};
RecordRTC.writeToDisk=function(b){console.log("Writing recorded blob(s) to disk!");b=b||{};b.audio&&b.video&&b.gif?b.audio.getDataURL(function(a){b.video.getDataURL(function(c){b.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:a,videoBlob:c,gifBlob:b})})})}):b.audio&&b.video?b.audio.getDataURL(function(a){b.video.getDataURL(function(b){DiskStorage.Store({audioBlob:a,videoBlob:b})})}):b.audio&&b.gif?b.audio.getDataURL(function(a){b.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:a,
gifBlob:b})})}):b.video&&b.gif?b.video.getDataURL(function(a){b.gif.getDataURL(function(b){DiskStorage.Store({videoBlob:a,gifBlob:b})})}):b.audio?b.audio.getDataURL(function(a){DiskStorage.Store({audioBlob:a})}):b.video?b.video.getDataURL(function(a){DiskStorage.Store({videoBlob:a})}):b.gif&&b.gif.getDataURL(function(a){DiskStorage.Store({gifBlob:a})})};
function RecordRTCConfiguration(b,a){a.recorderType||a.type||(a.audio&&a.video?a.type="video":a.audio&&!a.video&&(a.type="audio"));a.recorderType&&!a.type&&(a.recorderType===WhammyRecorder||a.recorderType===CanvasRecorder?a.type="video":a.recorderType===GifRecorder?a.type="gif":a.recorderType===StereoAudioRecorder?a.type="audio":a.recorderType===MediaStreamRecorder&&(b.getAudioTracks().length&&b.getVideoTracks().length?a.type="video":b.getAudioTracks().length&&!b.getVideoTracks().length?a.type="audio":
!b.getAudioTracks().length&&b.getVideoTracks().length&&(a.type="audio")));"undefined"!==typeof MediaStreamRecorder&&"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(a.mimeType||(a.mimeType="video/webm"),a.type||(a.type=a.mimeType.split("/")[0]));a.type||(a.mimeType&&(a.type=a.mimeType.split("/")[0]),a.type||(a.type="audio"));return a}
function GetRecorderType(b,a){if(isChrome||isEdge||isOpera)var c=StereoAudioRecorder;"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(c=MediaStreamRecorder);"video"===a.type&&(isChrome||isOpera)&&(c=WhammyRecorder);"gif"===a.type&&(c=GifRecorder);"canvas"===a.type&&(c=CanvasRecorder);isMediaRecorderCompatible()&&c!==CanvasRecorder&&c!==GifRecorder&&"undefined"!==typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(b.getVideoTracks&&b.getVideoTracks().length||
b.getAudioTracks&&b.getAudioTracks().length)&&("audio"===a.type?"function"===typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(c=MediaStreamRecorder):"function"===typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(c=MediaStreamRecorder));a.recorderType&&(c=a.recorderType);b instanceof Array&&b.length&&(c=MultiStreamRecorder);!a.disableLogs&&c&&c.name&&console.log("Using recorderType:",c.name||c.constructor.name);return c}
function MRecordRTC(b){this.addStream=function(a){a&&(b=a)};this.mediaType={audio:!0,video:!0};this.startRecording=function(){var a=this.mediaType,c=this.mimeType||{audio:null,video:null,gif:null};"function"!==typeof a.audio&&isMediaRecorderCompatible()&&b.getAudioTracks&&!b.getAudioTracks().length&&(a.audio=!1);"function"!==typeof a.video&&isMediaRecorderCompatible()&&b.getVideoTracks&&!b.getVideoTracks().length&&(a.video=!1);"function"!==typeof a.gif&&isMediaRecorderCompatible()&&b.getVideoTracks&&
!b.getVideoTracks().length&&(a.gif=!1);if(!a.audio&&!a.video&&!a.gif)throw"MediaStream must have either audio or video tracks.";if(a.audio){var e=null;"function"===typeof a.audio&&(e=a.audio);this.audioRecorder=new RecordRTC(b,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:c.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp});a.video||this.audioRecorder.startRecording()}if(a.video){e=
null;"function"===typeof a.video&&(e=a.video);var f=b;if(isMediaRecorderCompatible()&&a.audio&&"function"===typeof a.audio){var u=b.getVideoTracks()[0];navigator.mozGetUserMedia?(f=new MediaStream,f.addTrack(u),e&&e===WhammyRecorder&&(e=MediaStreamRecorder)):f=new MediaStream([u])}this.videoRecorder=new RecordRTC(f,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:c.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp});
a.audio||this.videoRecorder.startRecording()}if(a.audio&&a.video){var p=this;isMediaRecorderCompatible()?(p.audioRecorder=null,p.videoRecorder.startRecording()):p.videoRecorder.initRecorder(function(){p.audioRecorder.initRecorder(function(){p.videoRecorder.startRecording();p.audioRecorder.startRecording()})})}a.gif&&(e=null,"function"===typeof a.gif&&(e=a.gif),this.gifRecorder=new RecordRTC(b,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,
mimeType:c.gif}),this.gifRecorder.startRecording())};this.stopRecording=function(a){a=a||function(){};this.audioRecorder&&this.audioRecorder.stopRecording(function(b){a(b,"audio")});this.videoRecorder&&this.videoRecorder.stopRecording(function(b){a(b,"video")});this.gifRecorder&&this.gifRecorder.stopRecording(function(b){a(b,"gif")})};this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording();this.videoRecorder&&this.videoRecorder.pauseRecording();this.gifRecorder&&this.gifRecorder.pauseRecording()};
this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording();this.videoRecorder&&this.videoRecorder.resumeRecording();this.gifRecorder&&this.gifRecorder.resumeRecording()};this.getBlob=function(a){var b={};this.audioRecorder&&(b.audio=this.audioRecorder.getBlob());this.videoRecorder&&(b.video=this.videoRecorder.getBlob());this.gifRecorder&&(b.gif=this.gifRecorder.getBlob());a&&a(b);return b};this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=
null);this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null);this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)};this.getDataURL=function(b){function a(b,a){if("undefined"!==typeof Worker){var c=e(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});c.onmessage=function(b){a(b.data)};c.postMessage(b)}else c=new FileReader,c.readAsDataURL(b),c.onload=function(b){a(b.target.result)}}function e(b){b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+
b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);if("undefined"!==typeof URL)var c=URL;else if("undefined"!==typeof webkitURL)c=webkitURL;else throw"Neither URL nor webkitURL detected.";c.revokeObjectURL(b);return a}this.getBlob(function(c){c.audio&&c.video?a(c.audio,function(e){a(c.video,function(a){b({audio:e,video:a})})}):c.audio?a(c.audio,function(a){b({audio:a})}):c.video&&a(c.video,function(a){b({video:a})})})};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,
video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(b){b=b||{audio:!0,video:!0,gif:!0};b.audio&&this.audioRecorder&&this.audioRecorder.save("string"===typeof b.audio?b.audio:"");b.video&&this.videoRecorder&&this.videoRecorder.save("string"===typeof b.video?b.video:"");b.gif&&this.gifRecorder&&this.gifRecorder.save("string"===typeof b.gif?b.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;
"undefined"!==typeof RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";
(function(b){if(b&&"undefined"===typeof window&&"undefined"!==typeof global){global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}};global.console||(global.console={});if("undefined"===typeof global.console.log||"undefined"===typeof global.console.error)global.console.error=global.console.log=global.console.log||function(){console.log(arguments)};"undefined"===typeof document&&(b.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var b=
{getContext:function(){return b},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return b},b.HTMLVideoElement=function(){});"undefined"===typeof location&&(b.location={protocol:"file:",href:"",hash:""});"undefined"===typeof screen&&(b.screen={width:0,height:0});"undefined"===typeof URL&&(b.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}});b.window=global}})("undefined"!==typeof global?global:null);
var requestAnimationFrame=window.requestAnimationFrame;
if("undefined"===typeof requestAnimationFrame)if("undefined"!==typeof webkitRequestAnimationFrame)requestAnimationFrame=webkitRequestAnimationFrame;else if("undefined"!==typeof mozRequestAnimationFrame)requestAnimationFrame=mozRequestAnimationFrame;else if("undefined"!==typeof msRequestAnimationFrame)requestAnimationFrame=msRequestAnimationFrame;else if("undefined"===typeof requestAnimationFrame){var lastTime=0;requestAnimationFrame=function(b,a){var c=(new Date).getTime(),e=Math.max(0,16-(c-lastTime)),
f=setTimeout(function(){b(c+e)},e);lastTime=c+e;return f}}var cancelAnimationFrame=window.cancelAnimationFrame;"undefined"===typeof cancelAnimationFrame&&("undefined"!==typeof webkitCancelAnimationFrame?cancelAnimationFrame=webkitCancelAnimationFrame:"undefined"!==typeof mozCancelAnimationFrame?cancelAnimationFrame=mozCancelAnimationFrame:"undefined"!==typeof msCancelAnimationFrame?cancelAnimationFrame=msCancelAnimationFrame:"undefined"===typeof cancelAnimationFrame&&(cancelAnimationFrame=function(b){clearTimeout(b)}));
var AudioContext=window.AudioContext;"undefined"===typeof AudioContext&&("undefined"!==typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"===typeof URL&&"undefined"!==typeof webkitURL&&(URL=webkitURL);
"undefined"!==typeof navigator&&"undefined"===typeof navigator.getUserMedia&&("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));
var isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isSafari=-1<navigator.userAgent.toLowerCase().indexOf("safari/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia||isElectron()||isSafari,MediaStream=window.MediaStream;"undefined"===typeof MediaStream&&"undefined"!==typeof webkitMediaStream&&(MediaStream=webkitMediaStream);
"undefined"!==typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks().forEach(function(a){-1!==a.kind.toString().indexOf("video")&&b.push(a)});return b},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks().forEach(function(a){-1!==a.kind.toString().indexOf("audio")&&b.push(a)});return b}),"undefined"===typeof MediaStream.prototype.stop&&(MediaStream.prototype.stop=
function(){this.getTracks().forEach(function(b){b.stop()})}));function bytesToSize(b){if(0===b)return"0 Bytes";var a=parseInt(Math.floor(Math.log(b)/Math.log(1E3)),10);return(b/Math.pow(1E3,a)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][a]}
function invokeSaveAsDialog(b,a){if(!b)throw"Blob object is required.";if(!b.type)try{b.type="video/webm"}catch(f){}var c=(b.type||"video/webm").split("/")[1];a&&-1!==a.indexOf(".")&&(c=a.split("."),a=c[0],c=c[1]);c=(a||Math.round(9999999999*Math.random())+888888888)+"."+c;if("undefined"!==typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(b,c);if("undefined"!==typeof navigator.msSaveBlob)return navigator.msSaveBlob(b,c);var e=document.createElement("a");e.href=URL.createObjectURL(b);
e.download=c;e.style="display:none;opacity:0;color:transparent;";(document.body||document.documentElement).appendChild(e);"function"===typeof e.click?e.click():(e.target="_blank",e.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})));URL.revokeObjectURL(e.href)}
function isElectron(){return"undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type||"undefined"!==typeof process&&"object"===typeof process.versions&&process.versions.electron||"object"===typeof navigator&&"string"===typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron")?!0:!1}
function setSrcObject(b,a,c){if("createObjectURL"in URL&&!c)try{a.src=URL.createObjectURL(b)}catch(e){setSrcObject(b,a,!0)}else"srcObject"in a?a.srcObject=b:"mozSrcObject"in a?a.mozSrcObject=b:alert("createObjectURL/srcObject both are not supported.")}var Storage={};"undefined"!==typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!==typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext);"undefined"!==typeof RecordRTC&&(RecordRTC.Storage=Storage);
function isMediaRecorderCompatible(){var b=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),a=!!window.chrome&&!b||isElectron();if("undefined"!==typeof window.InstallTrigger)return!0;var c=navigator.userAgent,e=""+parseFloat(navigator.appVersion);parseInt(navigator.appVersion,10);var f;if(a||b)b=c.indexOf("Chrome"),e=c.substring(b+7);-1!==(f=e.indexOf(";"))&&(e=e.substring(0,f));-1!==(f=e.indexOf(" "))&&(e=e.substring(0,f));c=parseInt(""+e,10);isNaN(c)&&(parseFloat(navigator.appVersion),c=
parseInt(navigator.appVersion,10));return 49<=c}
function MediaStreamRecorder(b,a){function c(){p.timestamps.push((new Date).getTime());if("function"===typeof a.onTimeStamp)a.onTimeStamp(p.timestamps[p.timestamps.length-1],p.timestamps)}function e(b){return g&&g.mimeType?g.mimeType:b.mimeType||"video/webm"}function f(){l=[];g=null;p.timestamps=[]}function u(){if("active"in b){if(!b.active)return!1}else if("ended"in b&&b.ended)return!1;return!0}var p=this;if("undefined"===typeof b)throw'First argument "MediaStream" is required.';if("undefined"===
typeof MediaRecorder)throw"Your browser does not supports Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";a=a||{mimeType:"video/webm"};if("audio"===a.type){if(b.getVideoTracks().length&&b.getAudioTracks().length){if(navigator.mozGetUserMedia){var x=new MediaStream;x.addTrack(b.getAudioTracks()[0])}else x=new MediaStream(b.getAudioTracks());b=x}a.mimeType&&-1!==a.mimeType.toString().toLowerCase().indexOf("audio")||(a.mimeType=isChrome?"audio/webm":"audio/ogg");
a.mimeType&&"audio/ogg"!==a.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(a.mimeType="audio/ogg")}var l=[];this.getArrayOfBlobs=function(){return l};this.record=function(){p.blob=null;p.clearRecordedData();p.timestamps=[];t=[];l=[];var f=a;a.disableLogs||console.log("Passing following config over MediaRecorder API.",f);g&&(g=null);isChrome&&!isMediaRecorderCompatible()&&(f="video/vp8");"function"===typeof MediaRecorder.isTypeSupported&&f.mimeType&&!MediaRecorder.isTypeSupported(f.mimeType)&&
(a.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",f.mimeType),f.mimeType="audio"===a.type?"audio/webm":"video/webm");try{g=new MediaRecorder(b,f),a.mimeType=f.mimeType}catch(r){g=new MediaRecorder(b)}f.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in g&&!1===g.canRecordMimeType(f.mimeType)&&(a.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",f.mimeType));g.ignoreMutedMedia=!0===a.ignoreMutedMedia;g.ondataavailable=function(b){b.data&&
t.push("ondataavailable: "+bytesToSize(b.data.size));"number"===typeof a.timeSlice?b.data&&b.data.size&&100<b.data.size&&(l.push(b.data),c(),"function"===typeof a.ondataavailable&&(b=a.getNativeBlob?b.data:new Blob([b.data],{type:e(f)}),a.ondataavailable(b))):!b.data||!b.data.size||100>b.data.size||p.blob?p.recordingCallback&&(p.recordingCallback(new Blob([],{type:e(f)})),p.recordingCallback=null):(p.blob=a.getNativeBlob?b.data:new Blob([b.data],{type:e(f)}),p.recordingCallback&&(p.recordingCallback(p.blob),
p.recordingCallback=null))};g.onstart=function(){t.push("started")};g.onpause=function(){t.push("paused")};g.onresume=function(){t.push("resumed")};g.onstop=function(){t.push("stopped")};g.onerror=function(b){t.push("error: "+b);a.disableLogs||(-1!==b.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",b):-1!==b.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",
f.mimeType,") is not supported.",b):-1!==b.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",b):"OutOfMemory"===b.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"IllegalStreamModification"===b.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",
b):"OtherRecordingError"===b.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"GenericError"===b.name?console.error("The UA cannot provide the codec or recording option that has been requested.",b):console.error("MediaRecorder Error",b));!p.manuallyStopped&&g&&"inactive"===g.state?(delete a.timeslice,g.start(6E5)):setTimeout(void 0,1E3);"inactive"!==g.state&&"stopped"!==g.state&&
g.stop()};"number"===typeof a.timeSlice?(c(),g.start(a.timeSlice)):g.start(36E5);a.initCallback&&a.initCallback()};this.timestamps=[];this.stop=function(b){p.manuallyStopped=!0;g&&(this.recordingCallback=b||function(){},"recording"===g.state&&g.stop(),"number"===typeof a.timeSlice&&setTimeout(function(){p.blob=new Blob(l,{type:e(a)});p.recordingCallback(p.blob)},100))};this.pause=function(){g&&"recording"===g.state&&g.pause()};this.resume=function(){g&&"paused"===g.state&&g.resume()};this.clearRecordedData=
function(){g&&"recording"===g.state&&p.stop(f);f()};var g;this.getInternalRecorder=function(){return g};this.blob=null;this.getState=function(){return g?g.state||"inactive":"inactive"};var t=[];this.getAllStates=function(){return t};"undefined"===typeof a.checkForInactiveTracks&&(a.checkForInactiveTracks=!1);p=this;(function r(){g&&!1!==a.checkForInactiveTracks&&(!1===u()?(a.disableLogs||console.log("MediaStream seems stopped."),p.stop()):setTimeout(r,1E3))})();this.name="MediaStreamRecorder";this.toString=
function(){return this.name}}"undefined"!==typeof RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder);
function StereoAudioRecorder(b,a){function c(){if(!1===a.checkForInactiveTracks)return!0;if("active"in b){if(!b.active)return!1}else if("ended"in b&&b.ended)return!1;return!0}function e(b,a){function c(b,a){function k(b,k,a){k=Math.round(k/a*b.length);a=[];var d=Number((b.length-1)/(k-1));a[0]=b[0];for(var c=1;c<k-1;c++){var h=c*d,e=Number(Math.floor(h)).toFixed(),I=Number(Math.ceil(h)).toFixed(),R=b[e];a[c]=R+(b[I]-R)*(h-e)}a[k-1]=b[b.length-1];return a}function c(b,k){for(var a=new Float64Array(k),
d=0,c=b.length,h=0;h<c;h++){var e=b[h];a.set(e,d);d+=e.length}return a}function h(b,k){for(var a=b.length+k.length,d=new Float64Array(a),c=0,h=0;h<a;)d[h++]=b[c],d[h++]=k[c],c++;return d}function e(b,k,a){for(var d=a.length,c=0;c<d;c++)b.setUint8(k+c,a.charCodeAt(c))}var f=b.numberOfAudioChannels,w=b.leftBuffers.slice(0),g=b.rightBuffers.slice(0),v=b.sampleRate,n=b.internalInterleavedLength,y=b.desiredSampRate;2===f&&(w=c(w,n),g=c(g,n),y&&(w=k(w,y,v),g=k(g,y,v)));1===f&&(w=c(w,n),y&&(w=k(w,y,v)));
y&&(v=y);var G;2===f&&(G=h(w,g));1===f&&(G=w);w=G.length;g=new ArrayBuffer(44+2*w);n=new DataView(g);e(n,0,"RIFF");n.setUint32(4,44+2*w,!0);e(n,8,"WAVE");e(n,12,"fmt ");n.setUint32(16,16,!0);n.setUint16(20,1,!0);n.setUint16(22,f,!0);n.setUint32(24,v,!0);n.setUint32(28,2*v,!0);n.setUint16(32,2*f,!0);n.setUint16(34,16,!0);e(n,36,"data");n.setUint32(40,2*w,!0);f=44;for(v=0;v<w;v++)n.setInt16(f,32767*G[v],!0),f+=2;if(a)return a({buffer:g,view:n});postMessage({buffer:g,view:n})}if(isEdge||isOpera||isSafari||
b.noWorker)c(b,function(b){a(b.buffer,b.view)});else{var e=f(c);e.onmessage=function(b){a(b.data.buffer,b.data.view);URL.revokeObjectURL(e.workerURL)};e.postMessage(b)}}function f(b){b=URL.createObjectURL(new Blob([b.toString(),";this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);a.workerURL=b;return a}function u(){g=[];t=[];r=0;H=m=q=!1;A=null;l.leftchannel=g;l.rightchannel=t;l.numberOfAudioChannels=v;l.desiredSampRate=B;l.sampleRate=F;l.recordingLength=
r;z=[];C=[];J=0}function p(){E&&(E.onaudioprocess=null,E.disconnect(),E=null);n&&(n.disconnect(),n=null);u()}function x(){m&&"function"===typeof a.ondataavailable&&"undefined"!==typeof a.timeSlice&&(z.length?(e({desiredSampRate:B,sampleRate:F,numberOfAudioChannels:v,internalInterleavedLength:J,leftBuffers:z,rightBuffers:1===v?[]:C},function(b,c){var e=new Blob([c],{type:"audio/wav"});a.ondataavailable(e);setTimeout(x,a.timeSlice)}),z=[],C=[],J=0):setTimeout(x,a.timeSlice))}if(!b.getAudioTracks().length)throw"Your stream has no audio tracks.";
a=a||{};var l=this,g=[],t=[],m=!1,r=0,v=2,B=a.desiredSampRate;!0===a.leftChannel&&(v=1);1===a.numberOfAudioChannels&&(v=1);if(!v||1>v)v=2;a.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: ",v);"undefined"===typeof a.checkForInactiveTracks&&(a.checkForInactiveTracks=!0);this.record=function(){if(!1===c())throw"Please make sure MediaStream is active.";u();q=H=!1;m=!0;"undefined"!==typeof a.timeSlice&&x()};this.stop=function(b){b=b||function(){};m=!1;e({desiredSampRate:B,
sampleRate:F,numberOfAudioChannels:v,internalInterleavedLength:r,leftBuffers:g,rightBuffers:1===v?[]:t},function(a,c){l.blob=new Blob([c],{type:"audio/wav"});l.buffer=new ArrayBuffer(c.buffer.byteLength);l.view=c;l.sampleRate=B||F;l.bufferSize=y;l.length=r;q=!1;b&&b(l.blob)})};Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext);var A=Storage.AudioContextConstructor,n=A.createMediaStreamSource(b),w=[0,256,512,1024,2048,4096,8192,16384],y="undefined"===typeof a.bufferSize?
4096:a.bufferSize;-1===w.indexOf(y)&&(a.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(w,null,"\t")));if(A.createJavaScriptNode)var E=A.createJavaScriptNode(y,v,v);else if(A.createScriptProcessor)E=A.createScriptProcessor(y,v,v);else throw"WebAudio API has no support on this browser.";n.connect(E);a.bufferSize||(y=E.bufferSize);var F="undefined"!==typeof a.sampleRate?a.sampleRate:A.sampleRate||44100;if(22050>F||96E3<F)a.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.");
a.disableLogs||(console.log("sample-rate",F),console.log("buffer-size",y),a.desiredSampRate&&console.log("Desired sample-rate",a.desiredSampRate));var H=!1;this.pause=function(){H=!0};this.resume=function(){if(!1===c())throw"Please make sure MediaStream is active.";m?H=!1:(a.disableLogs||console.log("Seems recording has been restarted."),this.record())};this.clearRecordedData=function(){a.checkForInactiveTracks=!1;m&&this.stop(p);p()};this.name="StereoAudioRecorder";this.toString=function(){return this.name};
var q=!1;E.onaudioprocess=function(b){if(!H)if(!1===c()&&(a.disableLogs||console.log("MediaStream seems stopped."),E.disconnect(),m=!1),m){if(!q){q=!0;if(a.onAudioProcessStarted)a.onAudioProcessStarted();a.initCallback&&a.initCallback()}var e=b.inputBuffer.getChannelData(0);e=new Float32Array(e);g.push(e);if(2===v){b=b.inputBuffer.getChannelData(1);var w=new Float32Array(b);t.push(w)}r+=y;l.recordingLength=r;"undefined"!==typeof a.timeSlice&&(J+=y,z.push(e),2===v&&C.push(w))}else n&&(n.disconnect(),
n=null)};E.connect(A.destination);this.leftchannel=g;this.rightchannel=t;this.numberOfAudioChannels=v;this.desiredSampRate=B;this.sampleRate=F;l.recordingLength=r;var z=[],C=[],J=0}"undefined"!==typeof RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder);
function CanvasRecorder(b,a){function c(){B.frames=[];r=m=!1}function e(){var a=document.createElement("canvas"),c=a.getContext("2d");a.width=b.width;a.height=b.height;c.drawImage(b,0,0);return a}function f(){if(r)return v=(new Date).getTime(),setTimeout(f,500);if("canvas"===b.nodeName.toLowerCase()){var c=(new Date).getTime()-v;v=(new Date).getTime();B.frames.push({image:e(),duration:c});m&&setTimeout(f,a.frameInterval)}else html2canvas(b,{grabMouse:"undefined"===typeof a.showMousePointer||a.showMousePointer,
onrendered:function(b){var c=(new Date).getTime()-v;if(!c)return setTimeout(f,a.frameInterval);v=(new Date).getTime();B.frames.push({image:b.toDataURL("image/webp",1),duration:c});m&&setTimeout(f,a.frameInterval)}})}if("undefined"===typeof html2canvas)throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";a=a||{};a.frameInterval||(a.frameInterval=10);var u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(b){b in document.createElement("canvas")&&(u=!0)});
var p=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,x=50,l=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);p&&l&&l[2]&&(x=parseInt(l[2],10));p&&52>x&&(u=!1);var g;if(u)if(a.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),b instanceof HTMLCanvasElement)var t=b;else if(b instanceof CanvasRenderingContext2D)t=b.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&
(a.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var m;this.record=function(){m=!0;if(u&&!a.useWhammyRecorder){var b;"captureStream"in t?b=t.captureStream(25):"mozCaptureStream"in t?b=t.mozCaptureStream(25):"webkitCaptureStream"in t&&(b=t.webkitCaptureStream(25));try{var c=new MediaStream;c.addTrack(b.getVideoTracks()[0]);b=c}catch(w){}if(!b)throw"captureStream API are NOT available.";g=new MediaStreamRecorder(b,{mimeType:"video/webm"});g.record()}else B.frames=[],v=
(new Date).getTime(),f();a.initCallback&&a.initCallback()};this.getWebPImages=function(c){if("canvas"===b.nodeName.toLowerCase()){var e=B.frames.length;B.frames.forEach(function(b,c){var w=e-c;a.disableLogs||console.log(w+"/"+e+" frames remaining");if(a.onEncodingCallback)a.onEncodingCallback(w,e);w=b.image.toDataURL("image/webp",1);B.frames[c].image=w});a.disableLogs||console.log("Generating WebM")}c()};this.stop=function(b){m=!1;var c=this;u&&g?g.stop(b):this.getWebPImages(function(){B.compile(function(e){a.disableLogs||
console.log("Recording finished!");c.blob=e;c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"}));b&&b(c.blob);B.frames=[]})})};var r=!1;this.pause=function(){r=!0;g instanceof MediaStreamRecorder&&g.pause()};this.resume=function(){r=!1;g instanceof MediaStreamRecorder?g.resume():m||this.record()};this.clearRecordedData=function(){m&&this.stop(c);c()};this.name="CanvasRecorder";this.toString=function(){return this.name};var v=(new Date).getTime(),B=new Whammy.Video(100)}
"undefined"!==typeof RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder);
function WhammyRecorder(b,a){function c(b){b="undefined"!==typeof b?b:10;var a=(new Date).getTime()-m;if(!a)return setTimeout(c,b,b);if(x)return m=(new Date).getTime(),setTimeout(c,100);m=(new Date).getTime();t.paused&&t.play();g.drawImage(t,0,0,l.width,l.height);r.frames.push({duration:a,image:l.toDataURL("image/webp")});p||setTimeout(c,b,b)}function e(b){var a=-1,c=b.length;(function w(){a++;a===c?b.callback():setTimeout(function(){b.functionToLoop(w,a)},1)})()}function f(b,a,c,f,w){var g=document.createElement("canvas");
g.width=l.width;g.height=l.height;var n=g.getContext("2d"),v=[],p=-1===a,q=a&&0<a&&a<=b.length?a:b.length,z=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),u=c&&0<=c&&1>=c?c:0,B=f&&0<=f&&1>=f?f:0,G=!1;e({length:q,functionToLoop:function(a,c){var e,k,h,d=function(){!G&&h-e<=h*B||(p&&(G=!0),v.push(b[c]));a()};if(G)d();else{var I=new Image;I.onload=function(){n.drawImage(I,0,0,l.width,l.height);var b=n.getImageData(0,0,l.width,l.height);e=0;k=b.data.length;h=b.data.length/4;for(var a=0;a<
k;a+=4)Math.sqrt(Math.pow(b.data[a]-0,2)+Math.pow(b.data[a+1]-0,2)+Math.pow(b.data[a+2]-0,2))<=z*u&&e++;d()};I.src=b[c].image}},callback:function(){v=v.concat(b.slice(q));0>=v.length&&v.push(b[b.length-1]);w(v)}})}function u(){r.frames=[];p=!0;x=!1}a=a||{};a.frameInterval||(a.frameInterval=10);a.disableLogs||console.log("Using frames-interval:",a.frameInterval);this.record=function(){a.width||(a.width=320);a.height||(a.height=240);a.video||(a.video={width:a.width,height:a.height});a.canvas||(a.canvas=
{width:a.width,height:a.height});l.width=a.canvas.width||320;l.height=a.canvas.height||240;g=l.getContext("2d");a.video&&a.video instanceof HTMLVideoElement?(t=a.video.cloneNode(),a.initCallback&&a.initCallback()):(t=document.createElement("video"),setSrcObject(b,t),t.onloadedmetadata=function(){a.initCallback&&a.initCallback()},t.width=a.video.width,t.height=a.video.height);t.muted=!0;t.play();m=(new Date).getTime();r=new Whammy.Video;a.disableLogs||(console.log("canvas resolutions",l.width,"*",
l.height),console.log("video width/height",t.width||l.width,"*",t.height||l.height));c(a.frameInterval)};var p=!1;this.stop=function(b){b=b||function(){};p=!0;var c=this;setTimeout(function(){f(r.frames,-1,null,null,function(e){r.frames=e;a.advertisement&&a.advertisement.length&&(r.frames=a.advertisement.concat(r.frames));r.compile(function(a){c.blob=a;c.blob.forEach&&(c.blob=new Blob([],{type:"video/webm"}));b&&b(c.blob)})})},10)};var x=!1;this.pause=function(){x=!0};this.resume=function(){x=!1;
p&&this.record()};this.clearRecordedData=function(){p||this.stop(u);u()};this.name="WhammyRecorder";this.toString=function(){return this.name};var l=document.createElement("canvas"),g=l.getContext("2d"),t,m,r}"undefined"!==typeof RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);
var Whammy=function(){function b(b){this.frames=[];this.duration=b||1;this.quality=.8}function a(b){b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"}));var a=new Worker(b);URL.revokeObjectURL(b);return a}function c(b){function a(b,a,c){return[{data:b,id:231}].concat(c.map(function(b){var c=g({discardable:0,frame:b.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(a)});a+=b.duration;return{data:c,
id:163}}))}function c(b){for(var a=[];0<b;)a.push(b&255),b>>=8;return new Uint8Array(a.reverse())}function e(b){return new Uint8Array(b.split("").map(function(b){return b.charCodeAt(0)}))}function x(b){var a=[];b=(b.length%8?Array(9-b.length%8).join("0"):"")+b;for(var c=0;c<b.length;c+=8)a.push(parseInt(b.substr(c,8),2));return new Uint8Array(a)}function l(b){for(var a=[],g=0;g<b.length;g++){var f=b[g].data;"object"===typeof f&&(f=l(f));"number"===typeof f&&(f=x(f.toString(2)));"string"===typeof f&&
(f=e(f));var w=f.size||f.byteLength||f.length,y=Math.ceil(Math.ceil(Math.log(w)/Math.log(2))/8);w=w.toString(2);w=Array(7*y+8-w.length).join("0")+w;y=Array(y).join("0")+"1"+w;a.push(c(b[g].id));a.push(x(y));a.push(f)}return new Blob(a,{type:"video/webm"})}function g(b){var a=0;b.keyframe&&(a|=128);b.invisible&&(a|=8);b.lacing&&(a|=b.lacing<<1);b.discardable&&(a|=1);if(127<b.trackNum)throw"TrackNumber > 127 not supported";return[b.trackNum|128,b.timecode>>8,b.timecode&255,a].map(function(b){return String.fromCharCode(b)}).join("")+
b.frame}function t(b,a){return parseInt(b.substr(a+4,4).split("").map(function(b){b=b.charCodeAt(0).toString(2);return Array(8-b.length+1).join("0")+b}).join(""),2)}function m(b){for(var a=0,c={};a<b.length;){var e=b.substr(a,4),f=t(b,a),g=b.substr(a+4+4,f);a+=8+f;c[e]=c[e]||[];"RIFF"===e||"LIST"===e?c[e].push(m(g)):c[e].push(g)}return c}function r(b){return[].slice.call(new Uint8Array((new Float64Array([b])).buffer),0).map(function(b){return String.fromCharCode(b)}).reverse().join("")}b=new function(b){if(b[0]){for(var c=
b[0].width,e=b[0].height,f=b[0].duration,g=1;g<b.length;g++)f+=b[g].duration;c={duration:f,width:c,height:e}}else postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."}),c=void 0;if(!c)return[];c=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},
{data:r(c.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:c.width,id:176},{data:c.height,id:186}]}]}]}]}];for(f=e=0;e<b.length;){var y=[];g=0;do y.push(b[e]),g+=b[e].duration,e++;while(e<b.length&&3E4>g);y={id:524531317,data:a(f,0,y)};c[1].data.push(y);f+=g}return l(c)}(b.map(function(b){for(var a=m(atob(b.image.slice(23))),c=a.RIFF[0].WEBP[0],
e=c.indexOf("\u009d\u0001*"),f=0,g=[];4>f;f++)g[f]=c.charCodeAt(e+3+f);f=g[1]<<8|g[0];e=f&16383;f=g[3]<<8|g[2];a={width:e,height:f&16383,data:c,riff:a};a.duration=b.duration;return a}));postMessage(b)}b.prototype.add=function(b,a){"canvas"in b&&(b=b.canvas);"toDataURL"in b&&(b=b.toDataURL("image/webp",this.quality));if(!/^data:image\/webp;base64,/ig.test(b))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:b,duration:a||this.duration})};
b.prototype.compile=function(b){var e=a(c);e.onmessage=function(a){a.data.error?console.error(a.data.error):b(a.data)};e.postMessage(this.frames)};return{Video:b}}();"undefined"!==typeof RecordRTC&&(RecordRTC.Whammy=Whammy);
var DiskStorage={init:function(){function b(){function b(b){c.objectStore(a.dataStoreName).get(b).onsuccess=function(c){a.callback&&a.callback(c.target.result,b)}}var c=e.transaction([a.dataStoreName],"readwrite");a.videoBlob&&c.objectStore(a.dataStoreName).put(a.videoBlob,"videoBlob");a.gifBlob&&c.objectStore(a.dataStoreName).put(a.gifBlob,"gifBlob");a.audioBlob&&c.objectStore(a.dataStoreName).put(a.audioBlob,"audioBlob");b("audioBlob");b("videoBlob");b("gifBlob")}var a=this;if("undefined"===typeof indexedDB||
"undefined"===typeof indexedDB.open)console.error("IndexedDB API are not available in this browser.");else{var c=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),e,f=indexedDB.open(c,1);f.onerror=a.onError;f.onsuccess=function(){e=f.result;e.onerror=a.onError;e.setVersion?1!==e.version?e.setVersion(1).onsuccess=function(){e.createObjectStore(a.dataStoreName);b()}:b():b()};f.onupgradeneeded=function(b){b.target.result.createObjectStore(a.dataStoreName)}}},Fetch:function(b){this.callback=
b;this.init();return this},Store:function(b){this.audioBlob=b.audioBlob;this.videoBlob=b.videoBlob;this.gifBlob=b.gifBlob;this.init();return this},onError:function(b){console.error(JSON.stringify(b,null,"\t"))},dataStoreName:"recordRTC",dbName:null};"undefined"!==typeof RecordRTC&&(RecordRTC.DiskStorage=DiskStorage);
function GifRecorder(b,a){if("undefined"===typeof GIFEncoder){var c=document.createElement("script");c.src="https://cdn.webrtc-experiment.com/gif-recorder.js";(document.body||document.documentElement).appendChild(c)}a=a||{};var e=b instanceof CanvasRenderingContext2D||b instanceof HTMLCanvasElement;this.record=function(){function b(c){if(!0!==r.clearedRecordedData){if(f)return setTimeout(function(){b(c)},100);g=requestAnimationFrame(b);if(!(90>c-t)){!e&&l.paused&&l.play();e||p.drawImage(l,0,0,u.width,
u.height);if(a.onGifPreview)a.onGifPreview(u.toDataURL("image/png"));m.addFrame(p);t=c}}}if("undefined"===typeof GIFEncoder)setTimeout(r.record,1E3);else if(x){e||(a.width||(a.width=l.offsetWidth||320),a.height||(a.height=l.offsetHeight||240),a.video||(a.video={width:a.width,height:a.height}),a.canvas||(a.canvas={width:a.width,height:a.height}),u.width=a.canvas.width||320,u.height=a.canvas.height||240,l.width=a.video.width||320,l.height=a.video.height||240);m=new GIFEncoder;m.setRepeat(0);m.setDelay(a.frameRate||
200);m.setQuality(a.quality||10);m.start();if("function"===typeof a.onGifRecordingStarted)a.onGifRecordingStarted();Date.now();g=requestAnimationFrame(b);a.initCallback&&a.initCallback()}else setTimeout(r.record,1E3)};this.stop=function(b){b=b||function(){};g&&cancelAnimationFrame(g);Date.now();this.blob=new Blob([new Uint8Array(m.stream().bin)],{type:"image/gif"});b(this.blob);m.stream().bin=[]};var f=!1;this.pause=function(){f=!0};this.resume=function(){f=!1};this.clearRecordedData=function(){r.clearedRecordedData=
!0;m&&(m.stream().bin=[])};this.name="GifRecorder";this.toString=function(){return this.name};var u=document.createElement("canvas"),p=u.getContext("2d");e&&(b instanceof CanvasRenderingContext2D?(p=b,u=p.canvas):b instanceof HTMLCanvasElement&&(p=b.getContext("2d"),u=b));var x=!0;if(!e){var l=document.createElement("video");l.muted=!0;l.autoplay=!0;x=!1;l.onloadedmetadata=function(){x=!0};setSrcObject(b,l);l.play()}var g=null,t,m,r=this}"undefined"!==typeof RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);
function MultiStreamsMixer(b){function a(b,c,e){if("createObjectURL"in B&&!e)try{c.src=B.createObjectURL(b)}catch(F){a(b,c,!0)}else"srcObject"in c?c.srcObject=b:"mozSrcObject"in c?c.mozSrcObject=b:alert("createObjectURL/srcObject both are not supported.")}function c(){if(!g){var b=l.length,a=!1,f=[];l.forEach(function(b){b.stream||(b.stream={});b.stream.fullcanvas?a=b:f.push(b)});if(a)t.width=a.stream.width,t.height=a.stream.height;else if(f.length){t.width=1<b?2*f[0].width:f[0].width;var p=1;if(3===
b||4===b)p=2;if(5===b||6===b)p=3;if(7===b||8===b)p=4;if(9===b||10===b)p=5;t.height=f[0].height*p}else t.width=r.width||360,t.height=r.height||240;a&&a instanceof HTMLVideoElement&&e(a);f.forEach(function(b,a){e(b,a)});setTimeout(c,r.frameInterval)}}function e(b,a){if(!g){var c=0,e=0,f=b.width,q=b.height;1===a&&(c=b.width);2===a&&(e=b.height);3===a&&(c=b.width,e=b.height);4===a&&(e=2*b.height);5===a&&(c=b.width,e=2*b.height);6===a&&(e=3*b.height);7===a&&(c=b.width,e=3*b.height);"undefined"!==typeof b.stream.left&&
(c=b.stream.left);"undefined"!==typeof b.stream.top&&(e=b.stream.top);"undefined"!==typeof b.stream.width&&(f=b.stream.width);"undefined"!==typeof b.stream.height&&(q=b.stream.height);m.drawImage(b,c,e,f,q);if("function"===typeof b.stream.onRender)b.stream.onRender(m,c,e,f,q,a)}}function f(){x();var b;"captureStream"in t?b=t.captureStream():"mozCaptureStream"in t?b=t.mozCaptureStream():r.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");
var a=new A;b.getVideoTracks().forEach(function(b){a.addTrack(b)});return t.stream=a}function u(){n.AudioContextConstructor||(n.AudioContextConstructor=new n.AudioContext);r.audioContext=n.AudioContextConstructor;r.audioSources=[];!0===r.useGainNode&&(r.gainNode=r.audioContext.createGain(),r.gainNode.connect(r.audioContext.destination),r.gainNode.gain.value=0);var a=0;b.forEach(function(b){b.getAudioTracks().length&&(a++,b=r.audioContext.createMediaStreamSource(b),!0===r.useGainNode&&b.connect(r.gainNode),
r.audioSources.push(b))});if(a)return r.audioDestination=r.audioContext.createMediaStreamDestination(),r.audioSources.forEach(function(b){b.connect(r.audioDestination)}),r.audioDestination.stream}function p(b){var c=document.createElement("video");a(b,c);c.muted=!0;c.volume=0;c.width=b.width||r.width||360;c.height=b.height||r.height||240;c.play();return c}function x(a){l=[];a=a||b;a.forEach(function(b){if(b.getVideoTracks().length){var a=p(b);a.stream=b;l.push(a)}})}var l=[],g=!1,t=document.createElement("canvas"),
m=t.getContext("2d");t.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000; margin-top:-1000000000;margin-left:-1000000000;";(document.body||document.documentElement).appendChild(t);this.disableLogs=!1;this.frameInterval=10;this.width=360;this.height=240;this.useGainNode=!0;var r=this,v=window.AudioContext;"undefined"===typeof v&&("undefined"!==typeof webkitAudioContext&&(v=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(v=mozAudioContext));var B=window.URL;"undefined"===
typeof B&&"undefined"!==typeof webkitURL&&(B=webkitURL);"undefined"!==typeof navigator&&"undefined"===typeof navigator.getUserMedia&&("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var A=window.MediaStream;"undefined"===typeof A&&"undefined"!==typeof webkitMediaStream&&(A=webkitMediaStream);"undefined"!==typeof A&&("getVideoTracks"in A.prototype||
(A.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks.forEach(function(a){-1!==a.kind.toString().indexOf("video")&&b.push(a)});return b},A.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var b=[];this.getTracks.forEach(function(a){-1!==a.kind.toString().indexOf("audio")&&b.push(a)});return b}),"undefined"===typeof A.prototype.stop&&(A.prototype.stop=function(){this.getTracks().forEach(function(b){b.stop()})}));var n={};"undefined"!==typeof v?n.AudioContext=
v:"undefined"!==typeof webkitAudioContext&&(n.AudioContext=webkitAudioContext);this.startDrawingFrames=function(){c()};this.appendStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]);b.concat(a);a.forEach(function(b){if(b.getVideoTracks().length){var a=p(b);a.stream=b;l.push(a)}b.getAudioTracks().length&&r.audioContext&&(b=r.audioContext.createMediaStreamSource(b),b.connect(r.audioDestination),r.audioSources.push(b))})};this.releaseStreams=function(){l=[];g=!0;
r.gainNode&&(r.gainNode.disconnect(),r.gainNode=null);r.audioSources.length&&(r.audioSources.forEach(function(b){b.disconnect()}),r.audioSources=[]);r.audioDestination&&(r.audioDestination.disconnect(),r.audioDestination=null);r.audioContext=null;m.clearRect(0,0,t.width,t.height);t.stream&&(t.stream.stop(),t.stream=null)};this.resetVideoStreams=function(b){!b||b instanceof Array||(b=[b]);x(b)};this.name="MultiStreamsMixer";this.toString=function(){return this.name};this.getMixedStream=function(){g=
!1;var a=f(),c=u();c&&c.getAudioTracks().forEach(function(b){a.addTrack(b)});b.forEach(function(b){});return a}}
function MultiStreamRecorder(b,a){function c(){var a=[];b.forEach(function(b){b.getVideoTracks().forEach(function(b){a.push(b)})});return a}b=b||[];var e=this,f,u;a=a||{mimeType:"video/webm",video:{width:360,height:240}};a.frameInterval||(a.frameInterval=10);a.video||(a.video={});a.video.width||(a.video.width=360);a.video.height||(a.video.height=240);this.record=function(){f=new MultiStreamsMixer(b);c().length&&(f.frameInterval=a.frameInterval||10,f.width=a.video.width||360,f.height=a.video.height||
240,f.startDrawingFrames());a.previewStream&&"function"===typeof a.previewStream&&a.previewStream(f.getMixedStream());u=new MediaStreamRecorder(f.getMixedStream(),a);u.record()};this.stop=function(b){u&&u.stop(function(a){e.blob=a;b(a);e.clearRecordedData()})};this.pause=function(){u&&u.pause()};this.resume=function(){u&&u.resume()};this.clearRecordedData=function(){u&&(u.clearRecordedData(),u=null);f&&(f.releaseStreams(),f=null)};this.addStreams=function(a){if(!a)throw"First parameter is required.";
a instanceof Array||(a=[a]);b.concat(a);u&&f&&f.appendStreams(a)};this.resetVideoStreams=function(b){f&&(!b||b instanceof Array||(b=[b]),f.resetVideoStreams(b))};this.name="MultiStreamRecorder";this.toString=function(){return this.name}}"undefined"!==typeof RecordRTC&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder);
function RecordRTCPromisesHandler(b,a){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if("undefined"===typeof b)throw'First argument "MediaStream" is required.';var c=this;c.recordRTC=new RecordRTC(b,a);this.startRecording=function(){return new Promise(function(b,a){try{c.recordRTC.startRecording(),b()}catch(u){a(u)}})};this.stopRecording=function(){return new Promise(function(b,a){try{c.recordRTC.stopRecording(function(a){c.blob=c.recordRTC.getBlob();b(a)})}catch(u){a(u)}})};this.getDataURL=
function(b){return new Promise(function(b,a){try{c.recordRTC.getDataURL(function(a){b(a)})}catch(p){a(p)}})};this.getBlob=function(){return c.recordRTC.getBlob()};this.blob=null}"undefined"!==typeof RecordRTC&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler);(function(b){function a(b){for(var a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),k=[],c=0;c<b;c++){var e=(Math.random()*(a.length-1)).toFixed(0);k[c]=a[e]}return k.join("")}function c(b){b+="=";for(var a=decodeURIComponent(document.cookie).split(";"),k=0;k<a.length;k++){for(var c=a[k];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(b))return c.substring(b.length,c.length)}return""}function e(b,a,d){var k=new Date;k.setTime(k.getTime()+864E5*d);d="expires="+k.toUTCString();
document.cookie=b+"="+a+";"+d+";path=/"}function f(){return Math.ceil(1E9*Math.random())}function u(a){var k=f();k={uVersion:b.CS.protoVersion,stIsAppInFocusReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:k}}};k.stIsAppInFocusReq.eStatus=a?b.CS.proto_isFocusStatus.values.E_IN_FOCUS:b.CS.proto_isFocusStatus.values.E_OUT_FOCUS;try{n(b.CS,!1,b.CS.proto_msgType.values.E_IS_APP_ON_FOCUS_RQT,k)}catch(d){}}var p,x={socket:0,rest:1},l={initiated:0,connected:1,ready:2,error:3,closed:4},
g=0,t=new ArrayBuffer(0),m=0,r=0,v=0,B=function(a,c,d){var k="";switch(c){case a.proto_msgType.values.E_SIGNUP_RSP:if(b.CS.transactionRespCB[d.stSignUpRes.ullTransId])b.CS.transactionRespCB[d.stSignUpRes.ullTransId](a.imlrespcode[d.stSignUpRes.ret].code,a.imlrespcode[d.stSignUpRes.ret].phrase);break;case a.proto_msgType.values.E_ACTIVATE_RSP:if(b.CS.transactionRespCB[d.stActivateRes.ullTransId])b.CS.transactionRespCB[d.stActivateRes.ullTransId](a.imlrespcode[d.stActivateRes.ret].code,a.imlrespcode[d.stActivateRes.ret].phrase);
break;case a.proto_msgType.values.E_LOGIN_RSP:if(b.CS.transactionRespCB[d.stLoginRes.ullTransId])b.CS.transactionRespCB[d.stLoginRes.ullTransId](a.imlrespcode[d.stLoginRes.ret].code,a.imlrespcode[d.stLoginRes.ret].phrase);d.stLoginRes.ret&&(a.loggedin=!0);b.CS.s3Bin=d.stLoginRes.sBucketName;b.CS.timeOffset=d.stLoginRes.uServerTime-(new Date).getTime();break;case a.proto_msgType.values.E_GET_CONTACTS_RSP:if(b.CS.transactionRespCB[d.stGetContactsRes.ullTransId])b.CS.transactionRespCB[d.stGetContactsRes.ullTransId](a.imlrespcode[d.stGetContactsRes.ret].code,
{contacts:d.stGetContactsRes.sPhoneNums,types:d.stGetContactsRes.stContactTypes});break;case a.proto_msgType.values.E_IS_APP_CONTACT_RSP:c=[];k=d.stIsAppContactRes.sPhoneNums;for(var e=d.stIsAppContactRes.stProfile,h=0;h<k.length;h++)c[h]={mobileNumber:k[h],name:e[h].sUserName,presenceMessage:e[h].sPresenceStatusMsg,profilePicId:e[h].sProfilePicId};if(b.CS.transactionRespCB[d.stIsAppContactRes.ullTransId])b.CS.transactionRespCB[d.stIsAppContactRes.ullTransId](a.imlrespcode[d.stIsAppContactRes.ret].code,
c);break;case a.proto_msgType.values.E_USER_JOINED_RQT:if(b.CS.transactionRespCB[d.stUserJoinedReq.ullTransId])b.CS.transactionRespCB[d.stUserJoinedReq.ullTransId](a.contactsStatus[c].status,{mobileNumber:d.stUserJoinedReq.sJoinedUserMobNu});break;case a.proto_msgType.values.E_ADD_NUM_RSP:if(b.CS.transactionRespCB[d.stAddNumRes.ullTransId])b.CS.transactionRespCB[d.stAddNumRes.ullTransId](a.imlrespcode[d.stAddNumRes.ret].code,a.imlrespcode[d.stAddNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP:break;
case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT:a.call.callObj[d.stDirectAudioVideoCall180RingingReq.sCallId].state=a.call.RINGING_RECEIVED;h={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingRes:{ullTransId:d.stDirectAudioVideoCall180RingingReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:d.stDirectAudioVideoCall180RingingReq.sCallId,retCodes:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RSP,h);if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,
{callId:d.stDirectAudioVideoCall180RingingReq.sCallId});break;case a.proto_msgType.values.E_GET_PRESENCE_RSP:c=[];for(h in d.stGetPresRes.stPresence)k={mobileNumber:d.stGetPresRes.stPresence[h].sPhoneNum,isOnline:!0,lastLoginTime:d.stGetPresRes.stPresence[h].sTime,statusMessage:d.stGetPresRes.stPresence[h].sPresenceStatusMsg},"OFFLINE"==d.stGetPresRes.stPresence[h].sStatus&&(k.isOnline=!1),c.push(k);if(b.CS.transactionRespCB[d.stGetPresRes.ullTransId])b.CS.transactionRespCB[d.stGetPresRes.ullTransId](a.imlrespcode[d.stGetPresRes.ret].code,
c);break;case a.proto_msgType.values.E_SET_PROFILE_RSP:if(b.CS.transactionRespCB[d.stSetProfileRes.ullTransId])b.CS.transactionRespCB[d.stSetProfileRes.ullTransId](a.imlrespcode[d.stSetProfileRes.ret].code,a.imlrespcode[d.stSetProfileRes.ret].phrase);break;case a.proto_msgType.values.E_GET_PROFILE_RSP:if(b.CS.transactionRespCB[d.stGetProfileRes.ullTransId])b.CS.transactionRespCB[d.stGetProfileRes.ullTransId](a.imlrespcode[d.stGetProfileRes.ret].code,{displayName:d.stGetProfileRes.stProfile.sUserName,
Presence:d.stGetProfileRes.stProfile.sPresenceStatusMsg,profilePicture:d.stGetProfileRes.stProfile.sProfilePicId});break;case a.proto_msgType.values.E_USER_PROFILE_CHANGED_RQT:b.CS.contacts.onpresenceupdatecb&&(h={mobilenumber:d.stUserProfileChangedReq.sProfileUserMobNu},d.stUserProfileChangedReq.stProfile.sUserName&&(h.name=d.stUserProfileChangedReq.stProfile.sUserName),d.stUserProfileChangedReq.stProfile.sPresenceStatusMsg&&(h.message=d.stUserProfileChangedReq.stProfile.sPresenceStatusMsg),d.stUserProfileChangedReq.stProfile.sProfilePicId&&
(h.profilePicUrl=d.stUserProfileChangedReq.stProfile.sProfilePicId),b.CS.contacts.onpresenceupdatecb(a.contactsStatus[c].status,h));h={uVersion:a.protoVersion,stUserProfileChangedRes:{ullTransId:d.stUserProfileChangedReq.stHdrs.ullTransId,sMobNu:a.localUser,sProfileUserMobNu:d.stUserProfileChangedReq.sProfileUserMobNu,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_USER_PROFILE_CHANGED_RSP,h);break;case a.proto_msgType.values.E_CHAT_RQT:h={uVersion:a.protoVersion,stChatRes:{ullTransId:d.stChatReq.stHdrs.ullTransId,
sMobNu:a.localUser,uChatID:d.stChatReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CHAT_RSP,h);b.CS.chat.sendChatResponse(d.stChatReq);b.CS.chat.sendDelivered(d.stChatReq.stHdrs.sMobNu,d.stChatReq.uChatID,0,function(a,b){});b.CS.chat.onMessagecb&&(h={remoteUser:d.stChatReq.stHdrs.sMobNu,data:d.stChatReq.data,timestamp:d.stChatReq.uSendTime,id:d.stChatReq.uChatID,sequence:d.stChatReq.uSeqNum,size:d.stChatReq.dataLen,chattype:a.chatType[d.stChatReq.stChatType].type},
d.stChatReq.sContentType&&(h.contenttype=d.stChatReq.sContentType),d.stChatReq.sThumbnailUrl&&(h.thumbnail=d.stChatReq.sThumbnailUrl),b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RQT],h));break;case a.proto_msgType.values.E_CHAT_RSP:h=a.imlrespcode[d.stChatRes.ret].phrase;b.CS.respData[d.stChatRes.ullTransId]&&(h={status:a.imlrespcode[d.stChatRes.ret].phrase,url:b.CS.respData[d.stChatRes.ullTransId].fileName});if(b.CS.transactionRespCB[d.stChatRes.ullTransId])b.CS.transactionRespCB[d.stChatRes.ullTransId](a.imlrespcode[d.stChatRes.ret].code,
h);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_RSP],{id:d.stChatRes.uChatID,status:a.imlrespcode[d.stChatRes.ret].code,remoteUser:d.stChatRes.sMobNu});break;case a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP:if(b.CS.transactionRespCB[d.stGetMyPendingNotificationsRes.ullTransId])b.CS.transactionRespCB[d.stGetMyPendingNotificationsRes.ullTransId](a.imlrespcode[d.stGetMyPendingNotificationsRes.ret].code,a.imlrespcode[d.stGetMyPendingNotificationsRes.ret].phrase);
break;case a.proto_msgType.values.E_IS_TYPING_RQT:h={uVersion:a.protoVersion,stIsTypingRes:{ullTransId:d.stIsTypingReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_IS_TYPING_RSP,h);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_IS_TYPING_RQT],{remoteUser:d.stIsTypingReq.sDstMobNu,groupId:d.stIsTypingReq.sGroupID});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RQT:console.log("chat delivered");h={uVersion:a.protoVersion,
stChatDeliveryRes:{ullTransId:d.stChatDeliveryReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:d.stChatDeliveryReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CHAT_DELIVERY_RSP,h);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_DELIVERY_RQT],{id:d.stChatDeliveryReq.uChatID,time:d.stChatDeliveryReq.uDeliveryTime,remoteUser:d.stChatDeliveryReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_READ_RQT:console.log("chat read");
h={uVersion:a.protoVersion,stChatReadRes:{ullTransId:d.stChatReadReq.stHdrs.ullTransId,sMobNu:a.localUser,uChatID:d.stChatReadReq.uChatID,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CHAT_READ_RSP,h);if(b.CS.chat.onMessagecb)b.CS.chat.onMessagecb(a.chatRequestType[a.proto_msgType.values.E_CHAT_READ_RQT],{id:d.stChatReadReq.uChatID,time:d.stChatReadReq.uReadTime,remoteUser:d.stChatReadReq.stHdrs.sMobNu});break;case a.proto_msgType.values.E_CHAT_DELIVERY_RSP:if(b.CS.transactionRespCB[d.stChatDeliveryRes.ullTransId])b.CS.transactionRespCB[d.stChatDeliveryRes.ullTransId](a.imlrespcode[d.stChatDeliveryRes.ret].code,
a.imlrespcode[d.stChatDeliveryRes.ret].phrase);break;case a.proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RSP:c=[];k=d.stGetChatHistoryListRes.stChatHistoryList;e=k.length;for(h=0;h<e;h++)c[h]={id:k[h].sChatID,src:k[h].ssrcMobNu,dst:k[h].sDstMobNu,sequenceNo:k[h].ullSeqNum,sentTimestamp:k[h].ullMessageTime,chatType:a.chatType[k[h].eChatType].type,reportsRequested:k[h].uReportsReq,data:k[h].sData,contentType:k[h].sContentType,thumbUrl:k[h].sThumbnailUrl,messageStatus:a.chatStatus[k[h].eStatus].status,
deliveredTimestamp:k[h].ullDeliveryTime,readTimestamp:k[h].ullReadTime},k[h].sThumbnailUrl&&(c[h].thumbnail=k[h].sThumbnailUrl);if(b.CS.transactionRespCB[d.stGetChatHistoryListRes.ullTransId])b.CS.transactionRespCB[d.stGetChatHistoryListRes.ullTransId](a.imlrespcode[d.stGetChatHistoryListRes.eReturnCode].code,{totalMessages:d.stGetChatHistoryListRes.sTotalNumberOfEntries,pageSize:d.stGetChatHistoryListRes.sPageSize,history:c});break;case a.proto_msgType.values.E_GET_CALL_HISTORY_LIST_RSP:c=[];k=d.stGetCallHistoryListRes.stCallHistoryList;
e=k.length;for(h=0;h<e;h++)c[h]={id:k[h].sCallID,src:k[h].ssrcMobNu,dst:k[h].sDstMobNu,callType:a.callType[k[h].eCallType].type,direction:a.direction[k[h].eDirection].type,status:a.callStatus[k[h].eStatus].status,startTime:k[h].ullStartTime,endTime:k[h].ullEndTime};if(b.CS.transactionRespCB[d.stGetCallHistoryListRes.ullTransId])b.CS.transactionRespCB[d.stGetCallHistoryListRes.ullTransId](a.imlrespcode[d.stGetCallHistoryListRes.eReturnCode].code,{totalMessages:d.stGetCallHistoryListRes.sTotalNumberOfEntries,
pageSize:d.stGetCallHistoryListRes.sPageSize,history:c});break;case a.proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RSP:c=[];k=d.stGetRecentConversationListRes.stConversationList;for(h=0;h<k.length;h++)c[h]={messageType:a.recentMsgType[k[h].eConversationType].type},k[h].stChatHistoryList&&(e=k[h].stChatHistoryList,c[h].chat={id:e.sChatID,src:e.ssrcMobNu,dst:e.sDstMobNu,sequenceNo:e.ullSeqNum,sentTimestamp:e.ullMessageTime,chatType:a.chatType[e.eChatType].type,reportsRequested:e.uReportsReq,
data:e.sData,contentType:e.sContentType,thumbUrl:e.sThumbnailUrl,messageStatus:a.chatStatus[e.eStatus].status,deliveredTimestamp:e.ullDeliveryTime,readTimestamp:e.ullReadTime}),k[h].stCallHistoryList&&(e=k[h].stCallHistoryList,c[h].call={callId:e.sCallID,src:e.ssrcMobNu,dst:e.sDstMobNu,callType:a.callType[e.eCallType].type,direction:a.direction[e.eDirection].type,status:a.callStatus[e.eStatus].status,startTime:e.ullStartTime,endTime:e.ullEndTime});if(b.CS.transactionRespCB[d.stGetRecentConversationListRes.ullTransId])b.CS.transactionRespCB[d.stGetRecentConversationListRes.ullTransId](a.imlrespcode[d.stGetRecentConversationListRes.eReturnCode].code,
{totalMessages:d.stGetRecentConversationListRes.sTotalNumberOfEntries,pageSize:d.stGetRecentConversationListRes.sPageSize,list:c});break;case a.proto_msgType.values.E_CHAT_READ_RSP:if(b.CS.transactionRespCB[d.stChatReadRes.ullTransId])b.CS.transactionRespCB[d.stChatReadRes.ullTransId](a.imlrespcode[d.stChatReadRes.ret].code,a.imlrespcode[d.stChatReadRes.ret].phrase);break;case a.proto_msgType.values.E_DELETE_NUM_RSP:if(b.CS.transactionRespCB[d.stDeleteNumRes.ullTransId])b.CS.transactionRespCB[d.stDeleteNumRes.ullTransId](a.imlrespcode[d.stDeleteNumRes.ret].code,
a.imlrespcode[d.stDeleteNumRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT:k=d.stDirectAudioVideoCallStartReq.sCallId;a.call.remoteUser=d.stDirectAudioVideoCallStartReq.stHdrs.sMobNu;a.call.stDirectAudioVideoCallStartReq=d.stDirectAudioVideoCallStartReq;a.call.isVideoCall=a.proto_callType.values.E_VIDEOCALL==d.stDirectAudioVideoCallStartReq.stCallType;h={uVersion:a.protoVersion,stDirectAudioVideoCallStartRes:{ullTransId:d.stDirectAudioVideoCallStartReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:d.stDirectAudioVideoCallStartReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP,h);h={uVersion:a.protoVersion,stDirectAudioVideoCall180RingingReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:f()},sDstMobNu:b.CS.call.remoteUser,stCallType:b.CS.proto_callType.values.E_VIDEOCALL,sCallId:k}};a.proto_callType.values.E_VOICECALL==d.stDirectAudioVideoCallStartReq.stCallType&&(h.stDirectAudioVideoCall180RingingReq.stCallType=
a.proto_callType.values.E_VOICECALL);var g=!1;for(e in a.call.callObj)a.call.callObj[e].state!=a.call.states.IDLE&&a.call.callObj[e].state!=a.call.states.ENDED&&(g=!0);h.stDirectAudioVideoCall180RingingReq.bIsCallWaiting=g;a.call.callObj[k]={state:a.call.states.OFFER_RECEIVED,remoteUser:a.call.remoteUser,type:"IP",direction:"IN",isMuted:!1,iceCandidates:[]};n(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_180_RINGING_RQT,h);if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,
{caller:a.call.remoteUser,isVideoCall:a.call.isVideoCall,callId:k,isCallActive:d.stDirectAudioVideoCallStartReq.sCallActive,startTime:d.stDirectAudioVideoCallStartReq.sStartTime});break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RSP:case a.proto_msgType.values.E_CALL_START_RSP:break;case a.proto_msgType.values.E_CALL_ANSWER_RQT:a.call.callObj[d.stCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=d.stCallAnswerReq.sCallId;if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,
{caller:a.call.remoteUser,callId:d.stCallAnswerReq.sCallId});wr_recv_rem_answer(d.stCallAnswerReq.sSdp,d.stCallAnswerReq.sCallId);h={uVersion:a.protoVersion,stCallAnswerRes:{ullTransId:d.stCallAnswerReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:d.stCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CALL_ANSWER_RSP,h);break;case a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RQT:a.call.callObj[d.callSessionInProgressSdpReq.sCallId].state=a.call.states.CONNECTED;
a.call.activeCallId=d.callSessionInProgressSdpReq.sCallId;wr_recv_rem_answer(d.callSessionInProgressSdpReq.sSdp,d.callSessionInProgressSdpReq.sCallId);if(a.call.callObj[d.callSessionInProgressSdpReq.sCallId].state!=a.call.states.CONNECTED&&b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:d.stCallAnswerReq.sCallId});h={uVersion:a.protoVersion,stCallSessionInProgressSdpRes:{ullTransId:d.stCallSessionInProgressSdpReq.stHdrs.ullTransId,sMobNu:a.localUser,
ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CALL_SESSION_IN_PROGRESS_SDP_RSP,h);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT:a.call.callObj[d.stDirectAudioVideoCallAnswerReq.sCallId].state=a.call.states.CONNECTED;a.call.activeCallId=d.stDirectAudioVideoCallAnswerReq.sCallId;if(b.CS.call.onMessagecb)b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:d.stDirectAudioVideoCallAnswerReq.sCallId});wr_recv_rem_answer(d.stDirectAudioVideoCallAnswerReq.sSdp,
d.stDirectAudioVideoCallAnswerReq.sCallId);h={uVersion:a.protoVersion,stDirectAudioVideoCallAnswerRes:{ullTransId:d.stDirectAudioVideoCallAnswerReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:d.stDirectAudioVideoCallAnswerReq.sCallId,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP,h);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RSP:console.log("received answer response");if(b.CS.transactionRespCB[d.stDirectAudioVideoCallAnswerRes.ullTransId])b.CS.transactionRespCB[d.stDirectAudioVideoCallAnswerRes.ullTransId](a.imlrespcode[d.stDirectAudioVideoCallAnswerRes.ret].code,
a.imlrespcode[d.stDirectAudioVideoCallAnswerRes.ret].phrase);break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT:k=d.stDirectAudioVideoCallEndReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[k])break;a.call.callObj[k].state=a.call.states.ENDED;a.call.remoteUser=d.stDirectAudioVideoCallEndReq.stHdrs.sMobNu;b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:k});h={uVersion:a.protoVersion,stDirectAudioVideoCallEndRes:{ullTransId:d.stDirectAudioVideoCallEndReq.stHdrs.ullTransId,
sMobNu:a.localUser,sCallId:k,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP,h);wr_recv_rem_end();break;case a.proto_msgType.values.E_CALL_ENDED_RQT:k=d.stCallEndedReq.sCallId;a.call.activeCallId="";if(!a.call.callObj[k])break;a.call.callObj[k].state=a.call.states.ENDED;a.call.remoteUser=d.stCallEndedReq.stHdrs.sMobNu;b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:a.call.remoteUser,callId:k});h={uVersion:a.protoVersion,
stCallEndedRes:{ullTransId:d.stCallEndedRes.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:k,ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_CALL_ENDED_RSP,h);wr_recv_rem_end();break;case a.proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RSP:if(b.CS.transactionRespCB[d.stDirectAudioVideoCallEndRes.ullTransId])b.CS.transactionRespCB[d.stDirectAudioVideoCallEndRes.ullTransId](a.imlrespcode[d.stDirectAudioVideoCallEndRes.ret].code,a.imlrespcode[d.stDirectAudioVideoCallEndRes.ret].phrase);
break;case a.proto_msgType.values.E_IS_APP_ON_FOCUS_RSP:case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP:case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP:break;case a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RQT:b.CS.contacts.onpresenceupdatecb&&b.CS.contacts.onpresenceupdatecb(a.contactsStatus[c].status,{user:d.stUserPresenceChangedReq.stPresence.sPhoneNum,isOnline:"ONLINE"==d.stUserPresenceChangedReq.stPresence.sStatus,time:d.stUserPresenceChangedReq.stPresence.sTime,
message:d.stUserPresenceChangedReq.stPresence.sPresenceStatusMsg});h={uVersion:a.protoVersion,stUserPresenceChangedRes:{ullTransId:d.stUserPresenceChangedReq.stHdrs.ullTransId,sMobNu:a.localUser,retCodes:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_USER_PRESENCE_CHANGED_RSP,h);break;case a.proto_msgType.values.E_USER_PENDING_NOTIFICATIONS_RQT:h={uVersion:a.protoVersion,stUserPendingNotificationsRes:{ullTransId:d.stUserPendingNotificationsReq.stHdrs.ullTransId,sMobNu:a.localUser,
retCodes:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RSP,h);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT:console.log("remote ice received");wr_recv_rem_ice(d.stSendIceCandidatesInDirectAVCallReq,d.stSendIceCandidatesInDirectAVCallReq.sCallId);h={uVersion:a.protoVersion,stSendIceCandidatesInDirectAVCallRes:{ullTransId:d.stSendIceCandidatesInDirectAVCallReq.stHdrs.ullTransId,sMobNu:a.localUser,sCallId:d.stSendIceCandidatesInDirectAVCallReq.sCallId,
ret:a.proto_retCodes.values.E_200_OK}};n(a,!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RSP,h);break;case a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RQT:wr_recv_rem_ice(d.stSendIceCandidatesInCallReq,d.stSendIceCandidatesInCallReq.sCallId);h={uVersion:a.protoVersion,stSendIceCandidatesInCallReq:{ullTransId:d.stSendIceCandidatesInCallReq.stHdrs.ullTransId,sMobNu:a.localUser,sDstNumber:d.sendIceCandidatesInCallReq.sDstNumber,ret:a.proto_retCodes.values.E_200_OK}};n(a,
!1,a.proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_CALL_RSP,h);break;case a.proto_msgType.values.E_CALL_INFO_SYNC_RQT:k=d.stCallInfoSyncReq.sCallID;a.call.activeCallId="";b.CS.call.onMessagecb&&b.CS.call.onMessagecb(a.callEventCode[c].code,{caller:d.stCallInfoSyncReq.ssrcMobNu,callId:k,callee:d.stCallInfoSyncReq.sDstMobNu,callType:a.callType[d.stCallInfoSyncReq.eCallType].type,callStatus:a.callStatus[d.stCallInfoSyncReq.eStatus].status,startTime:d.stCallInfoSyncReq.ullStartTime,endTime:d.stCallInfoSyncReq.ullEndTime,
answerTime:d.stCallInfoSyncReq.ullAnswerTime});h={uVersion:a.protoVersion,stCallInfoSyncRes:{ullTransId:d.stCallInfoSyncReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK,sReturnPhrase:"OK"}};n(a,!1,a.proto_msgType.values.E_CALL_INFO_SYNC_RSP,h);break;case a.proto_msgType.values.E_LOGIN_ELSE_WHERE_NOTIFICATION_RQT:h={uVersion:a.protoVersion,stLoginElseWhereNotificationRes:{ullTransId:d.stLoginElseWhereNotificationReq.stHdrs.ullTransId,eReturnCode:a.proto_retCodes.values.E_200_OK,sReturnPhrase:"OK"}};
n(a,!1,a.proto_msgType.values.E_LOGIN_ELSE_WHERE_NOTIFICATION_RSP,h);break;default:console.log("un handled message received "+c)}},A=function(a,b){b.is_provisional||a.connectionState==l.connected?a.transportType==x.socket?1==a.ws.readyState?a.ws.send(b.body):console.log("ws send failed connection state: "+a.ws.readyState):console.log("rest unsupported in current release"):console.log("Unable to send message before login completes")},n=function(a,b,d,c){c=a.proto_msg.encode(a.proto_msg.create(c)).finish();
var k=new ArrayBuffer(10+c.length),h=new DataView(k);h.setUint32(0,d,!1);h.setUint32(4,c.length,!1);h.setUint8(8,13,!1);h.setUint8(9,10,!1);for(d=0;d<c.length;d++)h.setUint8(10+d,c[d],!1);a.connectionState==l.connected||b?(1!=a.ws.readyState&&(a.reconnectTimeout=300,F()),A(a,{is_provisional:b,body:k})):a.msg_queue.push({is_provisional:b,body:k})},w=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;var k=new jsSHA("SHA-256","TEXT");k.update(a.localUser+a.OAuthToken);k=k.getHash("HEX");d={uVersion:a.protoVersion,
stLoginReq:{stHdrs:{sMobNu:a.localUser,sClientId:a.clientId,ullTransId:d},sPassHash:k,sAuth:"auth string",stOSName:a.proto_osType.values.E_WEB,sOSVersion:a.osVersion,sPushDevToken:"",sAppName:"appName",sDeviceId:b.CS.deviceId}};b.CS.appId&&(d.stLoginReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});n(a,!0,a.proto_msgType.values.E_LOGIN_RQT,d)},y=function(a,b){var d=new Uint8Array(a.byteLength+b.byteLength);d.set(new Uint8Array(a),0);d.set(new Uint8Array(b),a.byteLength);
return d.buffer},E=function(a,b){switch(v){case 0:if(10<=g+b.byteLength){t=y(t,b.slice(0,10-g));g=10;var d=new DataView(t);r=d.getUint32(0);m=d.getUint32(4);t=new ArrayBuffer(0);g=0;v=1;return 10}t=y(t,b);g+=b.byteLength;return b.byteLength;case 1:if(g+b.byteLength>=m){t=y(t,b.slice(0,m-g));d=new Uint8Array(t);try{var c=a.proto_msg.decode(d);B(a,r,c)}catch(T){console.log("error decoding message "+T)}finally{return t=new ArrayBuffer(0),v=g=0,m-g}}else return t=y(t,b),g+=b.byteLength,b.byteLength}},
F=function(){var a=b.CS;a.reconnectTimeout||(a.reconnectTimeout=300);if(a.transportType==x.socket){if(a.connectionState!=l.initiated){var c=new WebSocket(p);a.connectionState=l.initiated;c.binaryType="arraybuffer";c.onopen=function(){var a=b.CS;a.connectionState=l.connected;a.reconnectTimeout=300;console.log("websocket connected");a.connReady=!0;null!=a.localUser&&null!=a.OAuthToken&&(a.loggedin=!0,w(a,void 0));for(;0<a.msg_queue.length;)A(a,a.msg_queue.shift())};c.onmessage=function(b){b=b.data;
for(var c;0<b.byteLength;)c=E(a,b),0<c&&(b=b.slice(c))};c.onerror=function(a){};c.onclose=function(a){a=b.CS;console.log("websocket connection closed!. attempting to reconnect");a.tid&&clearTimeout(a.tid);a.tid=setTimeout(F,a.reconnectTimeout);a.reconnectTimeout*=2;3E5<a.reconnectTimeout&&(a.reconnectTimeout=3E5);a.connectionState=l.closed};b.onbeforeunload=function(a){this.connectionState==l.connected&&c.close()};a.ws=c}}else w(a,void 0)},H=function(){};H.prototype.init=function(a){this["super"]=
a};var q=function(){this.activeCallId=this.remoteUser="";this.states={IDLE:1,OFFER_SENT:2,OFFER_RECEIVED:3,RINGING_RECEIVED:4,CONNECTED:5,ENDED:6};this.callObj={}};q.prototype.init=function(a){this["super"]=a};var z=function(){};z.prototype.init=function(a){this["super"]=a};z.prototype.setProfile=function(a,c,d,e){var k=f();b.CS.transactionRespCB[k]=e;a={uVersion:this["super"].protoVersion,stSetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},stProfile:{sUserName:a}}};
c&&""!=c&&(a.stSetProfileReq.stProfile.sPresenceStatusMsg=c);d&&""!=d&&(a.stSetProfileReq.stProfile.sProfilePicId=d);n(this["super"],!1,this["super"].proto_msgType.values.E_SET_PROFILE_RQT,a)};z.prototype.getProfile=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;n(this["super"],!1,this["super"].proto_msgType.values.E_GET_PROFILE_RQT,{uVersion:this["super"].protoVersion,stGetProfileReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d},sMobNum:a}})};z.prototype.getContacts=
function(a){var c=f();b.CS.transactionRespCB[c]=a;n(this["super"],!1,this["super"].proto_msgType.values.E_GET_CONTACTS_RQT,{uVersion:this["super"].protoVersion,stGetContactsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c}}})};z.prototype.isAppContacts=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;n(this["super"],!1,this["super"].proto_msgType.values.E_IS_APP_CONTACT_RQT,{uVersion:this["super"].protoVersion,stIsAppContactReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:d},uCount:a.length,sPhoneNums:a}})};z.prototype.onMessage=function(a){this.onpresenceupdatecb=a};z.prototype.addContact=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;n(this["super"],!1,this["super"].proto_msgType.values.E_ADD_NUM_RQT,{uVersion:this["super"].protoVersion,stAddNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d},uCount:1,sPhoneNums:[a],stContactTypes:[this["super"].contact_type.values.E_CUSTOM_CONTACT]}})};
z.prototype.removeContact=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;n(this["super"],!1,this["super"].proto_msgType.values.E_DELETE_NUM_RQT,{uVersion:this["super"].protoVersion,stDeleteNumReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:d},sPhoneNums:a}})};z.prototype.getPresence=function(a,c){var d=f();b.CS.transactionRespCB[d]=c;n(this["super"],!1,this["super"].proto_msgType.values.E_GET_PRESENCE_RQT,{uVersion:this["super"].protoVersion,stGetPresReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:d},sPhoneNums:a}})};var C=function(){this.chatSeqNo=1};C.prototype.init=function(a){this["super"]=a};C.prototype.onMessage=function(a){this.onMessagecb=a};C.prototype.ChatType={TEXT_PLAIN:1,TEXT_HTML:2,LOCATION:3,IMAGE:4,VIDEO:5,CONTACT:6,DOCUMENT:7};C.prototype.ChatFileType={IMAGE:4,VIDEO:5,DOCUMENT:7};q.prototype.getHistory=function(a,c,d,e){var k=f();b.CS.transactionRespCB[k]=e;c={uVersion:this["super"].protoVersion,stGetCallHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:k},sPageSize:c,sOffset:d}};a&&(c.stGetCallHistoryListReq.sDstMobNu=a);n(this["super"],!1,this["super"].proto_msgType.values.E_GET_CALL_HISTORY_LIST_RQT,c)};q.prototype.saveRecording=function(a,b){};C.prototype.getHistory=function(a,c,d,e){var k=f();b.CS.transactionRespCB[k]=e;c={uVersion:this["super"].protoVersion,stGetChatHistoryListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},sPageSize:c,sOffset:d}};a&&(c.stGetChatHistoryListReq.sDstMobNu=
a);n(this["super"],!1,this["super"].proto_msgType.values.E_GET_CHAT_HISTORY_LIST_RQT,c)};C.prototype.sendReadReceipt=function(a,c,d){var k=f();b.CS.transactionRespCB[k]=d;a={uVersion:this["super"].protoVersion,stChatReadReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},sDstMobNu:a,uChatID:c.toString(),uReadTime:Math.floor(Date.now())}};n(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_READ_RQT,a)};C.prototype.sendDelivered=function(a,c,d,e){var k=
f();b.CS.transactionRespCB[k]=e;a={uVersion:this["super"].protoVersion,stChatDeliveryReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},sDstMobNu:a,uChatID:c.toString(),uDeliveryTime:Math.floor(Date.now()),reports_req:d}};n(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_DELIVERY_RQT,a)};z.prototype.getRecentContacts=function(a,c,d){var k=f();b.CS.transactionRespCB[k]=d;n(this["super"],!1,this["super"].proto_msgType.values.E_GET_RECENT_CONVERSATION_LIST_RQT,
{uVersion:this["super"].protoVersion,stGetRecentConversationListReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},sPageSize:a,sOffset:c}})};C.prototype.sendMessage=function(c,e,d,g,q){if(this["super"].localUser){var k=f();b.CS.transactionRespCB[k]=q;this.chatSeqNo++;q=a(16);var h=Math.floor(Date.now());4E3<e.length&&(e=e.slice(0,4E3));n(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RQT,{uVersion:this["super"].protoVersion,stChatReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:k},sDstMobNu:c,uChatID:q,uSeqNum:this.chatSeqNo,uSendTime:h,stChatType:d,dataLen:e.length,reports_req:g,data:e}});return{id:q,sentTime:h}}q("400","User not logged in!")};var J=function(a){a=atob(a.split(",")[1]);for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return new Blob([new Uint8Array(b)],{type:"image/png"})},G=function(a,c,d,e,f,g,q,G,z,l){console.log("An image has been loaded");var k=new FileReader;k.onload=function(k){var h=new Image;h.onload=
function(k){k=document.createElement("canvas");var m=h.width,p=h.height;m>p?200<m&&(p*=200/m,m=200):200<p&&(m*=200/p,p=200);k.width=m;k.height=p;k.getContext("2d").drawImage(h,0,0,m,p);k=k.toDataURL("image/png");k=J(k);var r="thumb_"+c;b.CS.s3.upload({Key:r,Body:k,ACL:"public-read"},function(c,k){if(c)return alert("There was an error uploading your photo: ",c.message);var h={uVersion:b.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:f},sDstMobNu:g,uChatID:q,
uSeqNum:b.CS.chat.chatSeqNo,uSendTime:G,stChatType:z,dataLen:a.size,reports_req:l,data:e,sThumbnailUrl:r}};d&&(h.stChatReq.sContentType=d);n(b.CS,!1,b.CS.proto_msgType.values.E_CHAT_RQT,h);console.log("chat file sent out to server")})};h.src=k.target.result};k.readAsDataURL(a)};C.prototype.getMediaURLPrefix=function(){return"https://"+b.CS.s3Bin+".s3.ap-southeast-1.amazonaws.com/"};C.prototype.sendPhoto=function(a,b,c){CA.chat.sendFile(a,D.chat.ChatFileType.IMAGE,b.type,"",b,!0,c)};C.prototype.sendVideo=
function(a,b,c,e){CA.chat.sendFile(a,D.chat.ChatFileType.VIDEO,b.type,c,b,!0,e)};C.prototype.sendFile=function(a,b,c,e){CA.chat.sendFile(a,D.chat.ChatFileType.DOCUMENT,b.type,c,b,!0,e)};C.prototype.sendFile=function(c,e,d,g,q,z,m){if(!e||""==e||!q||""==q)return m(400,"invalid input. chatFileType or file content is empty"),-1;var k=f();b.CS.transactionRespCB[k]=m;this.chatSeqNo++;var h=a(16),l=Math.floor(Date.now()),p=a(15)+"_"+q.name;b.CS.s3.upload({Key:p,Body:q,ACL:"public-read"},function(a,f){if(a)return alert("There was an error uploading your photo: ",
a.message);b.CS.respData[k]={fileName:p};if(q.type.match(/image.*/))G(q,p,d,f.Key,k,c,h,l,e,z);else{var m={uVersion:b.CS.protoVersion,stChatReq:{stHdrs:{sMobNu:b.CS.localUser,sClientId:b.CS.clientId,ullTransId:k},sDstMobNu:c,uChatID:h,uSeqNum:b.CS.chat.chatSeqNo,uSendTime:l,stChatType:e,dataLen:q.size,reports_req:z,data:f.Key}};d&&(m.stChatReq.sContentType=d);g&&""!=g&&(m.stChatReq.sThumbnailUrl=g);n(b.CS,!1,b.CS.proto_msgType.values.E_CHAT_RQT,m)}});return{id:h,sentTime:l,url:p}};C.prototype.getPendingChat=
function(a){var c=f();b.CS.transactionRespCB[c]=a;n(this["super"],!1,this["super"].proto_msgType.values.E_GET_MY_PENDING_NOTIFICATIONS_RQT,{uVersion:this["super"].protoVersion,stGetMyPendingNotificationsReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c},sPendingNotificationType:this["super"].proto_pendingNotifType.values.E_CHAT_REQUEST}})};C.prototype.sendIsTyping=function(a,b){var c=f();n(this["super"],!1,this["super"].proto_msgType.values.E_IS_TYPING_RQT,
{uVersion:this["super"].protoVersion,stIsTypingReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c},sDstMobNu:a,sGroupID:b}})};C.prototype.sendChatResponse=function(a){n(this["super"],!1,this["super"].proto_msgType.values.E_CHAT_RSP,{uVersion:this["super"].protoVersion,stChatRes:{ullTransId:a.stHdrs.ullTransId,sMobNu:this["super"].localUser,uChatID:a.uChatID.toString(),ret:this["super"].proto_retCodes.values.E_200_OK}})};q.prototype.onMessage=function(a){this.onMessagecb=
a};q.prototype.startCall=function(c,e,d,f,g,q){if(5!=arguments.length&&6!=arguments.length)return console.log("invalid arguments list"),-1;if(!this["super"].localUser)return g("400","User not logged in!"),-1;this.isVideoCall=f;this.remoteUser=c;var k=a(16);this.callObj[k]={state:this.states.OFFER_SENT,remoteUser:c,type:"IP",direction:"OUT",isMuted:!1,iceCandidates:[]};this.callObj[k].is_record_callTrue=q?!0:!1;wr_send_rem_call(this,k,f,e,d,q);b.CS.call.callToCb=g;return k};q.prototype.saveRecording=
function(a,b,c){wr_save_recording(a,b)};q.prototype.deleteRecording=function(a,b){wr_save_recording(a,fileName)};q.prototype.startPSTNCall=function(c,e,d,f,g){this.isVideoCall=f;this.remoteUser=c;var k=a(16);wr_send_rem_call(this,k,f,e,d);this.callObj[k]={state:this.states.OFFER_SENT,remoteUser:c,type:"PSTN",direction:"OUT",isMuted:!1,iceCandidates:[]};b.CS.call.callToCb=g;return k};q.prototype.decline=function(a,c){this.callObj[a]?(this.declinecb=c,this.callObj[a].state=this.states.ENDED,b.CS.call.end(a,
"User busy",function(a,b){console.log("user budy ret "+a)})):c(400,"Unknown callId")};q.prototype.answer=function(a,c,d,e){this.answercb=e;this.callObj[a].state=this.states.CONNECTED;""!=this.activeCallId&&(e=this.activeCallId,b.CS.call.end(e,"Switched to another call",function(a,b){}),delete this.callObj[e]);this.activeCallId=a;wr_recv_rem_offer(a,c,this.isVideoCall,d,this.stDirectAudioVideoCallStartReq)};q.prototype.sendAnswer=function(a,c,d){var e=f();b.CS.transactionRespCB[e]=d;a={uVersion:this["super"].protoVersion,
stDirectAudioVideoCallAnswerReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:e},sDstMobNu:this.remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,sCallId:a,sSdp:c}};b.CS.call.isVideoCall||(a.stDirectAudioVideoCallAnswerReq.stCallType=this["super"].proto_callType.values.E_VOICECALL);n(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_ANSWER_RQT,a);console.log("sent answer")};q.prototype.sendIce=function(a,c,d,e,g){var k=
f();b.CS.transactionRespCB[k]=g;"IP"==b.CS.call.callObj[e].type?(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInDirectAVCallReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:k},sDstNumber:a,sCallId:e.toString(),sIceCandidates:[c],sJsonIceCandidates:[d]}},n(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a)):"PSTN"==b.CS.call.callObj[e].type&&(a={uVersion:this["super"].protoVersion,stSendIceCandidatesInCallReq:{stHdrs:{sMobNu:this["super"].localUser,
sClientId:this["super"].clientId,ullTransId:k},sDstNumber:a,sCallId:e.toString(),sIceCandidates:[c],sJsonIceCandidates:[d],sDirection:this["super"].direction_enum.values.E_TO_SERVER,sAppId:"webapp"}},n(this["super"],!1,this["super"].proto_msgType.values.E_SEND_ICE_CANDIDATES_IN_DIRECT_AV_CALL_RQT,a))};q.prototype.end=function(a,c,d){this.callObj[a]?(this.activeCallId="",this.callObj[a].state=this.states.ENDED,c=f(),b.CS.transactionRespCB[c]=d,wr_send_rem_call_end(a),a={uVersion:this["super"].protoVersion,
stDirectAudioVideoCallEndReq:{stHdrs:{sMobNu:this["super"].localUser,sClientId:this["super"].clientId,ullTransId:c},sDstMobNu:this.callObj[a].remoteUser,stCallType:this["super"].proto_callType.values.E_VIDEOCALL,sCallId:a,sStopTime:Math.floor(Date.now())}},b.CS.call.isVideoCall||(a.stDirectAudioVideoCallEndReq.stCallType=this["super"].proto_callType.values.E_VOICECALL),n(this["super"],!1,this["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_END_RQT,a)):d(400,"Unknown callId")};q.prototype.mute=
function(a,c,d){c?(wr_set_local_mute(this,a,d),b.CS.call.callObj[a].isMuted=!0):(wr_set_local_unmute(this,a,d),b.CS.call.callObj[a].isMuted=!1)};q.prototype.isMuted=function(a,b,c){return D.call.callObj[a].isMuted};var S=function(a){protobuf.load("/res/iml.json",function(b,c){if(b)throw b;a.proto_root=c;a.proto_msg=c.lookup("msg");a.proto_osType=c.lookup("osType");a.proto_retCodes=c.lookup("retCodes");a.proto_msgType=c.lookup("msgType");a.proto_pendingNotifType=c.lookup("pendingNotificationType");
a.proto_chatType=c.lookup("chatType");a.proto_callType=c.lookup("callType");a.proto_isFocusStatus=c.lookup("appFocusStatus");a.direction_enum=c.lookup("sendDirection");a.contact_type=c.lookup("contactType");a.contactsStatus={293:{status:"PresenceUpdate"},81:{status:"ProfileChanged"},5:{status:"UserJoined"}};a.chatRequestType={9:"NEW-MESSAGE",10:"SENT",11:"DELIVERED",13:"READ",307:"IS-COMPOSING"};a.recentMsgType={0:{type:"UNKNOWN"},1:{type:"CHAT"},2:{type:"GROUP-CHAT"},3:{type:"CALL"}};a.chatStatus=
{0:{status:"Unknown"},1:{status:"SENT"},2:{status:"DELIVERED"},3:{status:"READ"}};a.chatType={0:{type:"Unknown"},1:{type:"Text"},2:{type:"html"},3:{type:"location"},4:{type:"image"},5:{type:"video"},6:{type:"contact"},7:{type:"document"}};a.direction={0:{type:"Unknown"},1:{type:"Outgoing"},2:{type:"Incoming"}};a.callStatus={0:{status:"Unknown"},1:{status:"Missed"},2:{status:"Answered"}};a.callType={0:{type:"Unknown"},1:{type:"Audio"},2:{type:"Video"},3:{type:"Live-Location"},4:{type:"Pstn"}};a.callEventCode=
{187:{code:"PSTN-OFFER",phrase:"PSTN Call offer received"},193:{code:"ANSWERED",phrase:"Call answered received"},195:{code:"OFFER",phrase:"Call offer received"},197:{code:"ANSWERED",phrase:"Call answered received"},199:{code:"END",phrase:"Call end received"},206:{code:"END",phrase:"Call end received"},295:{code:"RINGING",phrase:"Remote party ringing"},313:{code:"CALLHISTORYSYNC",phrase:"Call history synchronized"}};a.imlrespcode={1:{code:200,phrase:"OK"},2:{code:202,phrase:"Created"},6:{code:204,
phrase:"Resend Activation Code"},3:{code:401,phrase:"Unauthorized"},7:{code:403,phrase:"Forbiddon"},4:{code:409,phrase:"NotAllowed"},11:{code:499,phrase:"User Attached"},5:{code:500,phrase:"Internal Error"},10:{code:703,phrase:"Limit exceeded"}};a.protoLoad=!0})},D=function(){this.transportType="WebSocket"in b||b.WebSocket?x.socket:x.rest;this.transportType==x.rest&&alert("rest unsupported in current release");this.localuser="";this.OAuthToken=this.localUser=null;this.msg_queue=[];S(this);this.protoVersion=
1;this.clientId=0;this.transactionRespCB={};this.respData={};this.s3Bin="";this.osName="Web";this.osVersion="-";this.chat=new C;this.chat.init(this);this.contacts=new z;this.contacts.init(this);this.call=new q;this.call.init(this);this.stream=new H;this.stream.init(this);this.subModulesLoadComplete=!0},W=function(a){a=b.CS;a.protoLoad&&a.connReady&&(clearInterval(a.intervalTimer),$(b).on("blur focus",function(a){if($(this).data("prevType")!=a.type)switch(a.type){case "blur":u(!0);break;case "focus":u(!1)}$(this).data("prevType",
a.type)}),a.initCb(200,"SDK initialized"))};D.prototype.askPushNotificationPermission=function(){OneSignal.push(function(){OneSignal.showHttpPrompt()})};D.prototype.initialize=function(a,h){this.version="0.3.10.2";b.CS.timeOffset=0;0<arguments.length&&(this.initCb=arguments[arguments.length-1]);this.intervalTimer=setInterval(function(){W(this)},200);var d="iamlivedemo1",k="ap-southeast-1",g="ap-southeast-1:cea94880-b040-46f5-8f91-550a9381142d";p="wss://proxy.vox-cpaas.com:8989";b.CS.rtcservers={};
b.CS.rtcservers.stun="stun:stun.l.google.com:19302";b.CS.rtcservers.turn="turn:34.253.104.58:3478?transport=udp";b.CS.rtcservers.turnUser="testuser";b.CS.rtcservers.turnPassword="test";b.CS.appId="";b.CS.jsonPath="/res/iml4.json";2==arguments.length&&(a=arguments[0],d=a.s3Bucket||d,k=a.s3Region||k,g=a.s3IdentityPoolId||g,b.CS.appId=a.appId||b.CS.appId,b.CS.jsonPath=a.jsonpath||b.CS.jsonPath,a.webrtc&&(D.rtcservers.stun=a.webrtc.stun||D.stun,D.rtcservers.turn=a.webrtc.turn||D.turn,D.rtcservers.turnUser=
a.webrtc.turnUser||D.turnUser,D.rtcservers.turnPassword=a.webrtc.turnPassword||D.turnPassword));b.CS.servers={iceServers:[{urls:b.CS.rtcservers.stun},{urls:b.CS.rtcservers.turn,username:b.CS.rtcservers.turnUser,credential:b.CS.rtcservers.turnPassword}]};AWS.config.update({region:k,credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:g})});this.s3=new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:d}});setTimeout(F,100);(d=c("iml_dev_id"))?b.CS.deviceId=d:(b.CS.deviceId=f().toString(),e("iml_dev_id",
b.CS.deviceId,9999));b.CS.clientId="iamlive_web"};D.prototype.logout=function(){this.ws.close()};D.prototype.createTempUser=function(a,b,c){$.ajax({type:"POST",dataType:"json",url:"https://proxy.vox-cpaas.com:9295/api/createuser",data:"username="+a+"&password="+b,success:function(d){"Created"==d?c(200,{user:a,pass:b}):c(500,"Internal Error")},failure:function(){c(500,"Internal Error")}})};D.prototype.signup=function(a,c,d){this.localUser=a;this.OAuthToken=c;a=f();b.CS.transactionRespCB[a]=d;d=new jsSHA("SHA-256",
"TEXT");d.update(this.localUser+this.OAuthToken);d=d.getHash("HEX");d={uVersion:this.protoVersion,stSignUpReq:{stHdrs:{sMobNu:this.localUser,sClientId:this.clientId,ullTransId:a},sPassHash:d,sAuth:"auth string",sAppName:"web-sdk",stOSName:this.proto_osType.values.E_WEB,sOSVersion:this.osVersion}};b.CS.appId&&(d.stSignUpReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});n(this,!0,this.proto_msgType.values.E_SIGNUP_RQT,d)};D.prototype.activate=function(a,c,d){var e=f();b.CS.transactionRespCB[e]=
d;a={uVersion:this.protoVersion,stActivateReq:{stHdrs:{sMobNu:a,sClientId:this.clientId,ullTransId:e},sActCode:c}};b.CS.appId&&(a.stActivateReq.sAppDetails={sAppName:"",sCustomerId:"",sAppId:b.CS.appId,sAppSecret:""});n(this,!0,this.proto_msgType.values.E_ACTIVATE_RQT,a)};D.prototype.send_msg=n;D.prototype.login=function(a,b,c){this.localUser=a;this.OAuthToken=b;try{OneSignal&&OneSignal.push(["addListenerForNotificationOpened",function(a){console.log("Received NotificationOpened:");console.log(a);
a=clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(a){for(var b=0;b<a.length;b++)console.log(winowClient)});event.waitUntil(a)}])}catch(I){console.log("one signal error "+I.message)}finally{}w(this,c)};b.CS=new D})(window,void 0);navigator.sayswho=function(){var b=navigator.userAgent,a=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){var c=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(c[1]||"")}if("Chrome"===a[1]&&(c=b.match(/\b(OPR|Edge)\/(\d+)/),null!=c))return c.slice(1).join(" ").replace("OPR","Opera");a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=b.match(/version\/(\d+)/i))&&a.splice(1,1,c[1]);return a.join(" ")}();
function mozVidFreezeModSdp(b){try{console.log(b);var a=b.match(/m=video.*/g);if(!a)return b;console.log("sdp match");console.log(a);a=a[0];nums=a.match(/[0-9 ]*$/)[0].trim().split(" ");for(var c in nums){var e="a=rtpmap:"+nums[c]+" VP8/90000",f=b.search(e);-1==f&&(e="a=rtpmap:"+nums[c]+" VP9/90000",f=b.search("a=rtpmap:"+nums[c]+" VP9/90000"));if(-1!=f){var u=b.match(new RegExp("a=fmtp:"+nums[c]+".*"));if(u){if(u=u[0],console.log(u),u&&-1==u.search("max-fs")){var p=u.replace("a=fmtp:"+nums[c]+" ",
"a=fmtp:"+nums[c]+" max-fs=12288;");b=b.replace(u,p)}}else console.log("src:"+e),console.log("dst:"+e+"\r\na=fmtp:"+nums[c]+" max-fs=12288"),b=b.replace(e,e+"\r\na=fmtp:"+nums[c]+" max-fs=12288")}}console.log(b)}catch(x){console.log("Err "+x)}return b}
var wr_recv_rem_offer=function(b,a,c,e,f){var u=window.CS.call;u.localUiElem=document.getElementById(a);u.remoteUiElem=document.getElementById(e);u.remoteSDP="Firefox 56"==navigator.sayswho||"Firefox 57"==navigator.sayswho?mozVidFreezeModSdp(f.sSdp):f.sSdp;console.log("wr_recv_rem_offer");navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(a){wr_get_local_stream_to_answer(a,b)})["catch"](getUserMediaFailed)},getUserMediaFailed=function(b){console.log("Get User Media Failed: ",b)},
wr_on_error=function(b){console.log("error: ",b)},wr_recv_rem_end=function(){var b=window.CS.call;b.peerConnection&&(b.localStream.getTracks().forEach(function(a){a.stop()}),b.peerConnection.close(),b.peerConnection=null);b.localUiElem&&(b.localUiElem.srcObject=void 0);b.remoteUiElem&&(b.remoteUiElem.srcObject=void 0)},wr_recv_rem_ice=function(b,a){if(0!=b.sJsonIceCandidates.length)for(var c=window.CS.call,e=0;e<b.sJsonIceCandidates.length;e++){var f=JSON.parse(b.sJsonIceCandidates[e]).ice;c.peerConnection?
c.peerConnection.addIceCandidate(new RTCIceCandidate(f)):(console.log("ice candidate before peer connection creation"),c.callObj[a].iceCandidates.push(f))}},wr_recv_rem_answer=function(b,a){var c=window.CS.call;if(c.peerConnection){"Firefox 56"!=navigator.sayswho&&"Firefox 57"!=navigator.sayswho||console.log(" received answer sdp before modification "+b);b=mozVidFreezeModSdp(b);console.log(" received answer sdp after modification "+b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",
sdp:b}));for(var e=c.callObj[a].iceCandidates.length,f=0;f<e;f++){var u=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(u))}}},wr_handleError=function(b){},wr_gotRemoteStream=function(b){var a=window.CS.call;a.remoteUiElem.srcObject!==b.stream&&(a.remoteUiElem.srcObject=b.stream,console.log("Received remote stream"))},wr_get_local_sdp=function(b,a){var c=window.CS.call;console.log(" local sdp "+b.sdp);c.peerConnection.setLocalDescription(b).then(function(){sendLocalSDPOffer(a)})["catch"](wr_on_error)};
function randNum(){return Math.ceil(1E9*Math.random())}
var sendLocalSDPOffer=function(b){var a=window.CS.call,c=randNum();"IP"==a.callObj[b].type?(b={uVersion:a["super"].protoVersion,stDirectAudioVideoCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VIDEOCALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp,sCallActive:!0,sStartTime:Math.floor(Date.now())}},a.isVideoCall||(b.stDirectAudioVideoCallStartReq.stCallType=a["super"].proto_callType.values.E_VOICECALL),
window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_DIRECT_AUDIO_VIDEO_CALL_START_RQT,b)):"PSTN"==a.callObj[b].type&&(b={uVersion:a["super"].protoVersion,stCallStartReq:{stHdrs:{sMobNu:a["super"].localUser,sClientId:a["super"].clientId,ullTransId:c},sDstMobNu:a.remoteUser,stCallType:a["super"].proto_callType.values.E_VOICECALL,sCallId:b,sSdp:a.peerConnection.localDescription.sdp}},window.CS.send_msg(a["super"],!1,a["super"].proto_msgType.values.E_CALL_START_RQT,b))},wr_send_remote_answer=
function(b,a){var c=window.CS.call;c.peerConnection.setLocalDescription(b).then(function(){sendAnswerSDP(a)})["catch"](wr_on_error);var e=c.callObj[a].iceCandidates.length;console.log("send_remote_answer iceCandidates len "+e);for(var f=0;f<e;f++){var u=c.callObj[a].iceCandidates.pop();c.peerConnection.addIceCandidate(new RTCIceCandidate(u));console.log("callee adding ice "+f)}},sendAnswerSDP=function(b){var a=window.CS.call;a.sendAnswer(b,a.peerConnection.localDescription.sdp,function(a,b){console.log("answer sent "+
a)})},wr_send_rem_call_end=function(){var b=window.CS.call;b.localStream&&b.localStream.getTracks().forEach(function(a){a.stop()});b.peerConnection&&(b.peerConnection.close(),b.peerConnection=null,b.localUiElem.srcObject=void 0,b.remoteUiElem.srcObject=void 0)};window.CS.servers={iceServers:[{urls:window.CS.stun},{urls:window.CS.turn,username:window.CS.turnUser,credential:window.CS.turnPassword}]};
var wr_get_local_stream_to_answer=function(b,a){var c=window.CS.call;c.localUiElem.srcObject=b;c.localStream=b;console.log("wr_get_local_stream_to_answer");c.peerConnection=new RTCPeerConnection(window.CS.servers);c.peerConnection.onicecandidate=function(b){if(b.candidate){var e=JSON.stringify({ice:b.candidate});c.sendIce(c.remoteUser,b.candidate.candidate,e,a,function(a,b){})}};c.peerConnection.onaddstream=wr_gotRemoteStream;c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.onsignalingstatechange=
function(a){};c.peerConnection.addStream(b);c.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:c.remoteSDP}));c.peerConnection.createAnswer().then(function(b){wr_send_remote_answer(b,a)})["catch"](wr_handleError)},wr_create_local_stream_to_offer=function(b,a){var c=window.CS.call;c.localUiElem.srcObject=b;c.localStream=b;c.peerConnection=new RTCPeerConnection(window.CS.servers);console.log("created peer connection");c.peerConnection.onicecandidate=function(b){if(b.candidate){var e=
JSON.stringify({ice:b.candidate});c.sendIce(c.remoteUser,b.candidate.candidate,e,a,function(a,b){console.log("response from sendicetoserver "+a)})}};c.peerConnection.onaddstream=wr_gotRemoteStream;c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.onsignalingstatechange=function(a){};c.peerConnection.addStream(b);c.peerConnection.createOffer().then(function(b){wr_get_local_sdp(b,a)})["catch"](wr_handleError)},wr_send_rem_call=function(b,a,c,e,f){b.localUiElem=document.getElementById(e);
b.remoteUiElem=document.getElementById(f);navigator.mediaDevices.getUserMedia({audio:!0,video:c}).then(function(b){wr_create_local_stream_to_offer(b,a)})["catch"](getUserMediaFailed)},wr_set_local_mute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!1)});c(100,"Ok")},wr_set_local_unmute=function(b,a,c){b.peerConnection.getSenders().forEach(function(a){"audio"==a.track.kind&&(a.track.enabled=!0)});c(100,"Ok")};(function(b){function a(a,b,c){var g=0,q=[],m=0,z,n,k,h=!1,d=[],r=[],t=!1;c=c||{};var C=c.encoding||"UTF8";var v=c.numRounds||1;if(v!==parseInt(v,10)||1>v)throw Error("numRounds must a integer >= 1");if(0===a.lastIndexOf("SHA-",0))if(z=function(b,c){return F(b,c,a)},n=function(b,c,d,e){if("SHA-224"===a||"SHA-256"===a){var g=(c+65>>>9<<4)+15;var f=16}else throw Error("Unexpected error in SHA-2 implementation");for(;b.length<=g;)b.push(0);b[c>>>5]|=128<<24-c%32;c+=d;b[g]=c&4294967295;b[g-1]=c/4294967296|
0;d=b.length;for(c=0;c<d;c+=f)e=F(b.slice(c,c+f),e,a);if("SHA-224"===a)b=[e[0],e[1],e[2],e[3],e[4],e[5],e[6]];else if("SHA-256"===a)b=e;else throw Error("Unexpected error in SHA-2 implementation");return b},k=function(a){return a.slice()},"SHA-224"===a){var w=512;var y=224}else if("SHA-256"===a)w=512,y=256;else throw Error("Chosen SHA variant is not supported");else throw Error("Chosen SHA variant is not supported");var B=l(b,C);var A=E(a);this.setHMACKey=function(b,c,e){if(!0===h)throw Error("HMAC key already set");
if(!0===t)throw Error("Cannot set HMAC key after calling update");C=(e||{}).encoding||"UTF8";c=l(c,C)(b);b=c.binLen;c=c.value;var f=w>>>3;e=f/4-1;if(f<b/8){for(c=n(c,b,0,E(a));c.length<=e;)c.push(0);c[e]&=4294967040}else if(f>b/8){for(;c.length<=e;)c.push(0);c[e]&=4294967040}for(b=0;b<=e;b+=1)d[b]=c[b]^909522486,r[b]=c[b]^1549556828;A=z(d,A);g=w;h=!0};this.update=function(a){var b,c=0,d=w>>>5;var e=B(a,q,m);a=e.binLen;var f=e.value;e=a>>>5;for(b=0;b<e;b+=d)c+w<=a&&(A=z(f.slice(b,b+d),A),c+=w);g+=
c;q=f.slice(c>>>5);m=a%w;t=!0};this.getHash=function(b,c){if(!0===h)throw Error("Cannot call getHash after setting HMAC key");var d=x(c);switch(b){case "HEX":var z=function(a){return e(a,y,d)};break;case "B64":z=function(a){return f(a,y,d)};break;case "BYTES":z=function(a){return u(a,y)};break;case "ARRAYBUFFER":try{var l=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}z=function(a){return p(a,y)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");
}var G=n(q.slice(),m,g,k(A));for(l=1;l<v;l+=1)G=n(G,y,0,E(a));return z(G)};this.getHMAC=function(b,c){if(!1===h)throw Error("Cannot call getHMAC without first setting HMAC key");var d=x(c);switch(b){case "HEX":var l=function(a){return e(a,y,d)};break;case "B64":l=function(a){return f(a,y,d)};break;case "BYTES":l=function(a){return u(a,y)};break;case "ARRAYBUFFER":try{l=new ArrayBuffer(0)}catch(K){throw Error("ARRAYBUFFER not supported by this environment");}l=function(a){return p(a,y)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}var G=n(q.slice(),m,g,k(A));var t=z(r,E(a));t=n(G,y,w,t);return l(t)}}function c(){}function e(a,b,c){var e="";b/=8;var g;for(g=0;g<b;g+=1){var f=a[g>>>2]>>>8*(3+g%4*-1);e+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15)}return c.outputUpper?e.toUpperCase():e}function f(a,b,c){var e="",g=b/8,f;for(f=0;f<g;f+=3){var q=f+1<g?a[f+1>>>2]:0;var l=f+2<g?a[f+2>>>2]:0;l=(a[f>>>2]>>>8*(3+f%4*-1)&255)<<16|(q>>>8*(3+(f+1)%4*-1)&255)<<8|l>>>8*(3+(f+2)%4*-1)&255;for(q=0;4>q;q+=1)8*f+6*q<=
b?e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6*(3-q)&63):e+=c.b64Pad}return e}function u(a,b){var c="",e=b/8,f;for(f=0;f<e;f+=1){var g=a[f>>>2]>>>8*(3+f%4*-1)&255;c+=String.fromCharCode(g)}return c}function p(a,b){var c=b/8,e,f=new ArrayBuffer(c);var g=new Uint8Array(f);for(e=0;e<c;e+=1)g[e]=a[e>>>2]>>>8*(3+e%4*-1)&255;return f}function x(a){var b={outputUpper:!1,b64Pad:"=",shakeLen:-1};a=a||{};b.outputUpper=a.outputUpper||!1;!0===a.hasOwnProperty("b64Pad")&&
(b.b64Pad=a.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function l(a,b){switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(a){case "HEX":var c=function(a,b,c){var e=a.length,f,g;if(0!==e%2)throw Error("String of HEX type must be in byte increments");b=b||[0];c=c||0;var h=c>>>3;for(f=
0;f<e;f+=2){var d=parseInt(a.substr(f,2),16);if(isNaN(d))throw Error("String of HEX type contains invalid characters");var l=(f>>>1)+h;for(g=l>>>2;b.length<=g;)b.push(0);b[g]|=d<<8*(3+l%4*-1)}return{value:b,binLen:4*e+c}};break;case "TEXT":c=function(a,c,e){var f=0,g,k,h;c=c||[0];e=e||0;var d=e>>>3;if("UTF8"===b){var l=3;for(g=0;g<a.length;g+=1){var q=a.charCodeAt(g);var m=[];128>q?m.push(q):2048>q?(m.push(192|q>>>6),m.push(128|q&63)):55296>q||57344<=q?m.push(224|q>>>12,128|q>>>6&63,128|q&63):(g+=
1,q=65536+((q&1023)<<10|a.charCodeAt(g)&1023),m.push(240|q>>>18,128|q>>>12&63,128|q>>>6&63,128|q&63));for(k=0;k<m.length;k+=1){var n=f+d;for(h=n>>>2;c.length<=h;)c.push(0);c[h]|=m[k]<<8*(l+n%4*-1);f+=1}}}else if("UTF16BE"===b||"UTF16LE"===b)for(l=2,m="UTF16LE"===b&&!0||"UTF16LE"!==b&&!1,g=0;g<a.length;g+=1){q=a.charCodeAt(g);!0===m&&(k=q&255,q=k<<8|q>>>8);n=f+d;for(h=n>>>2;c.length<=h;)c.push(0);c[h]|=q<<8*(l+n%4*-1);f+=2}return{value:c,binLen:8*f+e}};break;case "B64":c=function(a,b,c){var e=0,f,
g;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");var h=a.indexOf("=");a=a.replace(/=/g,"");if(-1!==h&&h<a.length)throw Error("Invalid '=' found in base-64 string");b=b||[0];c=c||0;var d=c>>>3;for(h=0;h<a.length;h+=4){var q=a.substr(h,4);for(f=g=0;f<q.length;f+=1){var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[f]);g|=l<<18-6*f}for(f=0;f<q.length-1;f+=1){var m=e+d;for(l=m>>>2;b.length<=l;)b.push(0);b[l]|=(g>>>16-8*f&255)<<
8*(3+m%4*-1);e+=1}}return{value:b,binLen:8*e+c}};break;case "BYTES":c=function(a,b,c){var e;b=b||[0];c=c||0;var f=c>>>3;for(e=0;e<a.length;e+=1){var g=a.charCodeAt(e);var h=e+f;var d=h>>>2;b.length<=d&&b.push(0);b[d]|=g<<8*(3+h%4*-1)}return{value:b,binLen:8*a.length+c}};break;case "ARRAYBUFFER":try{c=new ArrayBuffer(0)}catch(J){throw Error("ARRAYBUFFER not supported by this environment");}c=function(a,b,c){var e;b=b||[0];c=c||0;var f=c>>>3;var g=new Uint8Array(a);for(e=0;e<a.byteLength;e+=1){var h=
e+f;var d=h>>>2;b.length<=d&&b.push(0);b[d]|=g[e]<<8*(3+h%4*-1)}return{value:b,binLen:8*a.byteLength+c}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return c}function g(a,b){return a>>>b|a<<32-b}function t(a,b,c){return a&b^~a&c}function m(a,b,c){return a&b^a&c^b&c}function r(a){return g(a,2)^g(a,13)^g(a,22)}function v(a){return g(a,6)^g(a,11)^g(a,25)}function B(a){return g(a,7)^g(a,18)^a>>>3}function A(a){return g(a,17)^g(a,19)^a>>>10}function n(a,b){var c=
(a&65535)+(b&65535);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function w(a,b,c,e){var f=(a&65535)+(b&65535)+(c&65535)+(e&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(e>>>16)+(f>>>16)&65535)<<16|f&65535}function y(a,b,c,e,f){var g=(a&65535)+(b&65535)+(c&65535)+(e&65535)+(f&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(e>>>16)+(f>>>16)+(g>>>16)&65535)<<16|g&65535}function E(a){var b,e;if(0===a.lastIndexOf("SHA-",0))switch(b=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,
3204075428],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],a){case "SHA-224":break;case "SHA-256":b=e;break;case "SHA-384":b=[new c,new c,new c,new c,new c,new c,new c,new c];break;case "SHA-512":b=[new c,new c,new c,new c,new c,new c,new c,new c];break;default:throw Error("Unknown SHA variant");}else throw Error("No SHA variants supported");return b}function F(a,b,c){var e,f,g,l=[];if("SHA-224"===c||"SHA-256"===c){var p=64;var k=1;var h=Number;var d=n;
var q=w;var u=y;var x=B;var z=A;var C=r;var E=v;var F=m;var U=t;var V=H}else throw Error("Unexpected error in SHA-2 implementation");c=b[0];var O=b[1];var M=b[2];var P=b[3];var L=b[4];var N=b[5];var K=b[6];var Q=b[7];for(g=0;g<p;g+=1)16>g?(f=g*k,e=a.length<=f?0:a[f],f=a.length<=f+1?0:a[f+1],l[g]=new h(e,f)):l[g]=q(z(l[g-2]),l[g-7],x(l[g-15]),l[g-16]),e=u(Q,E(L),U(L,N,K),V[g],l[g]),f=d(C(c),F(c,O,M)),Q=K,K=N,N=L,L=d(P,e),P=M,M=O,O=c,c=d(e,f);b[0]=d(c,b[0]);b[1]=d(O,b[1]);b[2]=d(M,b[2]);b[3]=d(P,b[3]);
b[4]=d(L,b[4]);b[5]=d(N,b[5]);b[6]=d(K,b[6]);b[7]=d(Q,b[7]);return b}var H=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,
2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];"function"===typeof define&&define.amd?define(function(){return a}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=a),exports=a):b.jsSHA=a})(this);
